<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Placing grids within spaces | Pandaqi Blog</title><link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-7" style=--rotation:1.5deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-4" style=--rotation:1deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-4" style=--rotation:-1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-2" style=--rotation:1deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-1" style=--rotation:1deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-1" style=--rotation:-1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><h1>Placing grids within spaces</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=https://pandaqi.com/blog/tutorials/>Tutorials</a>
/
<a href=https://pandaqi.com/blog/tutorials/placing-grids-within-spaces/>Placing grids within spaces</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/pandaqi.com\/blog\/tutorials\/","name":"tutorials"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/pandaqi.com\/blog\/tutorials\/placing-grids-within-spaces\/","name":"placing-grids-within-spaces"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2023-04-22T12:12:12>Saturday, Apr 22, 2023</time></div><nav class=tags><span class=metadata-label><span class=emoji>üéó</span> Tags ||</span><ul><li><a href=https://pandaqi.com/blog/tags/tutorial>tutorial</a></li></ul></nav><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#a-page>A page</a></li><li><a href=#input-and-output>Input and Output</a></li><li><a href=#rectangles>Rectangles</a></li><li><a href=#triangles>Triangles</a></li><li><a href=#circles>Circles</a></li><li><a href=#hexagons>Hexagons</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside><div><p>More and more (board)games from my <a href=https://pandaqi.com>website</a> can be &ldquo;generated&rdquo; and then downloaded as a PDF. To make this easy and consistent, I wrote a simply library (called <code>GridMapper</code>) some time ago. It does nothing more than take images (or HTML canvases) as input and then <em>place</em> them on an A4 paper in a neat grid.</p><p>For rectangles, this was easy. For any other shape or grid, however, I ran into <em>big</em> trouble. In this article, I share what I&rsquo;ve learned about how to create <strong>rectangle, hexagon, triangle</strong> and <strong>spherical</strong> grids and make them fit within a space (such as the boundaries of a single paper),</p><p>I write this to help anybody else with such problems, but also to help <em>myself</em> in the future :p Because figuring this out took a while.</p><h2 id=a-page>A page</h2><p>In my GridMapper, I can define the size and margins of a page. All games on my website simply reuse the same default value for this, but it can obviously be anything. (If you want to print on another paper size, or with more space around it, change those variables.)</p><p><figure class=inline-image><picture><img src=1_gridmapper_input_output.webp loading=lazy decoding=async alt="The basic structure of the page: what input we want and what output we produce." title="The basic structure of the page: what input we want and what output we produce." width=1190 height=432></picture><figcaption class=side-note><span>The basic structure of the page: what input we want and what output we produce.</span></figcaption></figure></p><p>The only important variable from now on is the <code>innerSize</code>, because that is the space we actually have for our elements.</p><h2 id=input-and-output>Input and Output</h2><p>Grids can be input in two different ways:</p><ul><li>The size of one element => the system calculates the dimensions from this</li><li>The dimensions (number of elements, horizontally and vertically) => the system scales the elements to fit</li></ul><aside class="example masked-link-block"><span class=label>Example ||</span><p>I might know the exact card size I want. I want to be able to input that <em>size</em> and let the system figure out how often it fits. At other times, I just want 5x5 tiles per page and don&rsquo;t care how large they are exactly.</p></aside><p>In other words, whatever input is given, it&rsquo;s always converted to <em>dimensions</em> first. All examples below, therefore, use that to calculate the other values.</p><p>The output is a list of positions and sizes to use when placing each element. (And to actually create the grid, we&rsquo;d just list through this data and actually <em>place</em> each element.)</p><h2 id=rectangles>Rectangles</h2><p>Let&rsquo;s start with the easy one and use that as the basic idea for the rest.</p><p>Given dimensions, how large can each element be? Divide the <code>innerSize</code> by the <strong>dimensions</strong>.</p><p>This works because rectangles are simple and predictable. When placing them, the distance to the next element is simply the size of the rectangle. Anything else, and you&rsquo;d have elements <em>overlap</em>, or waste space.</p><p>In other words: for rectangles the <strong>distance between elements</strong> is equal to the <strong>size of the element</strong>. This is <em>not</em> true for other grid types, which is where the problems will arise.</p><p><figure class=inline-image><picture><img src=2_gridmapper_rectangle_grids.webp loading=lazy decoding=async alt="Simple example of calculating values for a basic rectangular grid." title="Simple example of calculating values for a basic rectangular grid." width=1190 height=433></picture><figcaption class=side-note><span>Simple example of calculating values for a basic rectangular grid.</span></figcaption></figure></p><p>You might not want elements to be full size. Or maybe you want elements to fill all available space, but be <em>square</em>. This will lead to empty space not being filled.</p><p>As such, we need to calculate how much space we have left, and distribute that evenly to (center) align the elements.</p><ul><li>Calculate <code>spaceUsed</code> by multiplying the number of elements by their size</li><li>Subtract this from <code>innerSize</code> (the maximum space we have)</li><li>Divide <code>spaceUsed</code> by the number of elements, and now you have the space needed around each element. Add half of it in the front and you&rsquo;ve centered the element.</li></ul><p><figure class=inline-image><picture><img src=3_gridmapper_extra_spacing.webp loading=lazy decoding=async alt="How extra padding and spacing around elements (for centering) is calculated automatically." title="How extra padding and spacing around elements (for centering) is calculated automatically." width=1190 height=433></picture><figcaption class=side-note><span>How extra padding and spacing around elements (for centering) is calculated automatically.</span></figcaption></figure></p><p>This simple system powered my website for a good year, without issues, until I needed those other types of grids.</p><h2 id=triangles>Triangles</h2><p>For triangles to form a grid, they need to be equilateral. (All sides are equally long. You achieve this by placing the three points on a circle around the triangle&rsquo;s center.) Without that, they&rsquo;re not symmetric (both horizontally and vertically), which makes a grid impossible.</p><p>We can reuse the code above, and it&rsquo;d be fine. But we&rsquo;d waste a <em>lot</em> of space. If we turn every second triangle upside down, we can shove them closer together without overlap!</p><p>The question here is of course: <strong>how much can we move elements closer to another?</strong> Because the answer to this determines both our grid properties:</p><ul><li>How many elements fit in the width/height of the area</li><li>And how to place them exactly</li></ul><p>First, let&rsquo;s check how much space we can &ldquo;win&rdquo;. It&rsquo;s exactly <strong>half the element&rsquo;s size</strong>. It&rsquo;s not hard to judge this with the eye. You can also imagine two triangles combining to form one rectangle.</p><ul><li>The <strong>offset</strong> ( = space between elements) is half the size, not the whole size.</li><li>So, in the space of <code>1</code> element, we can actually place <code>2</code> elements.</li></ul><p>How do we use this? Given dimensions,</p><ul><li>Divide the dimensions by <code>2</code></li><li>Pretend these new dimensions are the amount of space we want to fill</li><li>Divide page size by these new dimensions to get element size</li><li>Place the elements at this size, <code>0.5 * size</code> apart.</li></ul><p>We &ldquo;fake&rdquo; the computer into thinking it works with rectangles of a certain size. But we calculate the values in such a way that it will line up precisely when we place <em>triangles</em> instead.</p><p>HOWEVER, there is one issue here. The thing that caused me to get stuck for such a long time and write this article.</p><p>Our calculations above would be entirely correct &mldr; if we didn&rsquo;t care about broken tiles. If we start the row with half a triangle, and end it with half a triangle, then yes, we can fit precisely 2 times as many tiles in that space.</p><p>But we don&rsquo;t want elements to be cut off. We need to calculate the amount that is cut off and <em>add</em> it to our fake dimensions. (So that it&rsquo;s taken into account <em>completely</em>.) In this case, it&rsquo;s literally half a triangle, so the number to add to our fake dimensions is <code>0.5</code>. Later on, we&rsquo;ll generalize this number for all shapes.</p><p><figure class=inline-image><picture><img src=4_gridmapper_triangle_grids.webp loading=lazy decoding=async alt="Explanation and example of calculating values for a triangle grid." title="Explanation and example of calculating values for a triangle grid." width=1488 height=432></picture><figcaption class=side-note><span>Explanation and example of calculating values for a triangle grid.</span></figcaption></figure></p><p>This way, we can reuse the simple code for rectangle grids for all the details (sizing, placement, etcetera). But the elements will be scaled to fit as much space as it can.</p><h2 id=circles>Circles</h2><p>When I say circular grid, I mean that the elements are circles. I don&rsquo;t mean a <em>radial</em> grid, where elements are <em>placed</em> in a circle. (That&rsquo;s pretty useless from a &ldquo;put material on a PDF&rdquo; standpoint, but very pretty for visual decorations and such.)</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>If your elements are ellipses, there&rsquo;s really nothing to be gained from circle grids. Just pretend they are rectangles and use that&mdash;because they <em>are</em> very close to rectangles, like rounded rectangles.</p></aside><p>This is the next step, because now we need to modify the grid both horizontally and vertically. (With the triangles, we only squished them horizontally, or on the X-axis.)</p><ul><li>Horizontally, the offset between elements is <code>sqrt(2) / 2</code> = <code>0.71</code> (relative to size)</li><li>Vertically, the offset is double that (because we can&rsquo;t overlap the other circle), so <code>sqrt(2)</code> = <code>1.41</code> (relative to size)</li></ul><p>The image below shows <em>where</em> this number comes from. (Application of the Pythagorean Theorem.)</p><p>This means that &mldr;</p><ul><li>Horizontally, in the space of <code>1</code> element, we can place <code>1.41</code> elements</li><li>Vertically, in the space of <code>1</code> element, we can place <code>0.71</code> elements. (This seems correct, because we LOSE space on the vertical axis.)</li></ul><p>Like before, we need to compensate for the element that&rsquo;s cut off.</p><ul><li>Normally, in a rectangular grid, the offset between elements is 1 ( = same as size).</li><li>The reason things get cut off, is because our offset is now some other number.</li><li>So the part that&rsquo;s cut off is the difference between the new offset and 1.</li><li>In other words: <code>1.0 - offset</code> is the remaining bit we&rsquo;re missing.</li></ul><p>Doing the same thing as before, our &ldquo;fake dimensions&rdquo; are</p><ul><li>Horizontally, (dimX / 1.41) + (1.0 - 0.71)</li><li>Vertically, (dimY / 0.71) + (1.0 - 1.41)</li></ul><p><figure class=inline-image><picture><img src=5_gridmapper_circle_grids.webp loading=lazy decoding=async alt="Explanation and example of calculating values for a circular grid." title="Explanation and example of calculating values for a circular grid." width=1490 height=496></picture><figcaption class=side-note><span>Explanation and example of calculating values for a circular grid.</span></figcaption></figure></p><p>But wait &mldr; wait wait wait &mldr; something isn&rsquo;t right yet. Every second column needs to be offset entirely. As you see in the image, the second circle (in each row) is pushed downward.</p><p>In other words, we actually need to fake out the algorithm one step further. We need to add <code>0.5 * offsetY</code> to our fake dims to account for that half-shape extra size on odd rows.</p><p>Everything else is the same. We use that to get &ldquo;fake&rdquo; dimensions, to get the actual size of elements, and use the offset we calculated for placing them. (The radius is, of course, half the element&rsquo;s size. And the fake dimensions do not need to be rounded, as the true dimensions still determine how many elements we place.)</p><h2 id=hexagons>Hexagons</h2><p>This is the final boss. Hexagons require a <em>different</em> offset change in both X and Y directions, and an offset for odd rows (like circles).</p><p>Fortunately, all logic from before still holds, so all we need to do is figure out how much space we can win (in the X and Y direction).</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>I&rsquo;ve always preferred the flat-top layout, so that&rsquo;s the only one I&rsquo;ll discuss and probably ever use. But you can obviously create pointy-top hexagons and swap the X and Y values.</p></aside><p>The new offsets between elements are &mldr;</p><ul><li>Horizontal = <code>3/4</code> = <code>0.75</code> (relative to size)</li><li>Vertical = <code>sqrt(3)/2</code> = <code>0.87</code> (relative to size)</li></ul><p>For any and all information about hexagons, always visit the <a href=https://www.redblobgames.com/grids/hexagons/>Red Blob Games</a> article, famous and revered among game developers ;)</p><p>This means that &mldr;</p><ul><li>Horizontally, in the space of <code>1</code> element, we can actually place <code>1.33</code></li><li>Vertically, in the space of <code>1</code> element we can actually place <code>1.15</code></li></ul><p>The fake dimensions become &mldr;</p><ul><li>Horizontally, (dimsX / 1.33) + (1.0 - 0.75)</li><li>Vertically, (dimsY / 1.15) + (1.0 - 0.87)</li></ul><p>On odd columns, add <code>0.5 * 0.87 * sizeY</code> to the Y coordinate.</p><p>The image below also provides an alternative way to see that &ldquo;cut off&rdquo; shape. Because we&rsquo;ve squished the shapes together, the <em>last</em> shape isn&rsquo;t included completely. That&rsquo;s why we need to add <code>1.0 - offset</code>, because that&rsquo;s the part (of that final shape) that is left out.</p><p><figure class=inline-image><picture><img src=6_gridmapper_hexagon_grids.webp loading=lazy decoding=async alt="Explanation and example of calculating values for a hexagon grid." title="Explanation and example of calculating values for a hexagon grid." width=1488 height=496></picture><figcaption class=side-note><span>Explanation and example of calculating values for a hexagon grid.</span></figcaption></figure></p><p>Hexagons are awesome&mdash;they&rsquo;re also the bane of my existence when it comes to developing games and grids around them.</p><h2 id=conclusion>Conclusion</h2><p>This article (hopefully) makes it very easy to follow what happens and/or implement it.</p><p>My journey towards figuring this out certainly wasn&rsquo;t that simple. I made many mistakes. I was stumped for a bit about how you could know the right size of elements, if you didn&rsquo;t know the dimensions, and vice versa. It felt like there was too little information. (I didn&rsquo;t realize the trick with faking the size yet.)</p><p>Then I was stuck on that leap about the &ldquo;missing part&rdquo; :p I just could not figure out why my calculations seemed <em>kinda</em> off, <em>some of the time</em>. Until I drew these pictures and visualized the process. Then I saw that the last parts were being cut off and I just had to add them back in. Two lines of code &mldr; retrieved after 4 hours of being frustrated and debugging <em>everything</em>.</p><p>It&rsquo;s hard to wrap your head around things like these. If my images weren&rsquo;t clear, tell me and I&rsquo;ll try to visualize it better.</p><p>But the simple values and steps above now power the GridMapper that&mdash;currently&mdash;creates nice PDFs for almost 10 completely different games with different tiles.</p><p>I even invented a game idea that utilizes <em>all</em> these grid types on purpose. You know, to stress test the system. (That game isn&rsquo;t available yet, because I only wrote the code to generate material and nothing else. But it will appear sometime in the future.)</p><p>Until next time,
Pandaqi</p></div></article><div><nav class=pagination><ul><li><a href=/blog/tutorials/deduction-boardgames-part-1-passive/ class="masked-link big-mask mask-3" style=--rotation:0.5deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><span class=nav-disabled>No next page :(</span></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/photomone-antsassins/>Photomone: Antsassins
(üêú)</a></li><li><a href=/blog/boardgames/photomone-digital-antists/>Photomone: Digital Antists
(üêú)</a></li><li><a href=/blog/boardgames/photomone/>Photomone
(üêú)</a></li><li><a href=/blog/boardgames/keebble-domino/>Keebble: Domino
(üìó)</a></li><li><a href=/blog/boardgames/keebble-knickknack/>Keebble: Knickknack
(üìò)</a></li><li><a href=/blog/videogames/game-jams/less-is-store/>Less is Store
(üõçÔ∏è)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-2023-update-iii/>Pandaqi Games: 2023 Update (III)
(üéÆ)</a></li><li><a href=/blog/tutorials/placing-grids-within-spaces/>Placing grids within spaces</a></li><li><a href=/blog/boardgames/thats-amorphe-pictures/>That's Amorphe: Pictures
(üñåÔ∏è)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-2023-update-ii/>Pandaqi Games: 2023 Update (II)
(üéÆ)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2023 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/bundle.min.js></script></body></html>