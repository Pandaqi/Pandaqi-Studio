<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Pandaqi Games: 2023 Update | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-2" style=--rotation:-0.5deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-6" style=--rotation:-0.5deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-8" style=--rotation:-1deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-6" style=--rotation:0deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-2" style=--rotation:2deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-1" style=--rotation:-0.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><h1>Pandaqi Games: 2023 Update</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/news-and-updates/>News and updates</a>
/
<a href=/blog/news-and-updates/pandaqi-games-2023-update/>Pandaqi games 2023 update</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/news-and-updates\/","name":"news-and-updates"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/news-and-updates\/pandaqi-games-2023-update\/","name":"pandaqi-games-2023-update"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2023-02-20T00:00:00>Monday, Feb 20, 2023</time></div><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#what-was-wrong>What was wrong?</a></li><li><a href=#introducing-pandaqi-tools>Introducing &ldquo;Pandaqi Tools&rdquo;</a></li><li><a href=#pandaqi-pdf>Pandaqi PDF</a></li><li><a href=#pandaqi-canvas>Pandaqi Canvas</a></li><li><a href=#pandaqi-phaser>Pandaqi Phaser</a></li><li><a href=#pandaqi-settings>Pandaqi Settings</a></li><li><a href=#other-improvements>Other improvements</a></li><li><a href=#where-are-we-now>Where are we now?</a></li></ul></nav></aside><div><p>The past few months, I&rsquo;ve updated all my websites in significant ways. Pandaqi Games was the main focal point. In this article, I&rsquo;ll explain <em>why</em> I made changes and <em>what</em> I changed exactly.</p><h2 id=what-was-wrong>What was wrong?</h2><p>Nothing specifically was <em>wrong</em>. All the interactive elements still worked. The system was already quite nice after my huge update a few years ago.</p><p>But &mldr; there was a long list of annoyances that I wanted to fix. Doing so became increasingly demotivating, because the code behind certain parts of the website was a hot mess.</p><p>The biggest issue were my <strong>board games</strong>. Many of them have interactive components, like &mldr;</p><ul><li>You can generate a random board to print and play with, right from the website</li><li>The game is a &ldquo;hybrid&rdquo;: you play with the help of a phone (or other device), which needs an interface and working game system of course</li><li>All of these allow toggling a bunch of settings on/off</li></ul><p>And all of that &mldr; was custom made for each game.</p><p>Each time, my requirements were slightly different. When I made those things, it was one big experiment. I didn&rsquo;t know what I was doing. And I certainly didn&rsquo;t know how to do it <em>well</em>.</p><p>The result? All games had <em>loads</em> of interconnected dependencies. I copy-pasted repetitive JavaScript like my life depended on it (it kind of did). And it was just cumbersome to find issues or add new games. Which is never good.</p><p>Now it&rsquo;s a few years down the line. I knew a full rewrite of that code was needed and I actually had the skill to do it.</p><h2 id=introducing-pandaqi-tools>Introducing &ldquo;Pandaqi Tools&rdquo;</h2><p>I decided to create a bundle of &ldquo;pandaqi tools&rdquo;. Just some JavaScript libraries that do <em>one thing</em> very well, which I can easily reuse in all games.</p><p>In the end, I created</p><ul><li><strong>PQ_PDF</strong>: can be used to create, edit and download a PDF (given canvases as input)</li><li><strong>PQ_CANVAS</strong>: can be used to create a new canvas and convert it to images (as well as some other useful edits, like splitting the canvas into multiple parts)</li><li><strong>PQ_PHASER</strong>: many of those games use the Phaser framework as the backend. This instantiates a Phaser game, makes sure the right things are visible/hidden, and handles all that.</li><li><strong>PQ_SETTINGS</strong>: this <em>automatically</em> reads &ldquo;settings blocks&rdquo; and saves them properly in local storage, to be used easily wherever I need those settings (such as the board generation code)</li><li>(<strong>PQ_WORDS</strong>: I&rsquo;ll write another article about this one, it&rsquo;s only tangentially related. But it&rsquo;s still a great and useful tool I built. It contains English word lists and allows me to randomly draw/query from them.)</li></ul><p>Together, these are merely 600 lines of code. Yet they allowed me to &mldr;</p><ul><li>Completely remove any custom (or repeated) code from all projects</li><li>Create images and PDFs in a much cleaner, more robust, and faster way</li><li>And <em>extend</em> these objects to allow more useful functionality (for now or the future)</li></ul><p>As a bonus, this revealed holes in my older logic and &ldquo;accidentally&rdquo; fixed issues.</p><h2 id=pandaqi-pdf>Pandaqi PDF</h2><p>This uses the excellent <a href=https://github.com/parallax/jsPDF>jsPDF</a> library. I reveal a class called <code>PdfBuilder</code>. Any code can instantiate one and, well, use it to build a PDF.</p><p>This is done by simply feeding it images, which it saves in an array.</p><p>When you call <code>downloadPDF</code> on it, it puts all those images into a PDF, then saves it. The code is pretty barebones, as that&rsquo;s all you really need.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// these properties are fed into the builder on creation
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>pdfConfig</span> <span class=o>=</span> 
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nx>unit</span><span class=o>:</span> <span class=s1>&#39;px&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nx>orientation</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>orientation</span><span class=p>,</span> 
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nx>format</span><span class=o>:</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>size</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>size</span><span class=p>.</span><span class=nx>height</span><span class=p>],</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nx>fileName</span><span class=o>:</span> <span class=nx>fileName</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=kr>const</span> <span class=nx>doc</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>window</span><span class=p>.</span><span class=nx>jspdf</span><span class=p>.</span><span class=nx>jsPDF</span><span class=p>(</span><span class=nx>pdfConfig</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=kr>const</span> <span class=nx>width</span> <span class=o>=</span> <span class=nx>doc</span><span class=p>.</span><span class=nx>internal</span><span class=p>.</span><span class=nx>pageSize</span><span class=p>.</span><span class=nx>getWidth</span><span class=p>();</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=kr>const</span> <span class=nx>height</span> <span class=o>=</span> <span class=nx>doc</span><span class=p>.</span><span class=nx>internal</span><span class=p>.</span><span class=nx>pageSize</span><span class=p>.</span><span class=nx>getHeight</span><span class=p>();</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=c1>// This simply places images, one per page, and creates a _new_ page each time after the first one
</span></span></span><span class=line><span class=ln>15</span><span class=cl><span class=c1>// DOC: addImage(imageData, format, x, y, width, height, alias, compression, rotation)
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>images</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span> <span class=nx>doc</span><span class=p>.</span><span class=nx>addPage</span><span class=p>();</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=nx>doc</span><span class=p>.</span><span class=nx>addImage</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>images</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=s1>&#39;png&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>width</span><span class=p>,</span> <span class=nx>height</span><span class=p>,</span> <span class=kc>undefined</span><span class=p>,</span> <span class=s1>&#39;FAST&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=nx>doc</span><span class=p>.</span><span class=nx>save</span><span class=p>(</span><span class=nx>pdfConfig</span><span class=p>.</span><span class=nx>fileName</span><span class=p>);</span></span></span></code></pre></div><p>The <em>compression</em> is key here. Without it, files are absolutely <em>huge</em>. Let&rsquo;s say you download a randomly generated board for one of my games (and split it), you&rsquo;re already looking at 4 full-color detailed A4 images at high-resolution.</p><p>Additionally, the PQ_PDF toolkit decides the <strong>resolution</strong> of all my games.</p><p>Previously, the PDF simply copied the resolution of the canvas. This was an A4 &mldr; but in pixels. Paper has a bigger size and higher resolution.</p><p>So, this object calculates a factor with which all canvases are scaled. The number <code>3.775</code> is how you convert pixels to millimeters. The number <code>1.66</code> was &mldr; found through experimentation. It&rsquo;s the point at which my end result looks crisp (and not <em>blurry</em> like before), without being overly huge or slow.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln>1</span><span class=cl><span class=kr>const</span> <span class=nx>factorDPI</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>devicePixelRatio</span> <span class=o>*</span> <span class=mf>3.775</span> <span class=o>*</span> <span class=mf>1.66</span><span class=p>;</span></span></span></code></pre></div><p>If anybody knows one simply function to call, which calculates the exact image resolution to get an A4 300 DPI PDF, let me know.</p><p>Anyway, the result of that? Finally all my generated images/PDFs are <em>clean</em> and <em>sharp</em> all the way through.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>I did have to go back to older games and &ldquo;recalibrate&rdquo; them. My first few hybrid board games, I didn&rsquo;t think to make proportions relative to canvas size. So now that canvases were ~2 times as big, the generation would get stuck or be too zoomed out. In those cases, I simply rewrote the code to make it relative to canvas size, and multiplied by a factor to get it looking like before.</p></aside><h2 id=pandaqi-canvas>Pandaqi Canvas</h2><p>This uses basic JavaScript code to create new canvases or turn a given canvas into an image.</p><p>There&rsquo;s only one caveat: it takes <em>time</em> for this conversion to happen and the new image to be loaded. As such, you can&rsquo;t immediately continue, but need to return a promise (and wait on the result).</p><p>So you get something like below. Any number of canvases can be given. They&rsquo;ll be converted to an image, and all the promises collected. Only once <em>all</em> promises have returned (and thus all image loaded and done), do we return those images from the function and continue.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>convertCanvasToImage</span><span class=p>(</span><span class=nx>canvas</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>		<span class=kd>let</span> <span class=nx>image</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>		<span class=nx>image</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>canvas</span><span class=p>.</span><span class=nx>toDataURL</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>
</span></span><span class=line><span class=ln> 6</span><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>			<span class=nx>image</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>				<span class=nx>resolve</span><span class=p>(</span><span class=nx>image</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>			<span class=p>};</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>convertCanvasesToImage</span><span class=p>(</span><span class=nx>canvases</span><span class=p>)</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=kr>const</span> <span class=nx>promises</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kr>const</span> <span class=nx>canv</span> <span class=k>of</span> <span class=nx>canvases</span><span class=p>)</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nx>promises</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>convertCanvasToImage</span><span class=p>(</span><span class=nx>canv</span><span class=p>));</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=kr>const</span> <span class=nx>values</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>promises</span><span class=p>);</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=k>return</span> <span class=nx>values</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Its other major feature is that it can <strong>split the board</strong>. A board the size of one A4 paper is just too small for many board games. This option allows you to print that board on multiple papers, which you then lay side by side. This often makes the game much easier to play and fun to look at</p><p>To do so, it &mldr;</p><ul><li>Only looks at one &ldquo;chunk&rdquo; of the original image (one subrectangle) at a time</li><li>And creates a new canvas for it, the same size as the original image.</li><li>Then draws the chunk to the new canvas. (Making this chunk twice the size, and being able to save it as its own image)</li><li>It waits again until all those images have loaded</li><li>And returns that</li></ul><p>It does a 2x2 split by default (into 4 papers, most useful and most common). But any split works.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>splitImage</span><span class=p>(</span><span class=nx>img</span><span class=p>,</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{})</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=kr>const</span> <span class=nx>cols</span> <span class=o>=</span> <span class=nx>params</span><span class=p>.</span><span class=nx>cols</span> <span class=o>||</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=kr>const</span> <span class=nx>rows</span> <span class=o>=</span> <span class=nx>params</span><span class=p>.</span><span class=nx>rows</span> <span class=o>||</span> <span class=mi>2</span><span class=p>;</span> 
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=kr>const</span> <span class=nx>totalParts</span> <span class=o>=</span> <span class=nx>cols</span> <span class=o>*</span> <span class=nx>rows</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=kr>const</span> <span class=nx>promises</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>totalParts</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=kd>var</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>i</span> <span class=o>%</span> <span class=nx>cols</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>    <span class=kd>var</span> <span class=nx>y</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>i</span> <span class=o>/</span> <span class=nx>cols</span><span class=p>);</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kd>let</span> <span class=nx>canv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s1>&#39;canvas&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=nx>canv</span><span class=p>.</span><span class=nx>width</span> <span class=o>=</span> <span class=nx>img</span><span class=p>.</span><span class=nx>naturalWidth</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=nx>canv</span><span class=p>.</span><span class=nx>height</span> <span class=o>=</span> <span class=nx>img</span><span class=p>.</span><span class=nx>naturalHeight</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=kr>const</span> <span class=nx>chunkX</span> <span class=o>=</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>width</span> <span class=o>/</span> <span class=nx>cols</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=kr>const</span> <span class=nx>chunkY</span> <span class=o>=</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>height</span> <span class=o>/</span> <span class=nx>rows</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=c1>// MAGIC HAPPENS HERE =&gt; this slices part of the image and draws it onto the canvas
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>    <span class=nx>canv</span><span class=p>.</span><span class=nx>getContext</span><span class=p>(</span><span class=s1>&#39;2d&#39;</span><span class=p>).</span><span class=nx>drawImage</span><span class=p>(</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=nx>img</span><span class=p>,</span> 
</span></span><span class=line><span class=ln>22</span><span class=cl>      <span class=nx>x</span><span class=o>*</span><span class=nx>chunkX</span><span class=p>,</span> <span class=nx>y</span><span class=o>*</span><span class=nx>chunkY</span><span class=p>,</span> <span class=nx>chunkX</span><span class=p>,</span> <span class=nx>chunkY</span><span class=p>,</span> 
</span></span><span class=line><span class=ln>23</span><span class=cl>      <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>width</span><span class=p>,</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>height</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>    <span class=kr>const</span> <span class=nx>loadPromise</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> 
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=kr>const</span> <span class=nx>tempImg</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>();</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>      <span class=nx>tempImg</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>toDataURL</span><span class=p>();</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>      <span class=nx>tempImg</span><span class=p>.</span><span class=nx>onload</span> <span class=o>=</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=nx>tempImg</span><span class=p>);</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>    <span class=nx>promises</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>loadPromise</span><span class=p>);</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl>  <span class=kr>const</span> <span class=nx>arr</span> <span class=o>=</span> <span class=kr>await</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=nx>promises</span><span class=p>);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>  <span class=k>return</span> <span class=nx>arr</span><span class=p>;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=pandaqi-phaser>Pandaqi Phaser</h2><p>This is still a bit of a mess. Because I have to balance <em>writing general code</em> with <em>interfacing with Phaser and doing the specific things it wants</em>.</p><p>It&rsquo;s also not that interesting. It simply creates a new Phaser game (using the default way to do that), then saves references to it (and its configuration). This way, you can turn that game into an image/PDF at any point, simply by passing on that reference to the PQ_CANVAS and PQ_PDF above.</p><h2 id=pandaqi-settings>Pandaqi Settings</h2><p>This was a huge improvement. It seems like such a simple thing, but it was actually tough to figure out a clean way to do this.</p><p>Before starting a (hybrid) game, or generating a board, you need to define your settings. (Player count, expansions, generation seed, whatever.)</p><p>The old website had a custom JavaScript block on <em>every game</em> to read those settings and put them in some format.</p><p>The new one uses this simple object to automatically <em>read and convert</em> the settings.</p><p>How does it work?</p><ul><li>Given any node within a settings block (usually the button you clicked), it bubbles upwards to find its container. With that, we can easily get other metadata or other settings</li><li>Collect all inputs</li><li>Add them to a configuration variable we&rsquo;re building</li><li>Save where we want to store it (in local storage)</li><li>And done</li></ul><p>I don&rsquo;t need to mess with IDs. Nor custom JavaScript. Everything is a simple Hugo shortcode on my gamepages and this all works automatically.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>Better than before, actually. I used to misspell stuff, or miss a setting entirely, or parse it wrong. Now I know: if this code works on one game, it&rsquo;ll work perfectly on all.</p></aside><p>This is what that code looks like (only slightly simplified for this guide).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>readFrom</span><span class=p>(</span><span class=nx>startNode</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=kr>const</span> <span class=nx>container</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>bubbleUpFrom</span><span class=p>(</span><span class=nx>startNode</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>container</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=p>{};</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=kr>const</span> <span class=nx>inputs</span> <span class=o>=</span> <span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>container</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>          <span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nb>Array</span><span class=p>.</span><span class=nx>from</span><span class=p>(</span><span class=nx>container</span><span class=p>.</span><span class=nx>getElementsByTagName</span><span class=p>(</span><span class=s2>&#34;select&#34;</span><span class=p>)));</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=kd>let</span> <span class=nx>cfg</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kr>const</span> <span class=nx>input</span> <span class=k>of</span> <span class=nx>inputs</span><span class=p>)</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kd>let</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>input</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>input</span><span class=p>.</span><span class=nx>type</span> <span class=o>==</span> <span class=s2>&#34;checkbox&#34;</span><span class=p>)</span> <span class=p>{</span> <span class=nx>val</span> <span class=o>=</span> <span class=nx>input</span><span class=p>.</span><span class=nx>checked</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addToConfig</span><span class=p>(</span><span class=nx>cfg</span><span class=p>,</span> <span class=nx>input</span><span class=p>.</span><span class=nx>id</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>
</span></span><span class=line><span class=ln>17</span><span class=cl>  <span class=nx>cfg</span><span class=p>.</span><span class=nx>localstorage</span> <span class=o>=</span> <span class=nx>container</span><span class=p>.</span><span class=nx>dataset</span><span class=p>.</span><span class=nx>localstorage</span><span class=p>;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>  <span class=k>return</span> <span class=nx>cfg</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=c1>// If an id has a second &#34;-&#34;, we create a subcategory for it
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1>// &#34;setting-expansions-blabla&#34; will create a key &#34;expansions&#34; first, 
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1>// which is an object that holds a key &#34;blabla&#34;
</span></span></span><span class=line><span class=ln>24</span><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>addToConfig</span><span class=p>(</span><span class=nx>cfg</span><span class=p>,</span> <span class=nx>id</span><span class=p>,</span> <span class=nx>val</span><span class=p>)</span>
</span></span><span class=line><span class=ln>25</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=nx>id</span> <span class=o>=</span> <span class=nx>id</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;-&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>id</span><span class=p>.</span><span class=nx>length</span> <span class=o>==</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>    <span class=kr>const</span> <span class=nx>subcat</span> <span class=o>=</span> <span class=nx>id</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=nx>id</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=nx>subcat</span> <span class=k>in</span> <span class=nx>cfg</span><span class=p>))</span> <span class=p>{</span> <span class=nx>cfg</span><span class=p>[</span><span class=nx>subcat</span><span class=p>]</span> <span class=o>=</span> <span class=p>{};</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=nx>cfg</span><span class=p>[</span><span class=nx>subcat</span><span class=p>][</span><span class=nx>key</span><span class=p>]</span> <span class=o>=</span> <span class=nx>val</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>id</span><span class=p>.</span><span class=nx>length</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>    <span class=kr>const</span> <span class=nx>key</span> <span class=o>=</span> <span class=nx>id</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>    <span class=nx>cfg</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=o>=</span> <span class=nx>val</span><span class=p>;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>36</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>
</span></span><span class=line><span class=ln>38</span><span class=cl><span class=kd>function</span> <span class=nx>bubbleUpFrom</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>  <span class=kd>let</span> <span class=nx>containerClass</span> <span class=o>=</span> <span class=s2>&#34;game-settings-container&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=nx>node</span><span class=p>)</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>    <span class=kr>const</span> <span class=nx>validContainers</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>getElementsByClassName</span><span class=p>(</span><span class=nx>containerClass</span><span class=p>);</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>validContainers</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nx>validContainers</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=nx>node</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>parentNode</span><span class=p>;</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>  <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl><span class=p>}</span>	
</span></span></code></pre></div><h2 id=other-improvements>Other improvements</h2><p>These tools are accessible anywhere. Which means that, for new games, I usually just have to invoke a few of them and I already have 90% working of what I need.</p><p>I used that moment to immediately add <em>more</em> tools I&rsquo;ll surely need. The most interesting ones are,</p><ul><li><strong>GridMapper</strong>: similar to the PdfBuilder. You can feed it canvases, and it will neatly <em>place</em> them in a grid on a page. This means I can just throw anything at it (like randomly generated cards for a card game). When I ask it to download the PDF, I&rsquo;ll find all of it efficiently and neatly arranged on pages!</li><li><strong>WrapText</strong>: I stole <a href=https://codepen.io/peterhry/pen/nbMaYg>this short algorithm</a> to allow wrapping text in the canvas element. My only modification was an extra argument that, if true, <em>centers</em> the text on the Y-axis.</li><li><strong>ResourceLoader</strong>: can load images (as one image or a spritesheet) and audio, for when I don&rsquo;t need or want the whole Phaser library for something. (It&rsquo;s a heavy file and some things it does simply work against me.)</li></ul><p>Surely, over time, more tools will be added. But this new system has allowed me to quickly get new games and prototypes up and running.</p><p>I can&rsquo;t state this enough. The biggest enemy of motivation and productivity is having this huge <em>mess of code</em> you need to wade through anytime you want to do something. By removing that, it&rsquo;s suddenly faster and more fun to make stuff again.</p><p>That&rsquo;s my lesson for other developers. Focus on learning how to remove the messiness and the annoyances from all your code&mdash;it will improve your life significantly.</p><h2 id=where-are-we-now>Where are we now?</h2><p>As I said, this library of tools is &ldquo;only&rdquo; 600 lines of code now. All board games (with any digital component) run on it, automatically, without any custom code on the pages themselves.</p><p>Additionally, this fixed some bugs in the process</p><ul><li>Resolution is higher; results are sharper</li><li>It is faster and scales properly</li><li>As long as my tools are correct, it will find the settings (and Phaser canvas) correctly</li><li>I actually understand all parts of this process, allowing me to iron out mistakes in thinking</li></ul><p>Visitors won&rsquo;t notice a thing, probably. But behind the scenes, this website just became a whole lot better and smoother.</p><p>I have a great stack of board game ideas I&rsquo;ve been dying to make. This was the thing holding me back. Let&rsquo;s hope you all get to enjoy those ideas in the (near) future :)</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>Oh, yeah, there was this absolutely infuriating issue with Phaser that printed the text in compeltely the wrong locations on some mobile devices. After checking my own code, again and again, I realized I did nothing wrong. I updated Phaser to the latest version and that issue finally fixed itself!</p></aside></div></article><div><nav class=pagination><ul><li><a href=/blog/news-and-updates/pq-midi/ class="masked-link big-mask mask-1" style=--rotation:-1deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><a href=/blog/news-and-updates/how-i-invented-interactive-rulebooks/ class="masked-link big-mask mask-1" style=--rotation:-0.5deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives/>Nine Lives
(üêà)</a></li><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives-math-meows/>Nine Lives: Math Meows
(üêà)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-how-to-prioritize/>Game Dev: How to prioritize?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-what-are-you-telling-players/>Game Dev: What are you telling players?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/the-summer-of-game-jams/>The Summer of Game Jams (2024)
(üí¨)</a></li><li><a href=/blog/boardgames/swiftsmash-saga/cookie-smasher/>Cookie Smasher
(üç™)</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-defold-engine/>My Thoughts on Defold Engine</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-phaser-3-engine/>My Thoughts on Phaser 3</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-godot-engine/>My Thoughts on the Godot game engine</a></li><li><a href=/blog/news-and-updates/no-more-play-store/>No More Play Store
(üì±)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>