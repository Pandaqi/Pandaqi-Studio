<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Git and the Horror of Newlines | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-8" style=--rotation:-1deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-1" style=--rotation:0.5deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-8" style=--rotation:-1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-5" style=--rotation:-0.5deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-3" style=--rotation:1deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-6" style=--rotation:-1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><h1>Git and the Horror of Newlines</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/news-and-updates/>News and updates</a>
/
<a href=/blog/news-and-updates/git-and-the-horror-of-newlines/>Git and the horror of newlines</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/news-and-updates\/","name":"news-and-updates"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/news-and-updates\/git-and-the-horror-of-newlines\/","name":"git-and-the-horror-of-newlines"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2024-05-15T00:00:00>Wednesday, May 15, 2024</time></div><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#attempt-1-clear-and-reset>Attempt #1: clear and reset</a></li><li><a href=#attempt-2-check-my-local-installation>Attempt #2: check my local installation</a></li><li><a href=#attempt-3-comparing-git-to-the-real-deal>Attempt #3: comparing Git to the real deal</a></li><li><a href=#git-and-newlines>Git and Newlines</a></li><li><a href=#how-do-we-fix-this>How do we fix this?</a></li><li><a href=#what-have-we-learned>What have we learned?</a></li></ul></nav></aside><div><p>A few days ago, I got the scare of my life. I had just pushed a <em>huge</em> update to the Pandaqi website, but when I checked it out &mldr; almost all the images and fonts were broken. No, even worse, <em>corrupted</em>.</p><p>Each resource could be <em>found</em> (as in, the path to it was correct). The server was running just fine, and any part <em>not</em> touched by this update was also still running fine. But everything that had been part of this update threw up loads of red errors (in the console) saying the image couldn&rsquo;t be decoded, the font couldn&rsquo;t be read, etcetera. Sometimes, images didn&rsquo;t display. At other times, they were completely <em>distorted</em>, twisted around or cut off in random places.</p><p>What was happening? The update <em>only</em> reorganized and added new files. It hadn&rsquo;t renamed any of them, it hadn&rsquo;t even removed anything, so old assets (from projects already published) were the <em>last</em> place where I expected trouble.</p><p>But now the entire website was broken, ugly and unusable. Both old and new projects, both images and fonts.</p><h2 id=attempt-1-clear-and-reset>Attempt #1: clear and reset</h2><p>Naturally, I simply tried the old &ldquo;turn it off and back on again&rdquo;. Clear whatever I can from the server, retry deployment. No, this changed nothing.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>Similarly, I cleared all my browser cache and opened an incognito window in a browser I never use&mdash;Microsoft Edge&mdash;to ensure cache/PWA wasn&rsquo;t messing with anything.</p></aside><p>The website is hosted on CloudFlare pages, which is smart about updates and does not reupload assets already on the server (if they haven&rsquo;t changed). In this case, however, I thought it was an issue. Because the assets <em>were there</em> (with the correct name, date of modification, etcetera) &mldr; it refused to reupload them without corruption. Whenever I rolled back, retried the update, cleared cache, it would keep saying it only uploaded ~200 files files out of the ~1000 assets it should have been.</p><p>I could not find such an option. Maybe it would be nice if CloudFlare added a button to completely &ldquo;clean&rdquo; the server, making the next commit entirely fresh and forcing it to upload <em>everything</em> from scratch. But alas, the option wasn&rsquo;t there&mdash;and it also wouldn&rsquo;t have been the solution.</p><h2 id=attempt-2-check-my-local-installation>Attempt #2: check my local installation</h2><p>Now I grew worried that it wasn&rsquo;t the fault of the CloudFlare server, but that the entire project/Git system was somehow corrupted.</p><p>I booted the Pandaqi website locally (which is 100x slower than building it on the server, by the way) and &mldr; it was all fine.</p><p>Of course it was fine! I literally developed on it this morning, finishing the huge update, and all images/fonts loaded (as usual) then.</p><p>Perhaps I&rsquo;d feared that <em>committing</em> changes to Git had somehow <em>made more changes</em> ( = corrupted the original files), but that wasn&rsquo;t the case. And that&rsquo;s a good thing, because otherwise I&rsquo;d have been screwed. I have very good habits when it comes to backup and version control, but it would still mean the past few days of work would have to be redone or restored/repaired with effort.</p><p>But no, all original files were fine and the website was very much not-broken on my own machine.</p><h2 id=attempt-3-comparing-git-to-the-real-deal>Attempt #3: comparing Git to the real deal</h2><p>So I started checking the assets in three different places: the server, Github and locally.</p><p>That&rsquo;s when the first hint at a solution came.</p><ul><li>The server had the exact same assets as Github. So yes, it was <em>not</em> a fault of CloudFlare, it had perfectly copied the Git installation as usual.</li><li>The file size was almost identical &mldr; but the Github/server ones were missing just a few <em>bytes</em>. As in, the entire image was still there, but it chopped off literally one or two binary characters inside and that&rsquo;s it. (That&rsquo;s enough to make images not load or only load halfway.)</li></ul><p>I browsed through the entire commit (in Github Desktop) until my suspicion was confirmed.</p><p>For <em>some</em> assets (like 75% of them), the &ldquo;diff&rdquo; showed that the file had lost 1 or 2 bytes. (For other assets, it correctly recognized they were still the same and/or just moved to a different folder.) The original on the left displayed fine, the &ldquo;new&rdquo; on the right was a broken image that wouldn&rsquo;t show.</p><p>And then, in a flash of insight, I remembered.</p><h2 id=git-and-newlines>Git and Newlines</h2><p>Only a week or two ago, Github Desktop had started <em>changing all the line endings</em> to CRLF again. Despite explicitly stating I didn&rsquo;t want it everywhere I could. Despite working with LF endings all the time and not wanting Git to mess with it in anyway. Somehow, an update broke that old setting that was working, and now it was converting all my newlines again on every commit.</p><p><em>What is CRLF and LF?</em> When it comes to text on a computer, there has to be some character that indicates a &ldquo;new line&rdquo; or &ldquo;line break&rdquo;. You&rsquo;d want this to be universal, so that different operating systems/computers will read a text file in the same way, instead of (say) missing all the newlines and just showing one wall of text.</p><p>Of course, some people invented the LF symbol and others the CR symbol (&ldquo;carriage return&rdquo;), and then others decided to just do BOTH (CRLF) to be safe anyway.</p><p>Well, I work in LF and don&rsquo;t want Git to mess with it. But a config setting (<code>autocrlf</code>) that defaults to <code>true</code> changes all the files to CRLF, no matter how often I set that to <code>false</code>. This is a lot of messing around with files <em>every single time</em>, wasted energy and disk space, and it&rsquo;s a stupid decision if you ask me.</p><p>Anyway, frustrated by this change, I decided to edit the <code>.gitattributes</code> file. By default, it has the following line and nothing else: <code>* text=auto</code>. I assumed this automatically detected <em>line endings</em> anyway, but something had just been broken in my computer or installation (as it so often miraculously does).</p><p>I found a simple snippet online that said <code>* text eol=lf</code>. I added that after the first line.</p><p>It worked! It stopped converting it all the time! So I left it in and continued.</p><p>I had, however, made a <em>very stupid mistake</em>.</p><p>I&rsquo;d assumed those asterisks &mldr; were to create a <em>list</em> :p Like in Markdown, you put an asterisk before every line, and it&rsquo;s interpreted by the computer as a <em>list</em> of connected things.</p><p>Of course it wasn&rsquo;t. Here&rsquo;s what that added line actually means.</p><ul><li>The asterisk (<code>*</code>) means &ldquo;select everything&rdquo;</li><li>Then <code>text</code> means &ldquo;treat our selection as text files&rdquo;</li><li>And <code>eol=lf</code> means &ldquo;force LF line endings on our selection&rdquo;</li></ul><p>Of course, if you select <em>everything</em> &mldr; it means Git will assume <em>everything</em> is text and needs LF endings. Even images. And fonts. And audio files. All <em>binary files</em>, which are corrupted/broken if even a single bit is changed, are <em>also</em> treated as text and stripped of anything that resembles the wrong newline characters.</p><p>So that&rsquo;s what had happened. All my assets were being stripped of newlines as if they were <em>text</em>, corrupting almost all of them.</p><p>At this point, it was nearly 2 AM and I&rsquo;d been debugging/researching this issue for <em>hours</em>. (I&rsquo;d also lost access to my computer now, as somebody else was sleeping in my work room, so I was now just Googling on my phone in the living room.) Realizing this, I was 99% sure this was the solution, and I went to bed eager to fix it the next morning.</p><h2 id=how-do-we-fix-this>How do we fix this?</h2><p>First of all, we remove the troublesome line. Instead, I should&rsquo;ve simply amended the first line: <code>* text=auto eol=lf</code></p><p><em>That&rsquo;s</em> what <code>text=auto</code> does. It <em>automatically</em> detects if something is a text file or a binary file. That&rsquo;s why it&rsquo;s the only thing in the <code>.gitattributes</code> folder by default and the only thing most people will ever need.</p><p>Now we select &ldquo;only text files&rdquo; and change line endings to LF.</p><p>Just to be sure, however, I still <em>manually</em> told Git that all my asset types were binary. Just to be sure this never happens again, and it probably makes Git slightly faster because it doesn&rsquo;t have to <em>read</em> the file contents and <em>check</em> if it&rsquo;s binary.</p><p>For example, you can add <code>*.webp binary</code> in that attributes file. This says &ldquo;any file name + webp extension = binary file, don&rsquo;t touch it&rdquo;.</p><p>And then we get to 3 very <em>fortunate</em> situations that made the repair &ldquo;easy&rdquo;.</p><ul><li>This change by Git is <em>only</em> done for the commit. It doesn&rsquo;t change any newlines on your local installation&mdash;it doesn&rsquo;t change the actual files&mdash;it only modifies them when pushed to Git. As such, all the original files were <em>not</em> corrupted and didn&rsquo;t need replacing or repairing.</li><li>I have a 2-step system in which I develop projects in a dev environment, and then just cut-paste the entire folder to the real website once done. This means the files are considered &ldquo;new&rdquo; to Git when I move them from &ldquo;developing&rdquo; to &ldquo;finished&rdquo;, which means any previously corrupted files should be committed properly from that moment, and all other upcoming projects should be fine.</li><li>I&rsquo;d combined this HUGE update into one focused commit, also adding a few other big changes into it.</li></ul><p>This means I only had to <em>rollback</em> the Git installation by one commit. (Go to the folder in the command line, type <code>git reset HEAD^</code>. Or copy the ID/Hash of the commit before it and type <code>git reset &lt;id></code>.)</p><p>This is a soft reset, which means it &ldquo;forgets&rdquo; you committed the changes, but all the files are <em>unchanged</em>. Essentially, it just allows me to do the exact same commit <em>again</em>.</p><p>But this time, with the proper <code>.gitattributes</code>, it did no conversion and all assets were left alone. By turning off conversion, committing indeed became <em>much</em> faster. (The first time I did it, with the wrong settings, it took minutes to convert and apply ~1000 file changes. This time, it was done in a few seconds.)</p><p>Now we have our final issue: the Github public repository is in a <em>different</em> state than my local one. Fortunately, nothing and nobody depends on its history being clean, and the public state is <em>100% wrong</em>. So I can just <code>git push --force</code> to forcefully override the public repository with my local one.</p><p>After all that, CloudFlare Pages built the website, and a minute later I could breathe a sigh of relief. Everything worked again. Nothing corrupted, nothing ugly, nothing modified while I explicitly told it not to.</p><h2 id=what-have-we-learned>What have we learned?</h2><p>Firstly, don&rsquo;t just copy code from a stranger online and assume you know what it does :p If I&rsquo;d just researched how <code>.gitattributes</code> works for 5 more minutes, I&rsquo;d have caught the mistake far earlier and never made it. Even if a solution was correct for the one <em>asking</em> it, or in one situation (such as a website with ONLY text files, no binary), it might not be for you.</p><p>Secondly, tight version control and backups is very nice. After overcoming my initial fear/surprise from the bricked website, I could handle it quite easily knowing I had all files backed up and could just rollback to the previous commit to keep the website working for now. All in all, I only &ldquo;wasted&rdquo; a few hours, which taught me <em>a lot</em> about Git, CloudFlare pages, Hugo (the static website generator that I use), etcetera.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>For example, I learned there&rsquo;s a 20,000 file limit to CloudFlare Pages, no matter your plan. Seeing the speed at which I developed projects and how many files a single game can need &mldr; I grew worried for a second. But at the moment, Pandaqi has &ldquo;only&rdquo; 4,000 files, partially because I was accidentally smart about cleanup.</p></aside><p>Thirdly, newlines are a mess. I&rsquo;ve been working with computers for 15+ years now, and there have been SO MANY ugly errors, crashes, bugs, whatever just because of fucking <em>newlines</em> and how they can&rsquo;t decide what they want and nobody can decide what to do. That&rsquo;s <em>exactly</em> why I wanted Git to <em>not mess with them</em> and let me have full control, making them all LF. But Github Desktop forces auto-updates on you, even if that regularly breaks stuff, and that&rsquo;s probably how it turned <code>autocrlf</code> back on.</p><p>(With currently no way to turn it off for me, apparently. I&rsquo;ve changed the global config, the Github Desktop config, EVERYTHING. It insists on converting to CRLF unless I do my <code>.gitattributes</code> change for every single project, which I don&rsquo;t feel like doing.)</p><p>Fourthly (?), perhaps don&rsquo;t make huge commits or updates when you&rsquo;re really tired at the end of the day. I don&rsquo;t know what on earth I was thinking about that asterisk (<code>*</code>) being a simple <em>listing symbol</em>, when I know full well that it&rsquo;s used as a wildcard &ldquo;select all&rdquo; in basically any language. It&rsquo;s just a ridiculous oversight that I would never have made at any other time, and I&rsquo;m lucky I only had the &ldquo;wrong&rdquo; attributes for a few weeks and could solve it without too much danger.</p><p>Anyway, that&rsquo;s my story about the corrupted update and Git newlines. This version was only online for like 30&ndash;60 minutes. But if you visited the site then and thought it was ugly or unusable, well, this is the reason. (And perhaps clear your cache/refresh the website, as some of that corrupted data might still be served the coming days/weeks.)</p><p>Until next time, hopefully about something more fun,</p><p>Pandaqi</p></div></article><div><nav class=pagination><ul><li><a href=/blog/news-and-updates/pandaqi-games-2024-update/ class="masked-link big-mask mask-2" style=--rotation:-1deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><a href=/blog/news-and-updates/pandaqi-games-2024-update-ii/ class="masked-link big-mask mask-1" style=--rotation:0.5deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives/>Nine Lives
(üêà)</a></li><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives-math-meows/>Nine Lives: Math Meows
(üêà)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-how-to-prioritize/>Game Dev: How to prioritize?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-what-are-you-telling-players/>Game Dev: What are you telling players?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/the-summer-of-game-jams/>The Summer of Game Jams (2024)
(üí¨)</a></li><li><a href=/blog/boardgames/swiftsmash-saga/cookie-smasher/>Cookie Smasher
(üç™)</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-defold-engine/>My Thoughts on Defold Engine</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-phaser-3-engine/>My Thoughts on Phaser 3</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-godot-engine/>My Thoughts on the Godot game engine</a></li><li><a href=/blog/news-and-updates/no-more-play-store/>No More Play Store
(üì±)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>