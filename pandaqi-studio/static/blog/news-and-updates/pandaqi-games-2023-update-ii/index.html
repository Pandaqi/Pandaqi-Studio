<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Pandaqi Games: 2023 Update (II) | Pandaqi Blog</title><link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-6" style=--rotation:1deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-1" style=--rotation:2deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-1" style=--rotation:0deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-5" style=--rotation:1deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-4" style=--rotation:-1deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-4" style=--rotation:2deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><h1>Pandaqi Games: 2023 Update (II)</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=https://pandaqi.com/blog/news-and-updates/>News and updates</a>
/
<a href=https://pandaqi.com/blog/news-and-updates/pandaqi-games-2023-update-ii/>Pandaqi games 2023 update ii</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/pandaqi.com\/blog\/news-and-updates\/","name":"news-and-updates"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/pandaqi.com\/blog\/news-and-updates\/pandaqi-games-2023-update-ii\/","name":"pandaqi-games-2023-update-ii"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2023-04-08T00:00:00>Saturday, Apr 8, 2023</time></div><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#the-old-system>The old system</a></li><li><a href=#the-new-system>The new system</a></li><li><a href=#the-new-system-taken-further>The new system, taken further</a></li><li><a href=#other-surprising-benefits>Other surprising benefits</a></li><li><a href=#miscellaneous>Miscellaneous</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside><div><p>A few months ago, I already <a href=/blog/news-and-updates/pandaqi-games-2023-update>wrote an article</a> about a huge update to Pandaqi games. Behind the scenes, lots of code was removed and improved, leading to the creation of a few &ldquo;tools&rdquo; that handle everything for all pages.</p><p>A great, great improvement. It allowed me to create 5+ polished, finished games in the mean time.</p><p>But still not enough. Because I didn&rsquo;t entirely know what I was doing, I introduced some unnecessary complexity (or annoyances).</p><p>For example, I presumed the tools would be so small, that they&rsquo;d just stay inside their own file. Simply load that file when needed, and you&rsquo;re done. As you&rsquo;d expect, my list of tools grew and grew, until putting everything in one file (or under one name) was just stupid.</p><p>I learned that Hugo (a static website generator, the system I use for all my websites) can actually bundle, build <em>and</em> minify your assets! This means that I can &mldr;</p><ul><li>Write each tool as an actual library: with small modules doing one thing, importing/exporting where needed.</li><li>Don&rsquo;t need more work (manually or through code) for this bundling and minifying. (In fact, this new of doing things made my whole set of libraries around 50% smaller in terms of file size.)</li><li>Publish these tools on GitHub, because now they&rsquo;d be (more) usable for others.</li><li>(Don&rsquo;t have to pollute the global scope.)</li></ul><h2 id=the-old-system>The old system</h2><p>These were the tools available on my website</p><ul><li>Phaser (not mine) => the great Phaser library for creating web games/images</li><li>jsPDF (not mine) => used to create downloadable PDFs</li><li>seedrandom (not mine) => for seeded random numbers, to recreate random board states</li><li>PQ_PDF</li><li>PQ_CANVAS</li><li>PQ_PHASER</li><li>PQ_SETTINGS</li><li>PQ_TOOLS</li></ul><p>Yes, all these were global scope (so I&rsquo;d say <code>window.PQ_CANVAS = &lt;the object></code>). I&rsquo;m ashamed of myself as well. But it&rsquo;s alright, I didn&rsquo;t know where this was going and already planned to revise it a few months later. (I just needed it done quickly for the launching/testing of a new game.)</p><p>Each game page can indicate which of these files they want (with an array in the frontmatter). Hugo bundles that into one (minified) JS file, and that powers the game.</p><p>It&rsquo;s a somewhat smart system. It means games won&rsquo;t load JS they don&rsquo;t need, yet it takes me almost no effort to clearly indicate what a game needs.</p><p>But then I took a more critical look at my current and future needs.</p><h2 id=the-new-system>The new system</h2><p>The biggest issue had to do with duplicate files. You see, Hugo only knows about resources in the <code>assets</code> folder if you reference/use them in templates. Otherwise, they&rsquo;re not copied to the final website.</p><p>Many of my game pages are <em>not</em> processed by Hugo. They&rsquo;re plain, custom HTML, on a separate page. So &mldr; they don&rsquo;t know about these libraries. I had to keep duplicates of all libraries, one in <code>assets</code> and one in <code>static</code>. (The static folder is just copied entirely, without modification, to the final website. As the name implies, it&rsquo;s for static assets that things will need all over the place.)</p><p>This is obviously a stupid system. But I saw no (clean) workaround a few months ago.</p><p>Other important observations were &mldr;</p><ul><li>All my games <em>can</em> export PDF, and most do so by default. As such, there was no instance where I needed my tools, but did not need the jsPDF library. No instance where I need PQ_CANVAS, but don&rsquo;t need PQ_PDF. In other words, we can simply <strong>build</strong> everything that belongs together (99% of the time) into one library to load everywhere.</li><li>Only two things clearly stand on their own, and are often not needed: Phaser and PQ_TOOLS.<ul><li>Not all games generate a random board (or use Phaser any other way). This is significant, because the Phaser library has a huge file size. That&rsquo;s also why I&rsquo;m moving away from it more and more, because I only need a tiny <em>fraction</em> of what it does.</li><li>Similarly, PQ_TOOLS has helper functions for specific types of games or situations.</li></ul></li><li>The seedrandom library is tiny :p Like, not even 2 kB. There&rsquo;s nothing to gain from forcing myself to <em>manually specify when I need it</em>. Just include it with the tools, always.</li><li>Creating new bundles (with one javascript file more or less) for all games is just nonsense now. Let&rsquo;s include these tools everywhere, by default.</li></ul><p>As a result, I was left with four tools.</p><ul><li>Phaser => a <em>toggle</em> to turn on or off (in my frontmatter)</li><li>PQ_TOOLS => a <em>toggle</em> to turn on or off</li><li>PQ_WORDS => a <em>toggle</em> to turn on or off (this is my dictionary library, pretty large, so let&rsquo;s not include that when not needed)</li><li>PQ_CANVAS => included everywhere, handles all related matters</li></ul><p>Why did I turn them into toggles?</p><ul><li>So I don&rsquo;t need to retype the same path to the same JavaScript file every time :p</li><li>So I can use Hugo to build, minify and cache these tools &mldr;</li><li>&mldr; and make them available to everyone, which you can apparently do by simply typing <code>.Publish</code> behind the created resource. (It &ldquo;publishes&rdquo; the resource to the static folder, available to all.)</li></ul><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>Sometimes, you wonder why the simple solutions to your problems where nowhere to be found when you Googled a few months ago.</p></aside><p>In other words, I merely have to work on my library in the assets folder, and Hugo automatically builds it and makes it available to whatever needs it. It saves me tons of work. It allows better coding practices, with small modules and import/export. (And Hugo actually does strong &ldquo;tree shaking&rdquo; and such, which is why my libraries became that much smaller.)</p><h2 id=the-new-system-taken-further>The new system, taken further</h2><p>The same was true for custom JS files. Almost every project has 1&ndash;3 custom javascript files that handle the actual <em>specifics</em> of the game. I, again, had to</p><ul><li>Specify these by hand in the frontmatter</li><li>(Specify them again when used elsewhere, like a separate &ldquo;game page&rdquo; for the game.)</li><li>And saw no easy way to bundle/minify them</li></ul><p>Now I know better. Each game already has these files neatly organized into a <code>js</code> subfolder.</p><p>Now the website automatically does this:</p><ul><li>Check if that folder exists.</li><li>If so, bundle, build and minify all files in there.</li><li>Publish that under a consistent, nice name.</li><li>So I can simply reference that file anywhere else I need it.</li></ul><p>This (again) reduced the overall file size by roughly 50%, and the number of custom files to load to &mldr; 1.</p><p>In other words, I tracked the page of the newest game I&rsquo;m working on right now and it</p><ul><li>Started with 8 separate JavaScript files to load, which came out at roughly 150 kB</li><li>Ended with 2 JavaScript files (the general tools + the custom scripts) at roughly 65 kB</li></ul><p>Yeah, I&rsquo;m glad I didn&rsquo;t let this get out of hand and continue the old system. (Although I always aim to stay small and lean, so it&rsquo;s not like my pages were that big or slow before.)</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>This did have some nasty side effects, though. Sometimes, I explicitly left out one script somewhere else because it wasn&rsquo;t needed. When these get included&mdash;automatically&mdash;in these bundles, some games started crashing because it couldn&rsquo;t find some global object or required extra library. I spent a messy few hours checking all the games and implementing fixes here and there.</p></aside><p>Each game&mdash;out of all the 50+ projects I&rsquo;ve made&mdash;has one of the following structures:</p><ul><li>It needs no JS</li><li>It needs JS for a random board</li><li>It needs JS for a game interface</li><li>It needs JS for <em>both</em> a board and game interface</li></ul><p>As such, I added two toggles: one for the board (files saved in the folder called <code>js</code>), and one for the game (files saved in the folder called <code>js_game</code>). Turning these on or off automatically does all the bundling, minifying, etcetera.</p><p>This pattern fits the website so well, that I could make the switch within 30 minutes, and update all old projects to work again. But now they all reference 1 or 2 bundled files, very efficiently, instead of 8 separate files all located in the same <code>js</code> folder :p</p><p>You might say: <em>well what if you need something else in the future? A system that has two different game interfaces, for example?</em></p><p>To me, this is a case of &ldquo;restrictions are good&rdquo;. I decided to limit the system this way <em>on purpose</em>. Think about it: you visit a game page, and there are 3 (or more) completely different systems there. Isn&rsquo;t that overwhelming? How large would such a page be? I can&rsquo;t even fathom a project that <em>needs</em> that.</p><p>As such, if that ever happens, I know I&rsquo;ve gone too far and need to simplify my ideas. Or split the project into two separate ones. Instead of overcomplicating my code to support more and more systems.</p><h2 id=other-surprising-benefits>Other surprising benefits</h2><p>I&rsquo;ve always hated how the <em>order</em> of JavaScript files was crucial on some projects. That just shouldn&rsquo;t be the case.</p><ul><li>If one of them doesn&rsquo;t load, or I misplace the order by accident, nothing works.</li><li>But most importantly: it meant I could not load the assets <em>asynchronously</em>, or <em>defer loading</em>.</li></ul><p>This means people had to wait until that blob of JavaScript files had loaded before the page became really responsive/usable/final. It also meant they were loaded one at a time.</p><p>With these changes, all JavaScript is combined into a single bundle. This means I <em>can</em> enable these extras! So I simply changed all these JavaScript links to add <code>async</code> and <code>defer</code> to them. This means they now all load in parallel, as fast as possible, while you can already see and use the page.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>This did mean I had to add an extra line of code to all my board generation code. Instead of initializing immediately&mdash;because I knew the Phaser library was already loaded before, manually&mdash;I had to wait until the <code>onload</code> event. But that&rsquo;s a very small price&mdash;5 minutes of edits across the website&mdash;to pay for such speedups.</p></aside><p>An extra benefit of <em>building</em> my JavaScript, is the fact that the build system can catch obvious errors. Quite regularly, after porting a game and firing up Hugo &mldr; it reported ~5 errors with the code. Errors I never caught, either because they&rsquo;re rare, or they&rsquo;re soft fails (yes, it&rsquo;s a bug, but the program continues with mostly the right behavior).</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>The most common error, though, was a stupid one. I created a variable as a constant, with <code>const</code>. But then I changed it later in the code, which means it can&rsquo;t be a constant :p An easy thing for the computer to catch, but apparently harder for me.</p></aside><h2 id=miscellaneous>Miscellaneous</h2><p>I took this opportunity to properly port some of the latest game interfaces to this new system. (By which I mean: tiny modules that get build, instead of a large script that exposes global variables.)</p><p>Most notably, I&rsquo;ve wondered for about a year why on <em>earth</em> I made the game interface for <a href=https://pandaqi.com/timely-transports>Timely Transports</a> completely in Phaser. It has only caused me trouble. Such an interface would be 100% easier to make in plain HTML and CSS&mdash;and doing so would allow me to integrate it with my existing tools, because it&rsquo;s currently <em>the only thing left</em> running on its own scripts.</p><p>Which means &mldr; sigh, I have to take a day off regular work to completely rewrite this game interface. But it&rsquo;s all for a good cause. (I still remember how glad I was when <a href=https://pandaqi.com/wondering-witches>Wondering Witches</a> finally had a solid, clean, modern codebase behind it.)</p><p>I also took a long look at my &ldquo;pirate games&rdquo;. I made two, with a plan to make <em>five</em>. As such, my website has a custom tool (&ldquo;PQ PIRATE&rdquo;) for <em>these games specifically</em>.</p><p>The others never quite appeared, however. Because, as you&rsquo;d expected, I was quite done with making very similar games back-to-back. Should I remove custom support for this custom tool?</p><p>After some consideration, I decided to keep it. The other ideas are still quite solid and I hope to make them soon. And with the new system, it didn&rsquo;t take many changes to integrate &ldquo;PQ PIRATE&rdquo; with the automatic builds as well.</p><p>In the same vein, <a href=https://pandaqi.com/starry-skylines>Starry Skylines</a> was basically completely rewritten. Much faster, much cleaner, much easier to use (both for me and my players). I also plan to make a <em>physical</em> version of that game, now that I know how to generate material (to print) on the fly :) But that&rsquo;s for the future.</p><p>I think that covers everything I did?</p><h2 id=conclusion>Conclusion</h2><p>Looking back, you always wonder how your younger self could be so stupid. Even if that younger self is from less than half a year ago :p</p><p>I just didn&rsquo;t know Hugo could do all this. I didn&rsquo;t know how much I needed certain things, and <em>not</em> needed other things.</p><p>Now I&rsquo;ve seen the patterns in my work, in the JavaScript build systems, and have a better picture of what&rsquo;s needed. This update makes my life <em>so</em> much easier. (And Hugo generates my website nearly 10x as fast as before. Also a bonus.)</p><p>No duplicate code. No manually minifying or bundling. No sub-optimal coding practices because my system can&rsquo;t handle anything else. Everything in one place, everything updated immediately, and the website only became <em>smaller</em> and <em>faster</em>.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>So yes, I also planned to do the same thing for my other Hugo websites that rely on some huge JS tools. Especially <a href=https://pandaqi.com/tutorials>Pandaqi Tutorials</a> has some major interactive tools&mdash;for some of the bigger courses&mdash;that would like this new system.</p></aside></div></article><div><nav class=pagination><ul><li><a href=/blog/news-and-updates/pq-daw/ class="masked-link big-mask mask-8" style=--rotation:2deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><a href=/blog/news-and-updates/pandaqi-games-2023-update-iii/ class="masked-link big-mask mask-1" style=--rotation:1.5deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/kingseat/>Kingseat
(üëë)</a></li><li><a href=/blog/boardgames/foldigami/>Foldigami
(üìÉ)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-the-big-typescript-update/>Pandaqi Games: The Big Typescript Update
(üéÆ)</a></li><li><a href=/blog/boardgames/sixpack/>Sixpack
(üÉè)</a></li><li><a href=/blog/boardgames/photomone-antsassins/>Photomone: Antsassins
(üêú)</a></li><li><a href=/blog/boardgames/photomone-digital-antists/>Photomone: Digital Antists
(üêú)</a></li><li><a href=/blog/boardgames/photomone/>Photomone
(üêú)</a></li><li><a href=/blog/boardgames/keebble-domino/>Keebble: Domino
(üìó)</a></li><li><a href=/blog/boardgames/keebble-knickknack/>Keebble: Knickknack
(üìò)</a></li><li><a href=/blog/videogames/game-jams/less-is-store/>Less is Store
(üõçÔ∏è)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2023 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/bundle.min.js></script></body></html>