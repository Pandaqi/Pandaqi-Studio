<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>The Dangers of Desynchronized | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-3" style=--rotation:-1deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-5" style=--rotation:0.5deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-1" style=--rotation:1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-1" style=--rotation:-1.5deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-5" style=--rotation:-1deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-1" style=--rotation:-1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><h1>The Dangers of Desynchronized</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/news-and-updates/>News and updates</a>
/
<a href=/blog/news-and-updates/2024/>2024th</a>
/
<a href=/blog/news-and-updates/2024/the-dangers-of-desynchronized/>The dangers of desynchronized</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/news-and-updates\/","name":"news-and-updates"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/news-and-updates\/2024\/","name":"2024"}},{"@type":"ListItem","position":6,"item":{"@id":"\/blog\/news-and-updates\/2024\/the-dangers-of-desynchronized\/","name":"the-dangers-of-desynchronized"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2024-10-10T00:00:00>Thursday, Oct 10, 2024</time></div><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents></nav></aside><div><p>Not too long ago, I made a very simple party game called <a href=https://pandaqi.com/slippery-slopes/>Slippery Slopes</a>. I made it rather quickly in a single weekend, but it turned out okay.</p><p>Good enough, in fact, that I made a <em>digital</em> version too that very same weekend. Now you could also play the game by visiting the page on my website!</p><p>All was well, so I pushed the game to be launched a few months in the future and continued with my life.</p><p>Until the game &ldquo;launched&rdquo; and &mldr; it was completely broken.</p><p>You see, the <em>entire</em> idea of the game is that you get randomized sliders (a scale between two extremes, such as &ldquo;hot &lt;-> cold&rdquo;) and must <em>communicate a word</em> by setting the sliders. Maybe you get the word &ldquo;pizza&rdquo;, so you&rsquo;d probably set that slider more towards &ldquo;hot&rdquo;.</p><p>Those sliders are drawn dynamically. You press the button to start/reload the sliders, and it draws 4 of them right there using the HTML5 Canvas element.</p><aside class="remark masked-link-block"><span class=label>Remark ||</span><p>Why? Because it&rsquo;s much faster and less boring than drawing them by hand and loading those images. Also because the sliders are somewhat randomly generated, with different extremes, colors, optional actions on them, etcetera.</p></aside><p>Well, when I checked out the game on my public website, those sliders <em>did not appear</em>. They were drawn behind the scenes, there were no errors, everything <em>should</em> be working &mldr; but it didn&rsquo;t.</p><p>It all worked fine on my <em>development</em> branch of the website. Which should have the same code behind the scenes as the <em>public</em> one. So the first thing I did was check if there was any mistake there and I&rsquo;d accidentally completely differentiated the two&mdash;but I hadn&rsquo;t.</p><p>Okay. So what could it be?</p><p>I check the code, step by step, using the old &ldquo;explain your code to a rubber duck&rdquo; method to catch any oversights. But nothing seems out of place.</p><p>In fact, the material generator of the board game version (the original <em>Slippery Slopes</em>) is fine! I can press the button, wait a few seconds, and it spits out a PDF with 50 perfectly drawn sliders.</p><p>Both these versions obviously use the exact same code/object for the sliders, with <em>no</em> difference at all. The interactivity of the digital version is merely a layer on top, <em>adding</em> listeners for clicks and changes to this slider image.</p><p>I am completely baffled. I try, and I debug, and I change, and I rewrite, but the sliders just <em>will not show up</em> in the digital version. I only get back an empty canvas every time, even when I turn off ALL drawing commands and do a simple &ldquo;make the entire canvas black&rdquo; line of code.</p><p>At this point, I&rsquo;m pulling my hair out and punching a few walls. This is stupid! I&rsquo;ve wasted <em>hours</em> on a bug that leaves absolutely no clues! A bug in code that, when run by different games, but still the <em>exact some code</em>, works fine in one instance and breaks 100% in the other case.</p><p>Until, after all this debugging, I&rsquo;ve <em>finally</em> found a possible way out.</p><p>My game studio website has a large set of tools (or libraries) that I&rsquo;ve developed myself and reuse in almost all games. One of those is a simple function <code>createContext(params)</code> that initializes a canvas element, following some extra parameters or setup that I often need, then returns the <em>context</em> that I can immediately use for drawing stuff to it.</p><p>Well &mldr; when I remove that function and just create a barebones canvas and context myself (using <code>document.createElement("canvas")</code> and <code>canvas.getContext("2d")</code>) it <em>works</em>! It&rsquo;s the only way that I actually get back something visible!</p><p>But why? <em>Why!?</em> I spend another 30 minutes checking my helper function, but there&rsquo;s nothing odd there. It&rsquo;s a really small function that works perfectly fine for the 50+ other games that use it, so why would it break now?</p><p>And then I spot something funny.</p><p>In that function, it sets parameters for the context. For example, you can set <code>willReadFrequently</code> to optimize the canvas for when you need to read it a lot. The list of possible parameters is a bit longer than I remember &mldr; in fact, there&rsquo;s one in there that I don&rsquo;t recall adding or using at all &mldr;</p><p>The <code>desynchronized</code> property of a CanvasRenderingContext2D.</p><p>I turn it off by default. <em>Everything works perfectly again.</em> AAAAH.</p><p>As it turns out, I copied this list of parameters and set defaults for them <em>when I just started with the Pandaqi webiste</em>. I probably copied it from some documentation or a StackOverflow answer. That property was there all along, but I never used it and it never gave issues until now.</p><p>Because what does it do? It <em>desynchronizes</em> the drawing and the logic of a canvas element.</p><p>In other words,</p><ul><li>Normally, inputs (such as clicks on the canvas, adding the canvas to another container, etcetera) and drawing to the canvas happen in the same update. They must wait for each other to complete.</li><li>But when they&rsquo;re desynchronized, they don&rsquo;t. You might tell the canvas to draw something, but it doesn&rsquo;t do it yet, and you click a few milliseconds later and it does that <em>first</em>. There is no guaranteed order.</li></ul><p>I probably left this <code>true</code> by default&mdash;and so did the person from whom I copied the code&mdash;because it is obviously <em>faster</em>. If things don&rsquo;t need to wait on each other, you&rsquo;ll waste less time and your code will be faster.</p><p>But now, for the first time ever apparently, I&rsquo;d made a game that dynamically drew canvases <em>and</em> had dynamic input. (The players reloading the sliders, then using their mouse to set them to their desired value.)</p><p>And so this property messed up the order.</p><ul><li>The <code>Slider</code> is asked to draw itself.</li><li>The specific function that asked this neatly waits for its Promise to resolve &mldr; (Drawing is asynchronous in my system, even when not technically needed.)</li><li>Buuuuut because the canvas is desynchronized, it already wants to add the canvas or listen for clicks <em>before</em> it is done drawing.</li><li>And so an <em>empty canvas</em> is added to my interface. (But there are no errors, because the <em>real canvas</em>&mdash;with the correct Slider visuals&mdash;is done a few milliseconds later and exists behind the scenes.)</li></ul><p>At least, that&rsquo;s my understanding of the bug/property, and the understanding that led me to fix it.</p><p>This was probably one of the hardest, most invisible, most technical and stupid bugs I ever had to track down.</p><p>It was one of the events that really signalled to me that I need to slow down and make sure the Pandaqi website stays <em>lean</em> and <em>small</em>. It&rsquo;s growing too large, with too many exceptions and corner cases, and it just leads to messy broken situations like these. I&rsquo;ve already started on a big clean-up that standardizes more of the code and provides stricter type checks, for example.</p><p>That property is now <code>false</code> by default, until I figure out a better way to handle this. It feels like there should be some event or <em>something</em> to say: &ldquo;Hey, wait for long enough until the canvas is truly ready&rdquo; But I can&rsquo;t find it yet. At least, not a <em>clean</em> and <em>concise</em> solution.</p><p>Anyway, this was my quick anecdote about how I wasted one evening. (And why <em>Slippery Slopes</em> was broken and unplayable for a few days, sorry).</p><p>It&rsquo;s also to warn you of the dangers. The dangers of the <code>desynchronized</code> property of CanvasRenderingContext2D, yes, but also the dangers of blindly copying code from docs or a StackOverflow response and forgetting to check it for years :p</p><p>Until next time,</p><p>Pandaqi</p></div></article><div><nav class=pagination><ul><li><a href=/blog/news-and-updates/2024/my-return-to-game-dev/ class="masked-link big-mask mask-6" style=--rotation:1.5deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><a href=/blog/news-and-updates/2024/pandaqi-games-2024-update-iv/ class="masked-link big-mask mask-7" style=--rotation:0deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/the-game-of-dilemmas/>The Game of Dilemmas
(ü§®)</a></li><li><a href=/blog/boardgames/the-game-of-happiness/>The Game of Happiness
(üåà)</a></li><li><a href=/blog/boardgames/firecrackers/>Firecrackers
(üéÜ)</a></li><li><a href=/blog/boardgames/sleighwell/>Sleighwell
(üéÑ)</a></li><li><a href=/blog/reviews-and-thoughts/the-two-crucial-components-of-a-game/>The Two Crucial Components of Any Game
(üí¨)</a></li><li><a href=/blog/news-and-updates/2024/lets-talk-about-throneless-games/>Let's Talk About: Throneless Games
(üëë)</a></li><li><a href=/blog/boardgames/mountain-miners/>Mountain Miners
(‚õèÔ∏è)</a></li><li><a href=/blog/boardgames/throneless-games/queenseat/>Queenseat
(üëë)</a></li><li><a href=/blog/boardgames/throneless-games/smallseat/>Smallseat
(üëë)</a></li><li><a href=/blog/news-and-updates/2024/pandaqi-games-2024-update-iv/>Pandaqi Games: 2024 Update IV
(üéÆ)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>