<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Unstable Universe (Part 3) | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.css><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-8" style=--rotation:-1.5deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-7" style=--rotation:1.5deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-5" style=--rotation:0deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-7" style=--rotation:0deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-3" style=--rotation:0.5deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-2" style=--rotation:2deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><div class=thumbnail-media><figure class=thumb-image><picture><img src=../../unstable-universe-header.webp loading=lazy decoding=async alt="Thumbnail / Header for article: Unstable Universe (Part 3)" title="Thumbnail / Header for article: Unstable Universe (Part 3)" width=2481 height=877></picture></figure></div><h1>Unstable Universe (Part 3)</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=https://pandaqi.com/blog//blog/>Blog</a>
/
<a href=https://pandaqi.com/blog//blog/boardgames/>Boardgames</a>
/
<a href=https://pandaqi.com/blog//blog/boardgames/unstable-universe/>Unstable universe</a>
/
<a href=https://pandaqi.com/blog//blog/boardgames/unstable-universe/tech-devlog-unstable-universe/>Tech devlog unstable universe</a>
/
<a href=https://pandaqi.com/blog//blog/boardgames/unstable-universe/tech-devlog-unstable-universe/unstable-universe-part-3/>Unstable universe part 3</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/pandaqi.com\/blog\/\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"https:\/\/pandaqi.com\/blog\/\/blog\/boardgames\/","name":"boardgames"}},{"@type":"ListItem","position":5,"item":{"@id":"https:\/\/pandaqi.com\/blog\/\/blog\/boardgames\/unstable-universe\/","name":"unstable-universe"}},{"@type":"ListItem","position":6,"item":{"@id":"https:\/\/pandaqi.com\/blog\/\/blog\/boardgames\/unstable-universe\/tech-devlog-unstable-universe\/","name":"tech-devlog-unstable-universe"}},{"@type":"ListItem","position":7,"item":{"@id":"https:\/\/pandaqi.com\/blog\/\/blog\/boardgames\/unstable-universe\/tech-devlog-unstable-universe\/unstable-universe-part-3\/","name":"unstable-universe-part-3"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2020-10-11T11:00:00>Sunday, Oct 11, 2020</time></div><nav class=tags><span class=metadata-label><span class=emoji>üéó</span> Tags ||</span><ul><li><a href=https://pandaqi.com/blog/tags/technical-devlog>technical devlog</a></li></ul></nav><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#expansions-creating-a-better-node-list>Expansions: Creating a better Node List</a></li><li><a href=#expansions-area-detection-i>Expansions: Area Detection I</a></li><li><a href=#expansions-area-detection-ii>Expansions: Area Detection II</a></li><li><a href=#expansions-natural-resources>Expansions: Natural Resources</a></li><li><a href=#expansions-tiny-nodes>Expansions: Tiny Nodes</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside><div><p>Welcome to part 3 of the technical devlog.</p><p>Haven&rsquo;t read the other entries? Go to the <a href=../>devlog overview</a>.</p><h2 id=expansions-creating-a-better-node-list>Expansions: Creating a better Node List</h2><p>There are three expansions for this game that (mostly) add more nodes.
My experience from previous games tells me that I can&rsquo;t simply allow
such a huge list, because then each type would only appear 1 or 2 times
on the board. This makes games extremely random and unbalanced, whilst
making it more complex: each player needs to remember how 20+ unique
nodes work!</p><p>I, therefore, took the following approach.</p><p>Each node has a Category (like &ldquo;Nature&rdquo;) and one or more Action Types
(like &ldquo;Cutting&rdquo; or &ldquo;Moving&rdquo;). I do this for all games now, because it
allows me to easily balance all parts of the game, while keeping them
varied.</p><p>If you look at the expansions, you&rsquo;ll see that they ALWAYS contain each
<em>Category</em> and each <em>Action Type</em> at least once. The &ldquo;Cutting&rdquo; action is
contained at least <em>three</em> times, because it&rsquo;s such a vital action.</p><p>No matter what expansion you pick, no matter which game you play, you
will <em>always</em> have a set of nodes that contains all possible actions and
categories this game has to offer.</p><p>Once I have this system, I can use it when generating the board:</p><ol><li><p>Initialize an empty list.</p></li><li><p>Pick one random node from each <em>Category</em>, and add it.</p></li><li><p>Pick one random node for each <em>Action Type</em>, and add it.</p></li><li><p>Fill the remaining space with random nodes (that aren&rsquo;t already in
the list).</p></li></ol><p><em>What&rsquo;s the remaining space?</em> Well, I know the number of nodes on the
board (usually around 80). I also gave each node a &ldquo;min&rdquo; and &ldquo;max&rdquo;
value, remember? Whilst adding nodes, I sum the average ( (min+max)/2 ),
until it goes <em>above</em> the total number of nodes. That&rsquo;s when I know that
there are enough nodes to fill the board, but not too many.</p><p><em>What if a node requires other nodes to function?</em> Yeah, that&rsquo;s a big
problem I encountered for the first time in the last game I made.
Luckily, I had time to come up with much simpler (and better) solutions
for this particular game.</p><p>For example: the <em>Critters</em> node requires you to collect <em>Stardust</em>.
Adding one node without the other is literally useless, as they both do
nothing. So, each node has a <strong>requirements</strong> setting that holds a list
of required nodes.</p><p>When such a node is added, it automatically loops through its
&ldquo;requirements&rdquo; list, and adds those as well (if they aren&rsquo;t already in
the list).</p><p>This means we can sometimes &ldquo;overshoot&rdquo; the maximum, but that&rsquo;s not a
big deal. It just means one node type will have one or two fewer nodes
on the board than would be ideal.</p><p><em>But, won&rsquo;t this add many duplicate nodes? For example, if a node has
Category X and Action Type Y, it would be added twice (both in step 2
and step 3)!</em> Of course, that was the last problem that needed solving.</p><p>At the start, I have two lists containing all possibilities (all
categories and all actionTypes).</p><p>Whenever I add a node, I check if its <em>Category</em> is still in the list of
categories. If so, I <em>remove it</em>. The same thing is done for <em>Action
Types</em>.</p><p>This means that, when I add such a node with Category X and Action Type
Y, both these elements are removed from their respective list, so they
won&rsquo;t be encountered any more in steps 2 and 3.</p><p>Hopefully the code clarifies any issues with this explanation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln>  1</span><span class=cl><span class=kd>function</span> <span class=nx>createBetterNodeCollection</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>  <span class=kd>var</span> <span class=nx>tempNodes</span> <span class=o>=</span> <span class=p>{},</span> <span class=nx>name</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nx>curNodeData</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>sum</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>categories</span><span class=o>:</span> <span class=p>[],</span> <span class=nx>actionTypes</span><span class=o>:</span> <span class=p>[]</span> <span class=p>};</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl>  <span class=c1>// Step 1) For each category and action type, add ONE random node to the selection
</span></span></span><span class=line><span class=ln>  5</span><span class=cl><span class=c1></span>  <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>categories</span> <span class=o>=</span> <span class=p>[</span><span class=cm>/* list of all the categories as strings */</span><span class=p>];</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>  <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>actionTypes</span> <span class=o>=</span> <span class=p>[</span><span class=cm>/* list of all the action types as strings */</span><span class=p>]</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>
</span></span><span class=line><span class=ln>  8</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=nx>curNodeData</span><span class=p>.</span><span class=nx>categories</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>    <span class=nx>name</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandomNodeOfType</span><span class=p>(</span><span class=s1>&#39;category&#39;</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>categories</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>tempNodes</span><span class=p>,</span> <span class=nx>NODE_RNG</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>
</span></span><span class=line><span class=ln> 13</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=nx>curNodeData</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>    <span class=nx>name</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandomNodeOfType</span><span class=p>(</span><span class=s1>&#39;actionType&#39;</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>tempNodes</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>
</span></span><span class=line><span class=ln> 18</span><span class=cl>  <span class=c1>// Step 2) Count how many &#34;cutting nodes&#34; we have =&gt; we want at least 3
</span></span></span><span class=line><span class=ln> 19</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>cuttingNodesInSet</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>minCuttingNodes</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>name</span> <span class=k>in</span> <span class=nx>tempNodes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>[</span><span class=nx>name</span><span class=p>].</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=s2>&#34;Cutting&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>      <span class=nx>cuttingNodesInSet</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>
</span></span><span class=line><span class=ln> 26</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=nx>cuttingNodesInSet</span> <span class=o>&lt;</span> <span class=nx>minCuttingNodes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>    <span class=nx>name</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandomNodeOfType</span><span class=p>(</span><span class=s1>&#39;actionType&#39;</span><span class=p>,</span> <span class=s1>&#39;Cutting&#39;</span><span class=p>,</span> <span class=nx>tempNodes</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>name</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span> <span class=k>break</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>
</span></span><span class=line><span class=ln> 30</span><span class=cl>    <span class=nx>cuttingNodesInSet</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>
</span></span><span class=line><span class=ln> 34</span><span class=cl>  <span class=c1>// Step 3) As long as we still have space left, keep adding more nodes (that we don&#39;t have yet)
</span></span></span><span class=line><span class=ln> 35</span><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>errorMargin</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>  <span class=kr>const</span> <span class=nx>maxPointsToFill</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>12</span> <span class=o>-</span> <span class=nx>errorMargin</span><span class=p>;</span> <span class=c1>// all points - starting nodes - some margin
</span></span></span><span class=line><span class=ln> 37</span><span class=cl><span class=c1></span>  <span class=k>while</span><span class=p>(</span><span class=nx>curNodeData</span><span class=p>.</span><span class=nx>sum</span> <span class=o>&lt;</span> <span class=nx>maxPointsToFill</span> <span class=o>&amp;&amp;</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>).</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>NODES</span><span class=p>).</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>    <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>      <span class=nx>name</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandom</span><span class=p>(</span><span class=nx>NODES</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>totalNodeProbability</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!=</span> <span class=kc>undefined</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>tempNodes</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>
</span></span><span class=line><span class=ln> 44</span><span class=cl>  <span class=c1>// finally, swap the old (full) NODES list with the new one
</span></span></span><span class=line><span class=ln> 45</span><span class=cl><span class=c1></span>  <span class=nx>NODES</span> <span class=o>=</span> <span class=nx>tempNodes</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>
</span></span><span class=line><span class=ln> 48</span><span class=cl><span class=kd>function</span> <span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>list</span><span class=p>,</span> <span class=nx>name</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>  <span class=c1>// if it&#39;s already in the list, don&#39;t add it again
</span></span></span><span class=line><span class=ln> 50</span><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nx>list</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!=</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>
</span></span><span class=line><span class=ln> 52</span><span class=cl>  <span class=kd>var</span> <span class=nx>node</span> <span class=o>=</span> <span class=nx>NODES</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>  <span class=nx>list</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>node</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>
</span></span><span class=line><span class=ln> 55</span><span class=cl>  <span class=c1>// update total sum (we stop filling the list when we have enough for the whole board)
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>nodeMin</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>min</span> <span class=o>||</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>nodeMax</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>max</span> <span class=o>||</span> <span class=nx>nodeMin</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>  <span class=kd>var</span> <span class=nx>diff</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>ceil</span><span class=p>((</span><span class=nx>nodeMin</span> <span class=o>+</span> <span class=nx>nodeMax</span><span class=p>)</span> <span class=o>*</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>  <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>sum</span> <span class=o>+=</span> <span class=nx>diff</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>
</span></span><span class=line><span class=ln> 60</span><span class=cl>  <span class=c1>// check if category needs to be removed from list
</span></span></span><span class=line><span class=ln> 61</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>catInd</span> <span class=o>=</span> <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>categories</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>node</span><span class=p>.</span><span class=nx>category</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nx>catInd</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>    <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>categories</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>catInd</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>
</span></span><span class=line><span class=ln> 66</span><span class=cl>  <span class=c1>// check if action type(s) need to be removed from list
</span></span></span><span class=line><span class=ln> 67</span><span class=cl><span class=c1></span>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>node</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>    <span class=kd>var</span> <span class=nx>atp</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>    <span class=kd>var</span> <span class=nx>atpInd</span> <span class=o>=</span> <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>atp</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>
</span></span><span class=line><span class=ln> 71</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>atpInd</span> <span class=o>&gt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>      <span class=nx>curNodeData</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>atpInd</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl>  <span class=c1>// check if this node requires any other nodes; if so, add those as well
</span></span></span><span class=line><span class=ln> 77</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>requirements</span> <span class=o>=</span> <span class=nx>node</span><span class=p>.</span><span class=nx>requirements</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>requirements</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>    <span class=kd>var</span> <span class=nx>req</span> <span class=o>=</span> <span class=nx>requirements</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>addNodeToCollection</span><span class=p>(</span><span class=nx>list</span><span class=p>,</span> <span class=nx>req</span><span class=p>,</span> <span class=nx>curNodeData</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>
</span></span><span class=line><span class=ln> 84</span><span class=cl><span class=kd>function</span> <span class=nx>getRandomNodeOfType</span><span class=p>(</span><span class=nx>what</span> <span class=o>=</span> <span class=s1>&#39;category&#39;</span><span class=p>,</span> <span class=nx>tp</span><span class=p>,</span> <span class=nx>nodesList</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>  <span class=kd>var</span> <span class=nx>list</span> <span class=o>=</span> <span class=p>{},</span> <span class=nx>totalProb</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>name</span> <span class=k>in</span> <span class=nx>NODES</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>nodesList</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>!=</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>    <span class=kd>var</span> <span class=nx>n</span> <span class=o>=</span> <span class=nx>NODES</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>
</span></span><span class=line><span class=ln> 90</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>what</span> <span class=o>==</span> <span class=s1>&#39;category&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>n</span><span class=p>.</span><span class=nx>category</span> <span class=o>==</span> <span class=nx>tp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>      <span class=nx>list</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl>      <span class=nx>totalProb</span> <span class=o>+=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>prob</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>what</span> <span class=o>==</span> <span class=s1>&#39;actionType&#39;</span> <span class=o>&amp;&amp;</span> <span class=nx>n</span><span class=p>.</span><span class=nx>actionTypes</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>tp</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>      <span class=nx>list</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>n</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>      <span class=nx>totalProb</span> <span class=o>+=</span> <span class=nx>n</span><span class=p>.</span><span class=nx>prob</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 96</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>
</span></span><span class=line><span class=ln> 99</span><span class=cl>  <span class=c1>// in this case, &#34;getRandom()&#34; is a default function that randomly draws nodes from a list, following weighted probabilities
</span></span></span><span class=line><span class=ln>100</span><span class=cl><span class=c1></span>  <span class=c1>// but it can be any function that randomly selects one element from a list
</span></span></span><span class=line><span class=ln>101</span><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandom</span><span class=p>(</span><span class=nx>list</span><span class=p>,</span> <span class=nx>totalProb</span><span class=p>);</span>
</span></span><span class=line><span class=ln>102</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=expansions-area-detection-i>Expansions: Area Detection I</h2><p>This was the hardest algorithm to figure out for this game.</p><p>As I mentioned at the start, I&rsquo;d only created grid-based boards until
now. Finding the empty areas <em>between</em> roads/connections is easy there.
(You start with a random empty square, then check if its neighbors are
empty, and repeat that until all neighbors are filled with something.)</p><p>This time, none of that would work. Nodes could be literally anywhere on
the board and the edges could be any length or angle.</p><p>Fortunately, a memory sprang at the back of my mind that said something
like &ldquo;can&rsquo;t you find polygons by always going clockwise?&rdquo; Turns out that
particular memory was correct.</p><p>Here&rsquo;s the idea:</p><ul><li><p>Go through all nodes and <em>sort edges by angle</em>. (We already have
this information from placing the power dots.)</p></li><li><p>Now go through all nodes again:</p><ul><li><p>Go through all edges around the node.</p></li><li><p>Any time you encounter a node, pick the <em>next edge</em> from its
list of edges. (Because this list is sorted by angle, the next
edge will always be the first one you encounter counter
clockwise.)</p></li><li><p>Repeat until you&rsquo;re back at your starting node.</p></li></ul></li></ul><p>It&rsquo;s quite simple in summarized form on paper, but it has some
exceptions and technicalities that made it hard to implement.</p><p><figure class=inline-image><picture><img src=uu-7.webp loading=lazy decoding=async alt="All the areas detected by the algorithm, numbered." title="All the areas detected by the algorithm, numbered." width=1128 height=798></picture><figcaption class=side-note><span>All the areas detected by the algorithm, numbered.</span></figcaption></figure></p><p><strong>Exception #1:</strong> if we do this, then we get <em>many</em> duplicate polygons.
(Because we create the same polygon for <em>every</em> node within it.)
Instead, each edge should only be used in <em>two</em> polygons exactly.</p><p>(Because, well, an edge, basically cuts a space in half, so there is a
space on either side. Two spaces, two polygons in which this edge
falls.)</p><p>To solve this, I keep track of whether an edge has already been used
<em>coming from this particular node</em>. If so, don&rsquo;t ever use it again. This
means an edge is always used exactly twice: A->B, and B->A</p><p>Because we always go counter clockwise, these must represent the two
different polygons.</p><p><strong>Exception #2:</strong> there are no edges at the boundary of the paper! (I
hadn&rsquo;t even considered this, until it screwed me over and it took hours
to fix.)</p><p>Because there are no edges there, you can never find polygons with those
nodes, because you can never return to the starting node. (On top of
that, there isn&rsquo;t always a clockwise node to go to if you&rsquo;re in the
<em>corner</em> of the paper.)</p><p>In the end, I wrote a function &ldquo;addTemporaryEdges()&rdquo;, which does exactly
what it says. It connects all nodes at the boundary (mostly the starting
nodes) with straight lines, and it connects corner nodes on both sides.</p><p>Calling this function <em>before</em> finding the areas, solved all issues.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>findEnclosedAreas</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>areas</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=c1>// initialize &#34;connection used&#34; to false for each edge
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>connectionUsed</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>c</span> <span class=o>&lt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>c</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>      <span class=nx>p</span><span class=p>.</span><span class=nx>connectionUsed</span><span class=p>[</span><span class=nx>c</span><span class=p>]</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=c1>// for each connection ... 
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>c</span> <span class=o>&lt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>c</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=kd>var</span> <span class=nx>conn</span> <span class=o>=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>c</span><span class=p>];</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=c1>// ignore edges that have already been used
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>connectionUsed</span><span class=p>[</span><span class=nx>c</span><span class=p>])</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=c1>// start a new area
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>      <span class=kd>var</span> <span class=nx>area</span> <span class=o>=</span> <span class=p>[</span><span class=nx>p</span><span class=p>],</span> <span class=nx>areaDone</span> <span class=o>=</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>failedArea</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>      <span class=kd>var</span> <span class=nx>curNode</span> <span class=o>=</span> <span class=nx>conn</span><span class=p>,</span> <span class=nx>prevNode</span> <span class=o>=</span> <span class=nx>p</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=nx>p</span><span class=p>.</span><span class=nx>connectionUsed</span><span class=p>[</span><span class=nx>c</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>      <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>areaDone</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=c1>// add current node to area
</span></span></span><span class=line><span class=ln>32</span><span class=cl><span class=c1></span>        <span class=nx>area</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>curNode</span><span class=p>);</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>        <span class=c1>// find location of previous point in list of connections
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=c1></span>        <span class=c1>// (so we know the ANGLE at which we entered the node, so we can pick the one immediately clockwise to it)
</span></span></span><span class=line><span class=ln>36</span><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>indexByAngle</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>cc</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>cc</span> <span class=o>&lt;</span> <span class=nx>curNode</span><span class=p>.</span><span class=nx>connections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>cc</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>          <span class=k>if</span><span class=p>(</span><span class=nx>curNode</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>cc</span><span class=p>]</span> <span class=o>==</span> <span class=nx>prevNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>            <span class=nx>indexByAngle</span> <span class=o>=</span> <span class=nx>cc</span><span class=p>;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=c1>// now pick the NEXT connection after it
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>newIndex</span> <span class=o>=</span> <span class=p>(</span><span class=nx>indexByAngle</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=nx>curNode</span><span class=p>.</span><span class=nx>connections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>        <span class=kd>var</span> <span class=nx>newNode</span> <span class=o>=</span> <span class=nx>curNode</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>newIndex</span><span class=p>];</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>
</span></span><span class=line><span class=ln>47</span><span class=cl>        <span class=c1>// remember that the connection we will follow next, has already been used from this node
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>        <span class=c1>// NOTE: Don&#39;t use the connection we used to GET here, as that should be saved on the node we CAME FROM
</span></span></span><span class=line><span class=ln>49</span><span class=cl><span class=c1></span>        <span class=nx>curNode</span><span class=p>.</span><span class=nx>connectionUsed</span><span class=p>[</span><span class=nx>newIndex</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>50</span><span class=cl>
</span></span><span class=line><span class=ln>51</span><span class=cl>        <span class=c1>// set new current and previous node
</span></span></span><span class=line><span class=ln>52</span><span class=cl><span class=c1></span>        <span class=nx>prevNode</span> <span class=o>=</span> <span class=nx>curNode</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>        <span class=nx>curNode</span> <span class=o>=</span> <span class=nx>newNode</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>
</span></span><span class=line><span class=ln>55</span><span class=cl>        <span class=c1>// if we&#39;re back at our starting node, we&#39;re done
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=c1></span>        <span class=k>if</span><span class=p>(</span><span class=nx>curNode</span> <span class=o>==</span> <span class=nx>p</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=ln>57</span><span class=cl>          <span class=nx>areaDone</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>58</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>      
</span></span><span class=line><span class=ln>61</span><span class=cl>      <span class=c1>// finally, add the new area we found to the global list
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>area</span><span class=p>);</span>
</span></span><span class=line><span class=ln>63</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>65</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=expansions-area-detection-ii>Expansions: Area Detection II</h2><p>Great! Now we have all areas on the board (in the form of a list of
nodes, in clockwise order).</p><p>However, I need the areas to place things <em>inside</em> it. Both &ldquo;expedition
nodes&rdquo; and &ldquo;landmarks&rdquo; can appear in the center of an area, and they
need quite a lot of space. How do we know which areas are big enough?
And how do we find a suitable position?</p><p><strong>Step 1</strong>: average the position of all nodes. This gives the &ldquo;true&rdquo;
average of the polygon. However, if the area is weirdly shaped (like an
L-shape), this doesn&rsquo;t automatically mean it&rsquo;s the best location to
place something.</p><p><strong>Step 2:</strong> calculate the <em>shortest</em> distance from the average to the
nodes of the polygon. This essentially determines the &ldquo;largest circle&rdquo;
we can draw around the center before we hit something.</p><ul><li><p>If this circle is large enough &ndash; great, we can place something
here!</p></li><li><p>If it&rsquo;s too small &ndash; too bad, leave this area alone (for now)</p></li></ul><p><strong>Step 3:</strong> let&rsquo;s revisit that <strong>relaxation technique</strong> from before!</p><p>Relax the &ldquo;center point&rdquo;, considering only the nodes of this area. Just
like before, this means that this point is pushed away if it gets too
close to one particular node. In almost all cases, this means that the
point ends up in the location with the most space.</p><p>I don&rsquo;t apply this technique on polygons with only 3 or 4 nodes. Why
not? Firstly: there&rsquo;s nowhere to go. The center of such an area is
already the (near) optimal center. Secondly: relaxation doesn&rsquo;t work.
The point would just go through the empty spaces between the nodes,
because there isn&rsquo;t enough to push it back.</p><p><strong>Step 4:</strong> use this point to place something inside this area!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln>  1</span><span class=cl><span class=kd>function</span> <span class=nx>findSuitableAreas</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>suitableAreas</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>    <span class=kd>var</span> <span class=nx>a</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>slice</span><span class=p>(),</span> <span class=nx>numNodes</span> <span class=o>=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>,</span> <span class=nx>nodeRemoveCounter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>    <span class=kd>var</span> <span class=nx>center</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>    <span class=kd>var</span> <span class=nx>areaIsSuitable</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>
</span></span><span class=line><span class=ln>  9</span><span class=cl>    <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>
</span></span><span class=line><span class=ln> 11</span><span class=cl>      <span class=c1>// first, find the center point
</span></span></span><span class=line><span class=ln> 12</span><span class=cl><span class=c1></span>      <span class=nx>center</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>      <span class=kd>var</span> <span class=nx>tempNumNodes</span> <span class=o>=</span> <span class=p>(</span><span class=nx>numNodes</span> <span class=o>-</span> <span class=nx>nodeRemoveCounter</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 14</span><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>p</span> <span class=o>&lt;</span> <span class=nx>tempNumNodes</span><span class=p>;</span> <span class=nx>p</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>        <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>x</span> <span class=o>/</span> <span class=nx>tempNumNodes</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>        <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>y</span> <span class=o>/</span> <span class=nx>tempNumNodes</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>
</span></span><span class=line><span class=ln> 19</span><span class=cl>      <span class=c1>// then find the distance to the closest node
</span></span></span><span class=line><span class=ln> 20</span><span class=cl><span class=c1></span>      <span class=c1>// (aka &#34;what&#39;s the biggest circle we can draw around the center that still fits within the polygon?&#34;)
</span></span></span><span class=line><span class=ln> 21</span><span class=cl><span class=c1></span>      <span class=kd>var</span> <span class=nx>closestDist</span> <span class=o>=</span> <span class=kc>Infinity</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>p</span> <span class=o>&lt;</span> <span class=nx>numNodes</span><span class=p>;</span> <span class=nx>p</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 23</span><span class=cl>        <span class=kd>var</span> <span class=nx>dist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>*</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>+</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>*</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>p</span><span class=p>].</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>        <span class=nx>closestDist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>closestDist</span><span class=p>,</span> <span class=nx>dist</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 25</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 26</span><span class=cl>
</span></span><span class=line><span class=ln> 27</span><span class=cl>      <span class=c1>// if the center is too close to an edge node (of this enclosed area), try again, but change the center
</span></span></span><span class=line><span class=ln> 28</span><span class=cl><span class=c1></span>      <span class=c1>// (basically, we remove the last node of the area, and keep trying that until it works or we&#39;ve nothing left to remove)
</span></span></span><span class=line><span class=ln> 29</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>closestDist</span> <span class=o>&lt;=</span> <span class=nx>someRadius</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>        <span class=nx>nodeRemoveCounter</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>
</span></span><span class=line><span class=ln> 32</span><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>numNodes</span> <span class=o>-</span> <span class=nx>nodeRemoveCounter</span> <span class=o>&lt;</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>          <span class=nx>areaIsSuitable</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>          <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>        <span class=nx>areaIsSuitable</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>
</span></span><span class=line><span class=ln> 40</span><span class=cl>    <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>areaIsSuitable</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>
</span></span><span class=line><span class=ln> 42</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>areaIsSuitable</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>      
</span></span><span class=line><span class=ln> 44</span><span class=cl>      <span class=c1>// create an area object, including some useful metrics
</span></span></span><span class=line><span class=ln> 45</span><span class=cl><span class=c1></span>      <span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>centerNode</span><span class=p>.</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=nx>dy</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>centerNode</span><span class=p>.</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>      <span class=kd>var</span> <span class=nx>distanceToCenterNode</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span> <span class=nx>dx</span><span class=o>*</span><span class=nx>dx</span> <span class=o>+</span> <span class=nx>dy</span><span class=o>*</span><span class=nx>dy</span> <span class=p>)</span>
</span></span><span class=line><span class=ln> 47</span><span class=cl>
</span></span><span class=line><span class=ln> 48</span><span class=cl>      <span class=kd>var</span> <span class=nx>newArea</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>        <span class=s1>&#39;tiles&#39;</span><span class=o>:</span> <span class=nx>a</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>        <span class=s1>&#39;center&#39;</span><span class=o>:</span> <span class=nx>center</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 51</span><span class=cl>        <span class=s1>&#39;dist&#39;</span><span class=o>:</span> <span class=nx>distanceToCenterNode</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>
</span></span><span class=line><span class=ln> 54</span><span class=cl>      <span class=c1>// then add it to the suitable areas list
</span></span></span><span class=line><span class=ln> 55</span><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>suitableAreas</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>newArea</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 56</span><span class=cl>
</span></span><span class=line><span class=ln> 57</span><span class=cl>      <span class=c1>// and remove it from the original areas list (so it isn&#39;t used by any other game mechanics)
</span></span></span><span class=line><span class=ln> 58</span><span class=cl><span class=c1></span>      <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>
</span></span><span class=line><span class=ln> 63</span><span class=cl>
</span></span><span class=line><span class=ln> 64</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 65</span><span class=cl><span class=c1>// When we actually want to use the area for something, we call this function on the CENTER of the area to relax it
</span></span></span><span class=line><span class=ln> 66</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 67</span><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>relaxExpeditionNode</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>area</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>  <span class=kr>const</span> <span class=nx>numSteps</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 69</span><span class=cl>  <span class=kr>const</span> <span class=nx>center</span> <span class=o>=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>slice</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>  <span class=kr>const</span> <span class=nx>equilibrium</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>  <span class=kr>const</span> <span class=nx>edgePushoff</span> <span class=o>=</span> <span class=mf>0.4</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>
</span></span><span class=line><span class=ln> 73</span><span class=cl>  <span class=c1>// we can&#39;t really relax triangles or squares, as the node will just be pushed through the side (as there is no node there)
</span></span></span><span class=line><span class=ln> 74</span><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nx>area</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nx>center</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numSteps</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>    <span class=kd>var</span> <span class=nx>moveVec</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>
</span></span><span class=line><span class=ln> 79</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>t</span> <span class=o>&lt;</span> <span class=nx>area</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>t</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>      <span class=kd>var</span> <span class=nx>surroundingNode</span> <span class=o>=</span> <span class=nx>area</span><span class=p>[</span><span class=nx>t</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 81</span><span class=cl>
</span></span><span class=line><span class=ln> 82</span><span class=cl>      <span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=nx>surroundingNode</span><span class=p>.</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>dy</span> <span class=o>=</span> <span class=nx>surroundingNode</span><span class=p>.</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>      <span class=kd>var</span> <span class=nx>dist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span> <span class=nx>dx</span><span class=o>*</span><span class=nx>dx</span> <span class=o>+</span> <span class=nx>dy</span><span class=o>*</span><span class=nx>dy</span> <span class=p>);</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>      <span class=kd>var</span> <span class=nx>force</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=nx>dist</span> <span class=o>-</span> <span class=nx>equilibrium</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>      
</span></span><span class=line><span class=ln> 86</span><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=nx>dist</span> <span class=o>&lt;</span> <span class=nx>equilibrium</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 87</span><span class=cl>        <span class=nx>moveVec</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=o>-</span><span class=nx>dx</span> <span class=o>*</span> <span class=nx>force</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>        <span class=nx>moveVec</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=o>-</span><span class=nx>dy</span> <span class=o>*</span> <span class=nx>force</span> <span class=o>*</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span> <span class=o>/</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>
</span></span><span class=line><span class=ln> 92</span><span class=cl>    <span class=c1>// also push us off boundaries
</span></span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=nx>edgePushoff</span><span class=p>)</span> <span class=p>{</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=nx>edgePushoff</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>resolutionX</span> <span class=o>-</span> <span class=nx>edgePushoff</span><span class=p>)</span> <span class=p>{</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-=</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>resolutionX</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=nx>edgePushoff</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>
</span></span><span class=line><span class=ln> 96</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&lt;</span> <span class=nx>edgePushoff</span><span class=p>)</span> <span class=p>{</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>abs</span><span class=p>(</span><span class=nx>edgePushoff</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 97</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>resolutionY</span> <span class=o>-</span> <span class=nx>edgePushoff</span><span class=p>)</span> <span class=p>{</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-=</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>resolutionY</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=nx>edgePushoff</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>
</span></span><span class=line><span class=ln> 99</span><span class=cl>    <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>*</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>0.1</span><span class=o>*</span><span class=nx>numSteps</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>    <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>moveVec</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>*</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>0.1</span><span class=o>*</span><span class=nx>numSteps</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>101</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>
</span></span><span class=line><span class=ln>103</span><span class=cl>  <span class=k>return</span> <span class=nx>center</span><span class=p>;</span>
</span></span><span class=line><span class=ln>104</span><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Below is an image that shows the expedition nodes (light red circles, with even more circles inside) being placed at the approximate best location within each area:</p><p><figure class=inline-image><picture><img src=uu-8.webp loading=lazy decoding=async alt="Expedition nodes within areas" title="Expedition nodes within areas" width=1128 height=798></picture><figcaption class=side-note><span>Expedition nodes within areas</span></figcaption></figure></p><h2 id=expansions-natural-resources>Expansions: Natural Resources</h2><p>Whenever an area is too small to fit a large object (like an expedition
or landmark), I try to fit smaller ones: <em>natural resources</em>.</p><p>These can be placed <em>anywhere</em> within the area, as long as they don&rsquo;t
overlap anything else (the nodes, edges, or other resources).</p><p>To do this, I use an old technique called <strong>shrinking the polygon</strong>:</p><ul><li><p>Calculate the center of the polygon.</p></li><li><p><strong>Shrink:</strong> subtract the center position from all points, scale them
down (by multiplying with a value &lt; 1), then add back whatever you
subtracted.</p><ul><li>This is standard procedure for scaling things. You translate it
so that the origin (0,0) is at the center, then scale it, then
put it back where it was.</li></ul></li><li><p>While doing this, also calculate the <em>bounding box</em>. This is the
smallest box that can fit around the whole area. It&rsquo;s nothing more
than the largest X distance and largest Y distance between nodes.</p></li><li><p>Now I simply sample <em>random points within the bounding box</em>.</p><ul><li><p>They are not within the shrunk polygon? Try again.</p></li><li><p>They are too close to a node from this area? Try again.</p></li><li><p>They are too close to another natural resource? Try again.</p></li></ul></li></ul><p>Lastly, I rotate the resources randomly and vary their amount based on a
rough approximation of area size.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln>  1</span><span class=cl><span class=kd>function</span> <span class=nx>addNaturalResources</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>  <span class=k>this</span><span class=p>.</span><span class=nx>naturalResources</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>  3</span><span class=cl>
</span></span><span class=line><span class=ln>  4</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>    <span class=kd>var</span> <span class=nx>a</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>areas</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln>  6</span><span class=cl>
</span></span><span class=line><span class=ln>  7</span><span class=cl>    <span class=c1>// find center of polygon
</span></span></span><span class=line><span class=ln>  8</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>center</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>  9</span><span class=cl>    <span class=kd>var</span> <span class=nx>numEdgeNodes</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 10</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>t</span> <span class=o>&lt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>t</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>      <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>a</span><span class=p>[</span><span class=nx>t</span><span class=p>].</span><span class=nx>x</span> <span class=o>/</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>      <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=nx>a</span><span class=p>[</span><span class=nx>t</span><span class=p>].</span><span class=nx>y</span> <span class=o>/</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>
</span></span><span class=line><span class=ln> 14</span><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>t</span><span class=p>].</span><span class=nx>edgePoint</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>        <span class=nx>numEdgeNodes</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 17</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 18</span><span class=cl>
</span></span><span class=line><span class=ln> 19</span><span class=cl>    <span class=kd>var</span> <span class=nx>numResources</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>
</span></span><span class=line><span class=ln> 21</span><span class=cl>    <span class=c1>// natural resources look ugly (and unbalanced) in areas connected to edge, so
</span></span></span><span class=line><span class=ln> 22</span><span class=cl><span class=c1></span>    <span class=c1>// 1) ignore any areas where more than HALF the points are edge points
</span></span></span><span class=line><span class=ln> 23</span><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>numEdgeNodes</span> <span class=o>&gt;=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=o>*</span><span class=mf>0.5</span><span class=p>))</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 24</span><span class=cl>
</span></span><span class=line><span class=ln> 25</span><span class=cl>    <span class=c1>// 2) and only allow 1-2 natural resources in areas with few nodes
</span></span></span><span class=line><span class=ln> 26</span><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>a</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>4</span><span class=p>)</span> <span class=p>{</span> <span class=nx>numResources</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;}</span>
</span></span><span class=line><span class=ln> 27</span><span class=cl>
</span></span><span class=line><span class=ln> 28</span><span class=cl>    <span class=c1>// shrink polygon towards center
</span></span></span><span class=line><span class=ln> 29</span><span class=cl><span class=c1></span>    <span class=c1>// also immediately find the bounding box
</span></span></span><span class=line><span class=ln> 30</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>minX</span> <span class=o>=</span> <span class=kc>Infinity</span><span class=p>,</span> <span class=nx>maxX</span> <span class=o>=</span> <span class=o>-</span><span class=kc>Infinity</span><span class=p>,</span> <span class=nx>minY</span> <span class=o>=</span> <span class=kc>Infinity</span><span class=p>,</span> <span class=nx>maxY</span> <span class=o>=</span> <span class=o>-</span><span class=kc>Infinity</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>    <span class=kd>var</span> <span class=nx>scaleFactor</span> <span class=o>=</span> <span class=mf>0.7</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>    <span class=kd>var</span> <span class=nx>poly</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>t</span> <span class=o>&lt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>t</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>      <span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>t</span><span class=p>].</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>*</span> <span class=nx>scaleFactor</span> <span class=o>+</span> <span class=nx>center</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 35</span><span class=cl>      <span class=kd>var</span> <span class=nx>dy</span> <span class=o>=</span> <span class=p>(</span><span class=nx>a</span><span class=p>[</span><span class=nx>t</span><span class=p>].</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span> <span class=o>*</span> <span class=nx>scaleFactor</span> <span class=o>+</span> <span class=nx>center</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>
</span></span><span class=line><span class=ln> 37</span><span class=cl>      <span class=nx>minX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span> <span class=nx>minX</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>      <span class=nx>maxX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>dx</span><span class=p>,</span> <span class=nx>maxX</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>
</span></span><span class=line><span class=ln> 40</span><span class=cl>      <span class=nx>minY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>dy</span><span class=p>,</span> <span class=nx>minY</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>      <span class=nx>maxY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>dy</span><span class=p>,</span> <span class=nx>maxY</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>
</span></span><span class=line><span class=ln> 43</span><span class=cl>      <span class=nx>poly</span><span class=p>.</span><span class=nx>push</span><span class=p>({</span> <span class=s1>&#39;x&#39;</span><span class=o>:</span> <span class=nx>dx</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=o>:</span> <span class=nx>dy</span> <span class=p>})</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>
</span></span><span class=line><span class=ln> 46</span><span class=cl>    <span class=c1>// randomly place points within bounding box
</span></span></span><span class=line><span class=ln> 47</span><span class=cl><span class=c1></span>    <span class=c1>// if they are also inside the polygon, yay! Save it!
</span></span></span><span class=line><span class=ln> 48</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>tempResourceList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>    <span class=kr>const</span> <span class=nx>maxTries</span> <span class=o>=</span> <span class=mi>200</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>
</span></span><span class=line><span class=ln> 51</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>r</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>r</span> <span class=o>&lt;</span> <span class=nx>numResources</span><span class=p>;</span> <span class=nx>r</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 52</span><span class=cl>      <span class=kd>var</span> <span class=nx>point</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;x&#39;</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=o>:</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=ln> 53</span><span class=cl>      <span class=kd>var</span> <span class=nx>outsidePolygon</span> <span class=o>=</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>tooCloseToNode</span> <span class=o>=</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>tooCloseToResource</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 54</span><span class=cl>      <span class=kd>var</span> <span class=nx>locationNotSuitable</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>
</span></span><span class=line><span class=ln> 56</span><span class=cl>      <span class=kd>var</span> <span class=nx>tries</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=ln> 57</span><span class=cl>      <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>        <span class=nx>point</span><span class=p>.</span><span class=nx>x</span> <span class=o>=</span> <span class=nx>RNG</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=nx>maxX</span><span class=o>-</span><span class=nx>minX</span><span class=p>)</span> <span class=o>+</span> <span class=nx>minX</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 59</span><span class=cl>        <span class=nx>point</span><span class=p>.</span><span class=nx>y</span> <span class=o>=</span> <span class=nx>RNG</span><span class=p>()</span> <span class=o>*</span> <span class=p>(</span><span class=nx>maxY</span><span class=o>-</span><span class=nx>minY</span><span class=p>)</span> <span class=o>+</span> <span class=nx>minY</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 60</span><span class=cl>
</span></span><span class=line><span class=ln> 61</span><span class=cl>        <span class=nx>outsidePolygon</span> <span class=o>=</span> <span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>pointInsidePolygon</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>poly</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>
</span></span><span class=line><span class=ln> 63</span><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>outsidePolygon</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>          <span class=nx>tooCloseToNode</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>closestDistToPolygonNode</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>a</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=nx>someRadius</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>
</span></span><span class=line><span class=ln> 66</span><span class=cl>          <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>tooCloseToNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 67</span><span class=cl>            <span class=nx>tooCloseToResource</span> <span class=o>=</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>closestDistToResource</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>tempResourceList</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=nx>someOtherRadius</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 68</span><span class=cl>          <span class=p>}</span>					
</span></span><span class=line><span class=ln> 69</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>
</span></span><span class=line><span class=ln> 71</span><span class=cl>        <span class=nx>locationNotSuitable</span> <span class=o>=</span> <span class=p>(</span><span class=nx>outsidePolygon</span> <span class=o>||</span> <span class=nx>tooCloseToNode</span> <span class=o>||</span> <span class=nx>tooCloseToResource</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>
</span></span><span class=line><span class=ln> 73</span><span class=cl>        <span class=nx>tries</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>tries</span> <span class=o>&gt;=</span> <span class=nx>maxTries</span><span class=p>)</span> <span class=p>{</span> <span class=k>break</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>
</span></span><span class=line><span class=ln> 76</span><span class=cl>      <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=nx>locationNotSuitable</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>
</span></span><span class=line><span class=ln> 78</span><span class=cl>      <span class=c1>// if we failed to find anything (probably not enough space), just ignore this one and continue
</span></span></span><span class=line><span class=ln> 79</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>locationNotSuitable</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 80</span><span class=cl>
</span></span><span class=line><span class=ln> 81</span><span class=cl>      <span class=kd>var</span> <span class=nx>nr</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 82</span><span class=cl>        <span class=s1>&#39;x&#39;</span><span class=o>:</span> <span class=nx>point</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>        <span class=s1>&#39;y&#39;</span><span class=o>:</span> <span class=nx>point</span><span class=p>.</span><span class=nx>y</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>        <span class=s1>&#39;type&#39;</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandom</span><span class=p>(</span><span class=nx>NATURAL_RESOURCES</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>totalNaturalResourceProbability</span><span class=p>,</span> <span class=nx>RNG</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>
</span></span><span class=line><span class=ln> 87</span><span class=cl>      <span class=nx>tempResourceList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>nr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 88</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>naturalResources</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>nr</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>
</span></span><span class=line><span class=ln> 91</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln> 92</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 93</span><span class=cl>
</span></span><span class=line><span class=ln> 94</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 95</span><span class=cl><span class=c1>// These are just default helper functions for finding closest distance to something
</span></span></span><span class=line><span class=ln> 96</span><span class=cl><span class=c1>// or checking if a point is inside a polygon
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 98</span><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>closestDistToResource</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>list</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>  <span class=kd>var</span> <span class=nx>minDist</span> <span class=o>=</span> <span class=kc>Infinity</span><span class=p>;</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>
</span></span><span class=line><span class=ln>101</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>list</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>102</span><span class=cl>    <span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>point</span><span class=p>.</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>list</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>x</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>,</span> <span class=nx>dy</span> <span class=o>=</span> <span class=p>(</span><span class=nx>point</span><span class=p>.</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>list</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>y</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span>
</span></span><span class=line><span class=ln>103</span><span class=cl>    <span class=nx>minDist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>dist</span><span class=p>,</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span> <span class=nx>dx</span><span class=o>*</span><span class=nx>dx</span> <span class=o>+</span> <span class=nx>dy</span><span class=o>*</span><span class=nx>dy</span> <span class=p>));</span>
</span></span><span class=line><span class=ln>104</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>105</span><span class=cl>
</span></span><span class=line><span class=ln>106</span><span class=cl>  <span class=k>return</span> <span class=nx>minDist</span> <span class=o>/</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span><span class=p>);</span>
</span></span><span class=line><span class=ln>107</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>108</span><span class=cl>
</span></span><span class=line><span class=ln>109</span><span class=cl><span class=kd>function</span> <span class=nx>closestDistToPolygonNode</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>poly</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>110</span><span class=cl>  <span class=kd>var</span> <span class=nx>minDist</span> <span class=o>=</span> <span class=kc>Infinity</span><span class=p>;</span>
</span></span><span class=line><span class=ln>111</span><span class=cl>
</span></span><span class=line><span class=ln>112</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>poly</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>113</span><span class=cl>    <span class=kd>var</span> <span class=nx>dx</span> <span class=o>=</span> <span class=p>(</span><span class=nx>poly</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>point</span><span class=p>.</span><span class=nx>x</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>,</span> <span class=nx>dy</span> <span class=o>=</span> <span class=p>(</span><span class=nx>poly</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>point</span><span class=p>.</span><span class=nx>y</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span>
</span></span><span class=line><span class=ln>114</span><span class=cl>    <span class=nx>dist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>sqrt</span><span class=p>(</span> <span class=nx>dx</span><span class=o>*</span><span class=nx>dx</span> <span class=o>+</span> <span class=nx>dy</span><span class=o>*</span><span class=nx>dy</span> <span class=p>)</span>
</span></span><span class=line><span class=ln>115</span><span class=cl>
</span></span><span class=line><span class=ln>116</span><span class=cl>    <span class=nx>minDist</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=nx>dist</span><span class=p>,</span> <span class=nx>minDist</span><span class=p>);</span>
</span></span><span class=line><span class=ln>117</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>118</span><span class=cl>
</span></span><span class=line><span class=ln>119</span><span class=cl>  <span class=k>return</span> <span class=nx>minDist</span> <span class=o>/</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>min</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span><span class=p>);</span>
</span></span><span class=line><span class=ln>120</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>121</span><span class=cl>
</span></span><span class=line><span class=ln>122</span><span class=cl><span class=kd>function</span> <span class=nx>pointInsidePolygon</span><span class=p>(</span><span class=nx>point</span><span class=p>,</span> <span class=nx>vs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>123</span><span class=cl>  <span class=c1>// ray-casting algorithm based on
</span></span></span><span class=line><span class=ln>124</span><span class=cl><span class=c1></span>  <span class=c1>// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html/pnpoly.html
</span></span></span><span class=line><span class=ln>125</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>126</span><span class=cl>  <span class=kd>var</span> <span class=nx>csX</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeX</span><span class=p>,</span> <span class=nx>csY</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>cfg</span><span class=p>.</span><span class=nx>cellSizeY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>127</span><span class=cl>  <span class=kd>var</span> <span class=nx>x</span> <span class=o>=</span> <span class=nx>point</span><span class=p>.</span><span class=nx>x</span> <span class=o>*</span> <span class=nx>csX</span><span class=p>,</span> <span class=nx>y</span> <span class=o>=</span> <span class=nx>point</span><span class=p>.</span><span class=nx>y</span> <span class=o>*</span> <span class=nx>csY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>128</span><span class=cl>
</span></span><span class=line><span class=ln>129</span><span class=cl>  <span class=kd>var</span> <span class=nx>inside</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>130</span><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=nx>j</span> <span class=o>=</span> <span class=nx>vs</span><span class=p>.</span><span class=nx>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>vs</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>j</span> <span class=o>=</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>131</span><span class=cl>      <span class=kd>var</span> <span class=nx>xi</span> <span class=o>=</span> <span class=nx>vs</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>x</span> <span class=o>*</span> <span class=nx>csX</span><span class=p>,</span> <span class=nx>yi</span> <span class=o>=</span> <span class=nx>vs</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>y</span> <span class=o>*</span> <span class=nx>csY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>132</span><span class=cl>      <span class=kd>var</span> <span class=nx>xj</span> <span class=o>=</span> <span class=nx>vs</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>x</span> <span class=o>*</span> <span class=nx>csX</span><span class=p>,</span> <span class=nx>yj</span> <span class=o>=</span> <span class=nx>vs</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>y</span> <span class=o>*</span> <span class=nx>csY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>133</span><span class=cl>
</span></span><span class=line><span class=ln>134</span><span class=cl>      <span class=kd>var</span> <span class=nx>intersect</span> <span class=o>=</span> <span class=p>((</span><span class=nx>yi</span> <span class=o>&gt;</span> <span class=nx>y</span><span class=p>)</span> <span class=o>!=</span> <span class=p>(</span><span class=nx>yj</span> <span class=o>&gt;</span> <span class=nx>y</span><span class=p>))</span>
</span></span><span class=line><span class=ln>135</span><span class=cl>          <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>x</span> <span class=o>&lt;</span> <span class=p>(</span><span class=nx>xj</span> <span class=o>-</span> <span class=nx>xi</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>yi</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=nx>yj</span> <span class=o>-</span> <span class=nx>yi</span><span class=p>)</span> <span class=o>+</span> <span class=nx>xi</span><span class=p>);</span>
</span></span><span class=line><span class=ln>136</span><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>intersect</span><span class=p>)</span> <span class=nx>inside</span> <span class=o>=</span> <span class=o>!</span><span class=nx>inside</span><span class=p>;</span>
</span></span><span class=line><span class=ln>137</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>138</span><span class=cl>
</span></span><span class=line><span class=ln>139</span><span class=cl>  <span class=k>return</span> <span class=nx>inside</span><span class=p>;</span>
</span></span><span class=line><span class=ln>140</span><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Here&rsquo;s how that looks:</p><p><figure class=inline-image><picture><img src=uu-9.webp loading=lazy decoding=async alt="Natural resources scattered within areas" title="Natural resources scattered within areas" width=1128 height=798></picture><figcaption class=side-note><span>Natural resources scattered within areas</span></figcaption></figure></p><h2 id=expansions-tiny-nodes>Expansions: Tiny Nodes</h2><p>Last but not least, but certainly the least in size, are the <strong>tiny
nodes</strong>.</p><p>These are placed on <em>edges</em> to modify what they do (or can&rsquo;t do). They
are optional to visit and own. (Their usefulness highly depends on your
strategy, personal mission and what other players are doing. So it&rsquo;s not
fun to force players to use them all the time.)</p><p>For example, a Triangle turns the edge into a one-way route: you can
only move over it in the direction the triangle points.</p><p>These were very simple to add. (Fortunately, after that whole mess with
the area detection algorithm!)</p><ul><li><p>Go through all nodes.</p><ul><li><p>Go through all edges of this node.</p></li><li><p>If one endpoint of the edge already has more than X tiny nodes,
ignore it. (Each edge has two endpoints: the node it came from
and the node it&rsquo;s going to. The value X is simply a maximum on
the number of Tiny Nodes per node.)</p></li><li><p>Otherwise, calculate the average ( (node1+node2)/2) and place a
random Tiny Node there.</p></li><li><p>Also calculate the angle ( Math.atan2(node2.y &ndash; node1.y,
node2.x &ndash; node1.x) ) and rotate the Tiny Node to match.</p></li></ul></li></ul><p>That&rsquo;s it! A simple, small addition that adds huge implications to the
gameplay.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>addTinyPoints</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1>// IMPORTANT NOTE: these nodes were called &#34;intermediary points&#34; before they became tiny nodes, so that&#39;s still everywhere in the code
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>intermediaryPoints</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=kr>const</span> <span class=nx>minPointDistance</span> <span class=o>=</span> <span class=mf>0.5</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>  <span class=kr>const</span> <span class=nx>maxPointsPerNode</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=kd>var</span> <span class=nx>p</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>points</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>edgePoint</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>
</span></span><span class=line><span class=ln>13</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>c</span> <span class=o>&lt;</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>c</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>      <span class=kd>var</span> <span class=nx>conn</span> <span class=o>=</span> <span class=nx>p</span><span class=p>.</span><span class=nx>connections</span><span class=p>[</span><span class=nx>c</span><span class=p>];</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>      <span class=c1>// enforce a strict maximum of X intermediary points surrounding each node
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>iPointsCreated</span> <span class=o>&gt;=</span> <span class=nx>maxPointsPerNode</span> <span class=o>||</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>iPointsCreated</span> <span class=o>&gt;=</span> <span class=nx>maxPointsPerNode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>
</span></span><span class=line><span class=ln>21</span><span class=cl>      <span class=c1>// don&#39;t consider connections twice!
</span></span></span><span class=line><span class=ln>22</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nx>intermediaryPointsExhausted</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=c1>// don&#39;t allow connecting with an edge node!
</span></span></span><span class=line><span class=ln>25</span><span class=cl><span class=c1></span>      <span class=c1>// (first step of the whole game should not have a tiny node)
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nx>edgePoint</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>      <span class=kd>var</span> <span class=nx>iPoint</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>        <span class=nx>x</span><span class=o>:</span> <span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>x</span> <span class=o>+</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>x</span><span class=p>)</span><span class=o>*</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=nx>y</span><span class=o>:</span> <span class=p>(</span><span class=nx>p</span><span class=p>.</span><span class=nx>y</span> <span class=o>+</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>y</span><span class=p>)</span><span class=o>*</span><span class=mf>0.5</span><span class=p>,</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>        <span class=nx>type</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>getRandom</span><span class=p>(</span><span class=nx>TINY_NODES</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>totalTinyNodeProbability</span><span class=p>,</span> <span class=nx>NODE_RNG</span><span class=p>),</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>        <span class=nx>angle</span><span class=o>:</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>atan2</span><span class=p>(</span><span class=nx>conn</span><span class=p>.</span><span class=nx>y</span> <span class=o>-</span> <span class=nx>p</span><span class=p>.</span><span class=nx>y</span><span class=p>,</span> <span class=nx>conn</span><span class=p>.</span><span class=nx>x</span> <span class=o>-</span> <span class=nx>p</span><span class=p>.</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>intermediaryPoints</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>iPoint</span><span class=p>)</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl>      <span class=nx>p</span><span class=p>.</span><span class=nx>iPointsCreated</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>      <span class=nx>conn</span><span class=p>.</span><span class=nx>iPointsCreated</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl>    <span class=nx>p</span><span class=p>.</span><span class=nx>intermediaryPointsExhausted</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>43</span><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Check the small shapes (circles, triangles, etc.) halfway edges on the image below for the result:</p><p><figure class=inline-image><picture><img src=uu-10.webp loading=lazy decoding=async alt="Tiny Nodes on the game board for Unstable Universe" title="Tiny Nodes on the game board for Unstable Universe" width=1128 height=798></picture><figcaption class=side-note><span>Tiny Nodes on the game board for Unstable Universe</span></figcaption></figure></p><h2 id=conclusion>Conclusion</h2><p>Hopefully this devlog was interesting to read and you&rsquo;ve learnt many
awesome techniques for generating random worlds for games.</p><p>It&rsquo;s really mostly about practice though: as I create more and more of
these games, I find it easier to solve common problems with random
generation, and also dare venture more &ldquo;out of the box&rdquo;. A year ago I
wouldn&rsquo;t even have known the first step &ndash; how to place points
semi-randomly on the board &ndash; but look where we are now!</p><p>So the least I can say is: hopefully this devlog inspired you to make
your own projects a reality, no matter how challenging or innovative
they are.</p><p>If you like what you see, please try any of my games and give me some
feedback, or support me any other way!</p><p>Until the next devlog,</p><p>Pandaqi</p></div></article><div><nav class=pagination><ul><li><a href=/blog/boardgames/unstable-universe/tech-devlog-unstable-universe/unstable-universe-part-2/ class="masked-link big-mask mask-4" style=--rotation:-1.5deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><span class=nav-disabled>No next page :(</span></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/mammoth-messages/>Mammoth Messages
(üêò)</a></li><li><a href=/blog/boardgames/kangaruse/>Kangaruse
(ü¶ò)</a></li><li><a href=/blog/news-and-updates/my-journey-to-becoming-a-game-designer/>My Journey to Becoming a Game Designer
(üé≤)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-solving-the-nightmare-of-text/>Pandaqi Games: Solving the Nightmare called Text
(üéÆ)</a></li><li><a href=/blog/boardgames/creature-quellector/>Creature Quellector
(üêâ)</a></li><li><a href=/blog/boardgames/finger-food/>Finger Food
(üñêÔ∏è)</a></li><li><a href=/blog/news-and-updates/why-my-games-were-removed-from-the-play-store/>Why all my games were removed from the Play Store
(üì±)</a></li><li><a href=/blog/boardgames/kingseat/>Kingseat
(üëë)</a></li><li><a href=/blog/boardgames/foldigami/>Foldigami
(üìÉ)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-the-big-typescript-update/>Pandaqi Games: The Big Typescript Update
(üéÆ)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>