<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Wondering Witches (Part 5) | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-6" style=--rotation:0deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-1" style=--rotation:2deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-5" style=--rotation:1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-8" style=--rotation:0.5deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-1" style=--rotation:1deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-1" style=--rotation:-1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><div class=thumbnail-media><figure class=thumb-image><picture><img src=../../wondering-witches-header.webp loading=lazy decoding=async alt="Thumbnail / Header for article: Wondering Witches (Part 5)" title="Thumbnail / Header for article: Wondering Witches (Part 5)" width=2481 height=877></picture></figure></div><h1>Wondering Witches (Part 5)</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/boardgames/>Boardgames</a>
/
<a href=/blog/boardgames/wondering-witches/>Wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/>Tech devlog wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-5/>Wondering witches part 5</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/boardgames\/","name":"boardgames"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/","name":"wondering-witches"}},{"@type":"ListItem","position":6,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/","name":"tech-devlog-wondering-witches"}},{"@type":"ListItem","position":7,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/wondering-witches-part-5\/","name":"wondering-witches-part-5"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2020-04-12T13:00:00>Sunday, Apr 12, 2020</time></div><nav class=tags><span class=metadata-label><span class=emoji>üéó</span> Tags ||</span><ul><li><a href=https://pandaqi.com/blog/tags/technical-devlog>technical devlog</a></li></ul></nav><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#generating-a-fair-board>Generating a &ldquo;fair&rdquo; Board</a><ul><li><a href=#splitting-the-board-into-sections>Splitting the board into sections</a></li><li><a href=#creating-a-cauldron-distribution>Creating a Cauldron distribution</a></li><li><a href=#trying-to-fit-cauldrons>Trying to fit cauldrons</a></li><li><a href=#filling-with-gardens>Filling with gardens</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></aside><div><p>Welcome to part 5 of my Technical Devlog for the game Wondering Witches!</p><p>Haven&rsquo;t read the other entries? Go to the <a href=../>devlog overview</a>.</p><h2 id=generating-a-fair-board>Generating a &ldquo;fair&rdquo; Board</h2><p>As I said before, this part took me the most time. I will only describe
the code I ended up using, as describing numerous failed attempts
doesn&rsquo;t seem too interesting. But don&rsquo;t let that fool you &ndash; it took me
a long while to get here.</p><h3 id=splitting-the-board-into-sections>Splitting the board into sections</h3><p>First of all, I wanted to give each player their own little part of the
board. Their own garden to tend. If needed, you could cut the board into
pieces so people wouldn&rsquo;t need to huddle around a small piece of paper,
but could mostly focus on what&rsquo;s in front of them.</p><p>For this I just used a fixed distribution. With X players, the board is
always split into the same shapes.</p><p>(Of course, I <em>could</em> have tried to make it dynamic, but what&rsquo;s the
point? It would only add unneeded complexity, whilst players don&rsquo;t
really care about how their pieces of the board are distributed on the
original piece of paper.)</p><p>I saved this in the code as an array of rectangles: each shape had a
start point (x,y) and a size (width, height).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// divide the paper into rectangles based on player count
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>paperSectionsLibrary</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>	<span class=s1>&#39;players-1&#39;</span><span class=o>:</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>8</span><span class=p>,</span><span class=mi>4</span><span class=p>]],</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=s1>&#39;players-2&#39;</span><span class=o>:</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>4</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>4</span><span class=p>]],</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>	<span class=s1>&#39;players-3&#39;</span><span class=o>:</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>]],</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>	<span class=s1>&#39;default&#39;</span><span class=o>:</span>   <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>2</span><span class=p>]],</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>	<span class=s1>&#39;players-5&#39;</span><span class=o>:</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>6</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>4</span><span class=p>]],</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1>// grab the right setup if it exists, otherwise go to the default setup (which is used in most cases)
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>tempSectionKey</span> <span class=o>=</span> <span class=s1>&#39;players-&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>playerCount</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl><span class=k>this</span><span class=p>.</span><span class=nx>paperSections</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=k>if</span><span class=p>(</span><span class=k>typeof</span><span class=p>(</span><span class=nx>paperSectionsLibrary</span><span class=p>[</span><span class=nx>tempSectionKey</span><span class=p>])</span> <span class=o>==</span> <span class=s1>&#39;undefined&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>	<span class=k>this</span><span class=p>.</span><span class=nx>paperSections</span> <span class=o>=</span> <span class=nx>paperSectionsLibrary</span><span class=p>[</span><span class=s1>&#39;default&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>	<span class=k>this</span><span class=p>.</span><span class=nx>paperSections</span> <span class=o>=</span> <span class=nx>paperSectionsLibrary</span><span class=p>[</span><span class=nx>tempSectionKey</span><span class=p>];</span>
</span></span><span class=line><span class=ln>17</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1>// Create array of players + their own sections
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>playerArray</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>21</span><span class=cl><span class=k>this</span><span class=p>.</span><span class=nx>sections</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>22</span><span class=cl><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>paperSections</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>	<span class=nx>playerArray</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>i</span><span class=p>;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>	<span class=kd>var</span> <span class=nx>s</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>paperSections</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>	<span class=k>this</span><span class=p>.</span><span class=nx>sections</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>	<span class=k>this</span><span class=p>.</span><span class=nx>sections</span><span class=p>[</span><span class=nx>i</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> 
</span></span><span class=line><span class=ln>28</span><span class=cl>		<span class=s1>&#39;rect&#39;</span><span class=o>:</span> <span class=nx>s</span><span class=p>,</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>		<span class=s1>&#39;fullRect&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Phaser</span><span class=p>.</span><span class=nx>Geom</span><span class=p>.</span><span class=nx>Rectangle</span><span class=p>(</span><span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>),</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>		<span class=s1>&#39;cauldrons&#39;</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>		<span class=s1>&#39;spaceLeft&#39;</span><span class=o>:</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=nx>s</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>	<span class=k>this</span><span class=p>.</span><span class=nx>sections</span><span class=p>[</span><span class=nx>i</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>		<span class=s1>&#39;rect&#39;</span><span class=o>:</span> <span class=p>[(</span><span class=k>this</span><span class=p>.</span><span class=nx>xLines</span> <span class=o>-</span> <span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]),</span> <span class=nx>s</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nx>s</span><span class=p>[</span><span class=mi>3</span><span class=p>]],</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>		<span class=s1>&#39;fullRect&#39;</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Phaser</span><span class=p>.</span><span class=nx>Geom</span><span class=p>.</span><span class=nx>Rectangle</span><span class=p>((</span><span class=k>this</span><span class=p>.</span><span class=nx>xLines</span> <span class=o>-</span> <span class=nx>s</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>s</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>),</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>		<span class=s1>&#39;cauldrons&#39;</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>		<span class=s1>&#39;spaceLeft&#39;</span><span class=o>:</span> <span class=nx>s</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=nx>s</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=creating-a-cauldron-distribution>Creating a Cauldron distribution</h3><p>The &ldquo;na√Øve&rdquo; way to distribute cauldrons, would be something like this:</p><ul><li><p>Keep a counter of how many cauldron cells have been filled. (For
example, &ldquo;cauldronCellsLeft = 32&rdquo;)</p></li><li><p>Start a loop.</p></li><li><p>Each iteration, try to fit a cauldron of random size on the paper.</p></li><li><p>Keep doing this until your counter has surpassed the maximum
(&ldquo;cauldronCellsLeft &lt;= 0&rdquo;)</p></li></ul><p>This was the very first implementation when I just needed something to
test. But what are the problems?</p><ul><li><p>No guarantees on cauldron size. (If unlucky, you could end up with
tons of minuscule cauldrons, or only three <em>very big ones</em>.)</p></li><li><p>Unsolvable games. If your recipe needs a cauldron of at least size
6, there must be at least one of those on the board.</p></li><li><p>Unfair distribution. Some players might get all the cauldrons (and
no garden), and vice versa for the rest.</p></li></ul><p>How to solve this? Using a technique very common to random generation:
<em>fixing the distribution up front</em>.</p><p>Before trying to fit cauldrons, I fix a distribution, like this:</p><ul><li><p>Create an empty list (an array in this case).</p></li><li><p>I want at least one cauldron of size X and one of size Y (to make
levels solvable). Add these to the array.</p></li><li><p>Then, repeatedly add a new cauldron to the array of random size,
until we&rsquo;ve reached our <em>exact</em> fill percentage.</p></li><li><p>Finally, sort this array from largest to smallest.</p></li></ul><p>The code looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// Determine a cauldron distribution
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>// Requirements:
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>//  * 32 cauldron cells in total
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1>//  * Each player has at least one cauldron
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1>//  * There must be one cauldron of length &#34;codeLength&#34;
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>maxCauldron</span> <span class=o>=</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=k>this</span><span class=p>.</span><span class=nx>variableRecipe</span><span class=p>)</span> <span class=p>{</span> <span class=nx>maxCauldron</span> <span class=o>=</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>];</span> <span class=p>}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl><span class=kd>var</span> <span class=nx>totalCauldronCells</span> <span class=o>=</span> <span class=mi>32</span> <span class=o>-</span> <span class=nx>maxCauldron</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=nx>maxCauldron</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=k>this</span><span class=p>.</span><span class=nx>cauldronDistribution</span> <span class=o>=</span> <span class=p>[</span><span class=nx>maxCauldron</span><span class=p>];</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=k>while</span><span class=p>(</span><span class=nx>totalCauldronCells</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=kd>var</span> <span class=nx>tempSizeX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=mi>3</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=kd>var</span> <span class=nx>tempSizeY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=mi>3</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>  <span class=c1>// prevent cauldrons greater than our budget allows
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span>  <span class=c1>// (scale down to an approximately correct number)
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nx>tempSizeX</span><span class=o>*</span><span class=nx>tempSizeY</span> <span class=o>&gt;</span> <span class=nx>totalCauldronCells</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=nx>tempSizeX</span> <span class=o>=</span> <span class=nx>totalCauldronCells</span><span class=p>;</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nx>tempSizeY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>round</span><span class=p>(</span><span class=nx>totalCauldronCells</span><span class=o>*</span><span class=mf>0.5</span><span class=p>);</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl>  <span class=c1>// prevent cauldrons of 1 (or less)
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nx>tempSizeX</span><span class=o>*</span><span class=nx>tempSizeY</span> <span class=o>&lt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>    <span class=nx>tempSizeX</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nx>tempSizeY</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>  <span class=c1>// prevent cauldrons greater than 6
</span></span></span><span class=line><span class=ln>29</span><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=nx>tempSizeX</span><span class=o>*</span><span class=nx>tempSizeY</span> <span class=o>&gt;</span> <span class=mi>6</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=nx>tempSizeX</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>    <span class=nx>tempSizeY</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>
</span></span><span class=line><span class=ln>34</span><span class=cl>  <span class=c1>// subtract from total
</span></span></span><span class=line><span class=ln>35</span><span class=cl><span class=c1></span>  <span class=nx>totalCauldronCells</span> <span class=o>-=</span> <span class=nx>tempSizeX</span><span class=o>*</span><span class=nx>tempSizeY</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>
</span></span><span class=line><span class=ln>37</span><span class=cl>  <span class=c1>// add to distribution
</span></span></span><span class=line><span class=ln>38</span><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>cauldronDistribution</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>tempSizeX</span><span class=p>,</span> <span class=nx>tempSizeY</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>39</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl><span class=c1>// Sort the distribution descending (so we place the largest cauldrons first)
</span></span></span><span class=line><span class=ln>42</span><span class=cl><span class=c1></span><span class=k>this</span><span class=p>.</span><span class=nx>cauldronDistribution</span><span class=p>.</span><span class=nx>sort</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>){</span> <span class=k>return</span> <span class=nx>b</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=nx>b</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=nx>a</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=nx>a</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=p>});</span></span></span></code></pre></div><p>When this process is done, we have a list with the <em>exact</em> cauldrons we
want to place. If we manage to place all of them, we are <em>certain</em> the
distribution is correct. (And if we start at the biggest cauldrons, the
probability we&rsquo;ll be able to place them all increases. Because smaller
cauldrons are easier to fit at the end.)</p><h3 id=trying-to-fit-cauldrons>Trying to fit cauldrons</h3><p>Now that we have a distribution, we go back to being na√Øve again. This
code is inside a loop that runs until all cauldrons have been placed:</p><ul><li><p>For each player &mldr;</p></li><li><p>Choose a random side (front/back of the board)</p></li><li><p>Go through the list of cauldrons and find the <em>largest</em> cauldron
that fits.</p><ul><li><p>Rule #1: Obviously the cauldron cannot be larger than the
available area.</p></li><li><p>Rule #2: If the total area for this player (front and back)
combined has no space left (after placing the cauldron), do NOT
place it! Why? Because this would leave a player with only
cauldrons and NO gardens, which is unfair.</p></li></ul></li><li><p>Place it.</p></li><li><p>Remember we placed it (discard/disable all cells we occupy and
subtract from total)</p></li></ul><p>There is a small chance this goes wrong. For whatever reason, everything
doesn&rsquo;t work out, we place gardens and special tiles at annoying
locations, and we <em>cannot</em> place all the cauldrons.</p><p>In that case &mldr; I simply discard all progress and try again :p
Sometimes solutions are quite simple.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// go through all extra cells
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=k>while</span><span class=p>(</span><span class=nx>emptySpaces</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=c1>// find a random place (that still exists)
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>gardenX</span><span class=p>,</span> <span class=nx>gardenY</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nx>gardenX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=nx>maxSizeX</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nx>gardenY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=nx>maxSizeY</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>section</span><span class=p>[</span><span class=nx>gardenX</span><span class=p>][</span><span class=nx>gardenY</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=c1>// NOTE: section is the 2D array created earlier that is exactly the size of each player&#39;s own board
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=c1>// start a garden here
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>newGarden</span> <span class=o>=</span> <span class=p>[</span> <span class=p>[</span><span class=nx>gardenX</span> <span class=o>+</span> <span class=nx>x0</span><span class=p>,</span> <span class=nx>gardenY</span> <span class=o>+</span> <span class=nx>y0</span><span class=p>]</span> <span class=p>];</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=nx>section</span><span class=p>[</span><span class=nx>gardenX</span><span class=p>][</span><span class=nx>gardenY</span><span class=p>]</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=c1>// now we simply go through neighbours (again and again) until we decide to stop (we&#39;re large enough) or we must stop (nothing to explore anymore)
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>cellsToCheck</span> <span class=o>=</span> <span class=p>[</span> <span class=p>[</span><span class=nx>gardenX</span><span class=p>,</span> <span class=nx>gardenY</span><span class=p>]</span> <span class=p>];</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=c1>// check the neighbours (in a random order)
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>terminateLoop</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>terminateLoop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=c1>// grab the first cell on the list
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>c</span> <span class=o>=</span> <span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nx>emptySpaces</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=c1>// check all the neighbours (in a random order)
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>dirs</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]];</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=nx>dirs</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>dirs</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>d</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>d</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>d</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>      <span class=kd>var</span> <span class=nx>tempX</span> <span class=o>=</span> <span class=nx>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span> <span class=nx>tempY</span> <span class=o>=</span> <span class=nx>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>      <span class=c1>// if out of bounds, ignore
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>tempX</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>tempX</span> <span class=o>&gt;=</span> <span class=nx>maxSizeX</span> <span class=o>||</span> <span class=nx>tempY</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>tempY</span> <span class=o>&gt;=</span> <span class=nx>maxSizeY</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>      <span class=c1>// if non-existent, ignore
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>section</span><span class=p>[</span><span class=nx>tempX</span><span class=p>][</span><span class=nx>tempY</span><span class=p>])</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>      <span class=c1>// now check probability: the larger we get, the less likely we are to grow
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1></span>      <span class=kd>var</span> <span class=nx>probCutoff</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>0.5</span><span class=o>*</span><span class=nx>newGarden</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=nx>probCutoff</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl>      <span class=c1>//
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1></span>      <span class=c1>// we will grow!
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1></span>      <span class=c1>//
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>47</span><span class=cl>      <span class=c1>// add this cell to the garden
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>      <span class=nx>newGarden</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>tempX</span> <span class=o>+</span> <span class=nx>x0</span><span class=p>,</span> <span class=nx>tempY</span> <span class=o>+</span> <span class=nx>y0</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl>      <span class=c1>// and plan a check (for potentially growing further)
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1></span>      <span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>tempX</span><span class=p>,</span> <span class=nx>tempY</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>      <span class=c1>// and remember we lost a space
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=c1></span>      <span class=nx>section</span><span class=p>[</span><span class=nx>tempX</span><span class=p>][</span><span class=nx>tempY</span><span class=p>]</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=c1>// terminate if there&#39;s nothing more to check
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=c1></span>    <span class=nx>terminateLoop</span> <span class=o>=</span> <span class=p>(</span><span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=c1>// add the final garden to the list
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>gardens</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>newGarden</span><span class=p>);</span>
</span></span><span class=line><span class=ln>63</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=filling-with-gardens>Filling with gardens</h3><p>So, at this moment we have a board filled with cauldrons, exactly 50% of
it in fact.</p><p>We need to fill the gaps with gardens. It looks nicer, and is better for
gameplay, if gardens have organic shapes, so we don&rsquo;t want to fill the
gaps completely with one garden every time.</p><p>For this, I took another simple &ldquo;growing&rdquo; solution:</p><ul><li><p>Keep a list of all &ldquo;empty&rdquo; cells in a section. (When placing the
cauldrons, I already update this list.)</p></li><li><p>Choose a random empty cell.</p></li><li><p>Check its neighbours. If any of them is available (not a cauldron,
not out of bounds), grow the garden to include that cell with
probability <em>p</em>.</p></li><li><p>What&rsquo;s <em>p</em>? It&rsquo;s a probability that gets <em>smaller</em> as the garden
grows <em>larger</em>. This organically restricts garden size. The specific
number in the current code is: 2.0/gardenSize. So, a garden of size
4, has a probability of growing further that&rsquo;s equal to 2.0/4 = 50%</p></li></ul><p>After growing, we have a set of gardens, which is just an array of all
the cells it includes. This is immediately fed into the algorithm
explained earlier, to determine the bounds of the garden and draw the
right lines.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// go through all extra cells
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span><span class=k>while</span><span class=p>(</span><span class=nx>emptySpaces</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>  <span class=c1>// find a random place (that still exists)
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>gardenX</span><span class=p>,</span> <span class=nx>gardenY</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=nx>gardenX</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=nx>maxSizeX</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=nx>gardenY</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=nx>maxSizeY</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>  <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>section</span><span class=p>[</span><span class=nx>gardenX</span><span class=p>][</span><span class=nx>gardenY</span><span class=p>]);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  
</span></span><span class=line><span class=ln>10</span><span class=cl>  <span class=c1>// NOTE: section is the 2D array created earlier that is exactly the size of each player&#39;s own board
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>12</span><span class=cl>  <span class=c1>// start a garden here
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>newGarden</span> <span class=o>=</span> <span class=p>[</span> <span class=p>[</span><span class=nx>gardenX</span> <span class=o>+</span> <span class=nx>x0</span><span class=p>,</span> <span class=nx>gardenY</span> <span class=o>+</span> <span class=nx>y0</span><span class=p>]</span> <span class=p>];</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>  <span class=nx>section</span><span class=p>[</span><span class=nx>gardenX</span><span class=p>][</span><span class=nx>gardenY</span><span class=p>]</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>  <span class=c1>// now we simply go through neighbours (again and again) until we decide to stop (we&#39;re large enough) or we must stop (nothing to explore anymore)
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>cellsToCheck</span> <span class=o>=</span> <span class=p>[</span> <span class=p>[</span><span class=nx>gardenX</span><span class=p>,</span> <span class=nx>gardenY</span><span class=p>]</span> <span class=p>];</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>
</span></span><span class=line><span class=ln>19</span><span class=cl>  <span class=c1>// check the neighbours (in a random order)
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>  <span class=kd>var</span> <span class=nx>terminateLoop</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>  <span class=k>while</span><span class=p>(</span><span class=o>!</span><span class=nx>terminateLoop</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=c1>// grab the first cell on the list
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>c</span> <span class=o>=</span> <span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>
</span></span><span class=line><span class=ln>25</span><span class=cl>    <span class=nx>emptySpaces</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>
</span></span><span class=line><span class=ln>27</span><span class=cl>    <span class=c1>// check all the neighbours (in a random order)
</span></span></span><span class=line><span class=ln>28</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>dirs</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]];</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>    <span class=nx>dirs</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>dirs</span><span class=p>);</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>d</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>d</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>d</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>      <span class=kd>var</span> <span class=nx>tempX</span> <span class=o>=</span> <span class=nx>c</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span> <span class=nx>tempY</span> <span class=o>=</span> <span class=nx>c</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>      <span class=c1>// if out of bounds, ignore
</span></span></span><span class=line><span class=ln>34</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=nx>tempX</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>tempX</span> <span class=o>&gt;=</span> <span class=nx>maxSizeX</span> <span class=o>||</span> <span class=nx>tempY</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>tempY</span> <span class=o>&gt;=</span> <span class=nx>maxSizeY</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>      <span class=c1>// if non-existent, ignore
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>section</span><span class=p>[</span><span class=nx>tempX</span><span class=p>][</span><span class=nx>tempY</span><span class=p>])</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>
</span></span><span class=line><span class=ln>39</span><span class=cl>      <span class=c1>// now check probability: the larger we get, the less likely we are to grow
</span></span></span><span class=line><span class=ln>40</span><span class=cl><span class=c1></span>      <span class=kd>var</span> <span class=nx>probCutoff</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>0.5</span><span class=o>*</span><span class=nx>newGarden</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>      <span class=k>if</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&gt;</span> <span class=nx>probCutoff</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl>      <span class=c1>//
</span></span></span><span class=line><span class=ln>44</span><span class=cl><span class=c1></span>      <span class=c1>// we will grow!
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1></span>      <span class=c1>//
</span></span></span><span class=line><span class=ln>46</span><span class=cl><span class=c1></span>
</span></span><span class=line><span class=ln>47</span><span class=cl>      <span class=c1>// add this cell to the garden
</span></span></span><span class=line><span class=ln>48</span><span class=cl><span class=c1></span>      <span class=nx>newGarden</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>tempX</span> <span class=o>+</span> <span class=nx>x0</span><span class=p>,</span> <span class=nx>tempY</span> <span class=o>+</span> <span class=nx>y0</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl>      <span class=c1>// and plan a check (for potentially growing further)
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1></span>      <span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>push</span><span class=p>([</span><span class=nx>tempX</span><span class=p>,</span> <span class=nx>tempY</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>      <span class=c1>// and remember we lost a space
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=c1></span>      <span class=nx>section</span><span class=p>[</span><span class=nx>tempX</span><span class=p>][</span><span class=nx>tempY</span><span class=p>]</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>55</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>56</span><span class=cl>
</span></span><span class=line><span class=ln>57</span><span class=cl>    <span class=c1>// terminate if there&#39;s nothing more to check
</span></span></span><span class=line><span class=ln>58</span><span class=cl><span class=c1></span>    <span class=nx>terminateLoop</span> <span class=o>=</span> <span class=p>(</span><span class=nx>cellsToCheck</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;=</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>  <span class=c1>// add the final garden to the list
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1></span>  <span class=k>this</span><span class=p>.</span><span class=nx>gardens</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>newGarden</span><span class=p>);</span>
</span></span><span class=line><span class=ln>63</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Wow, that was a long technical devlog. I think I actually explained (and
provided code for) literally every part of the whole program.</p><p>Hopefully, it was interesting and you learned a lot from it!</p><p>If something was unclear, or you want to know more, or this inspired you
for your own projects &ndash; let me know!</p><p>I&rsquo;ve never seen this kind of hybrid between board and computer games
before, especially not one where you can play using a single sheet of
(blank) paper, so I wanted to share this knowledge and perhaps inspire
others.</p><p>It took me quite a while to figure this stuff out, but now that it&rsquo;s
working, I find this concept to be really fun and easy to understand for
everyone.</p><p>So that&rsquo;s why I wrote this thorough explanation.</p><p>And as always, consider trying out the game at: <a href=https://pandaqi.com/wondering-witches>Wondering Witches</a></p><p>Until the next devlog,</p><p>Pandaqi</p></div></article><div><nav class=pagination><ul><li><a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-4/ class="masked-link big-mask mask-7" style=--rotation:2deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><span class=nav-disabled>No next page :(</span></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives/>Nine Lives
(üêà)</a></li><li><a href=/blog/boardgames/the-outnumbered-series/nine-lives-math-meows/>Nine Lives: Math Meows
(üêà)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-how-to-prioritize/>Game Dev: How to prioritize?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/game-dev-what-are-you-telling-players/>Game Dev: What are you telling players?
(üí¨)</a></li><li><a href=/blog/reviews-and-thoughts/the-summer-of-game-jams/>The Summer of Game Jams (2024)
(üí¨)</a></li><li><a href=/blog/boardgames/swiftsmash-saga/cookie-smasher/>Cookie Smasher
(üç™)</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-defold-engine/>My Thoughts on Defold Engine</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-phaser-3-engine/>My Thoughts on Phaser 3</a></li><li><a href=/blog/reviews-and-thoughts/my-thoughts-on-godot-engine/>My Thoughts on the Godot game engine</a></li><li><a href=/blog/news-and-updates/no-more-play-store/>No More Play Store
(üì±)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>