<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Wondering Witches (Part 1) | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-3" style=--rotation:-0.5deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-4" style=--rotation:0deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-8" style=--rotation:-1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-3" style=--rotation:1deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-3" style=--rotation:1.5deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-4" style=--rotation:1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><div class=thumbnail-media><figure class=thumb-image><picture><img src=../../wondering-witches-header.webp loading=lazy decoding=async alt="Thumbnail / Header for article: Wondering Witches (Part 1)" title="Thumbnail / Header for article: Wondering Witches (Part 1)" width=2481 height=877></picture></figure></div><h1>Wondering Witches (Part 1)</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/boardgames/>Boardgames</a>
/
<a href=/blog/boardgames/wondering-witches/>Wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/>Tech devlog wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-1/>Wondering witches part 1</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/boardgames\/","name":"boardgames"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/","name":"wondering-witches"}},{"@type":"ListItem","position":6,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/","name":"tech-devlog-wondering-witches"}},{"@type":"ListItem","position":7,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/wondering-witches-part-1\/","name":"wondering-witches-part-1"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2020-04-12T09:00:00>Sunday, Apr 12, 2020</time></div><nav class=tags><span class=metadata-label><span class=emoji>üéó</span> Tags ||</span><ul><li><a href=https://pandaqi.com/blog/tags/technical-devlog>technical devlog</a></li></ul></nav><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#the-two-elements>The Two Elements</a></li><li><a href=#evaluating-potions>Evaluating Potions</a><ul><li><a href=#effects>Effects</a></li><li><a href=#effects-ii>Effects II</a></li><li><a href=#some-remarks-on-implementation>Some remarks on implementation</a></li></ul></li></ul></nav></aside><div><p>Welcome to the <em>technical devlog</em> of Wondering Witches!</p><p>In case you haven&rsquo;t played it yet, visit <a href=https://pandaqi.com/wondering-witches>Wondering Witches (Game Page)</a>.</p><p>Read the rules, gather some friends and play yourself a fun little
game :)</p><p>What is the game about? It&rsquo;s a cooperative, logical puzzling boardgame
which only requires you to grab a <em>single piece of (empty) paper</em>. The
game takes place on this paper, but there is an important digital
component.</p><p>The idea of the game is that, through experimentation, growing the
right ingredients, and logic deduction, you must discover the secret
recipe!</p><p>What&rsquo;s the digital component? When you go to the official page, you
can press a button to generate a random starting setup. Scroll down and
you can press another button to generate the actual puzzle.</p><p>This website, even though it&rsquo;s really simple and only a few button
clicks, contains a LOT of ideas and algorithms to make the game
experience as smooth and exciting as possible.</p><p>In this article I&rsquo;ll explain <em>how</em> I created this &ldquo;online component&rdquo;
of the game. I&rsquo;ll also share <em>why</em> I added this component and the things
I learned along the way (whenever necessary).</p><p><em>Remark:</em> I also wrote a more general devlog about the game design
process. It&rsquo;s rather long, but if you are interested in boardgames or
game design, I&rsquo;m sure you&rsquo;ll find it interesting: <a href=/blog/boardgames/wondering-witches/devlog-wondering-witches>Devlog Wondering Witches</a></p><p><em>Remark:</em> of course, the explanations and code samples here are only a
small simplified fraction of the full code. You can visit the website
and check the source code to see exactly how it all works. (I apologize
in advance for pieces of code that are messy, unoptimized or weirdly
structured. I&rsquo;m an &ldquo;if it works, it works&rdquo; kind of guy. I do, however,
comment and space out everything neatly.)</p><h2 id=the-two-elements>The Two Elements</h2><p>The website has two distinct elements: the <strong>board generation</strong> and the
<strong>puzzle generation</strong>. (In fact, you can check the source code and see
that these algorithms reside in two separate files.)</p><p><strong>Board Generator</strong>: this designs a random layout (based on player count
and difficulty) of cauldrons and gardens, adds some special cells and
ingredients on top, and draws this to the screen.</p><p><figure class=inline-image><picture><img src=wondering-witches-1.webp loading=lazy decoding=async alt="Board Front" title="Board Front" width=1165 height=858></picture><figcaption class=side-note><span>Board Front</span></figcaption></figure></p><p><figure class=inline-image><picture><img src=wondering-witches-2.webp loading=lazy decoding=async alt="Board Back" title="Board Back" width=1175 height=869></picture><figcaption class=side-note><span>Board Back</span></figcaption></figure></p><p><strong>Puzzle Generator:</strong> this generates a random <em>puzzle</em> and gives you an
interface to <em>test</em> your solutions.</p><p><figure class=inline-image><picture><img src=wondering-witches-3.webp loading=lazy decoding=async alt="Interface for Entering Potions" title="Interface for Entering Potions" width=1263 height=890></picture><figcaption class=side-note><span>Interface for Entering Potions</span></figcaption></figure></p><p>A &ldquo;puzzle&rdquo; in this game is a secret <strong>recipe</strong>. Some ingredients are
good, some are bad. The good ingredients get a number, and you must put
them in the correct order. The bad ingredients try their best to mess
with your puzzle, by obscuring the results.</p><p><strong>Testing</strong> a solution simply means that you input a set of ingredients,
press &ldquo;Use Potion&rdquo;, and it gives you feedback about the results. For
example, if two of the ingredients had a number that was too <em>low</em>, it
reports &ldquo;2 undergrown ingredients&rdquo;.</p><p>Both parts were written in pure vanilla <strong>JavaScript</strong>. The Board Generation
also used the <strong>Phaser</strong> framework for drawing the board. (I know the
framework very well and saw no need to write custom graphics code.)</p><p>I&rsquo;ll talk about the Puzzle Generator first.</p><h2 id=evaluating-potions>Evaluating Potions</h2><p>This is by far the simplest part of this system! Which is why I wanted
to start here.</p><p>A <strong>potion</strong> is represented by a list of ingredients, an <em>array</em> if you
wish.</p><p>The order matters a lot. To win the game, ingredients need to be in the
correct order. (Ingredient with number 2 must come directly after number
1, for example.)</p><p>The computer simply <strong>loops</strong> through the list from start to finish,
checking the numbers and executing any effects of each ingredient.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>usePotion</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>	<span class=kd>var</span> <span class=nx>cSize</span> <span class=o>=</span> <span class=nx>curCauldron</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=c1>// read ingredients from the interface
</span></span></span><span class=line><span class=ln> 5</span><span class=cl><span class=c1></span>	<span class=c1>// (elements on the page have ids &#34;ingredientSeeds#&#34;, where # is the index of the element in the cauldron)
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>	<span class=c1>// (perhaps not the cleanest way to do it, so don&#39;t focus too much on this piece of code)
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>	<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>cSize</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>		<span class=nx>curCauldron</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>mySeeds</span> <span class=o>=</span> <span class=nb>parseInt</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;ingredientSeeds&#39;</span> <span class=o>+</span> <span class=nx>i</span><span class=p>).</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>
</span></span><span class=line><span class=ln>11</span><span class=cl>	<span class=c1>// now step through the list and determine whatever happens
</span></span></span><span class=line><span class=ln>12</span><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>growingResult</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>	<span class=kd>var</span> <span class=nx>totalEffectResult</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl>	<span class=c1>//
</span></span></span><span class=line><span class=ln>16</span><span class=cl><span class=c1></span>	<span class=c1>// EXECUTE EFFECTS (+ find UNDERGROWN ingredients)
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>	<span class=c1>// 
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>	<span class=c1>//  =&gt; we go through the cauldron from OLDEST/FIRST element to the newest; order is important
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>numWrongIngredients</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>	<span class=kd>var</span> <span class=nx>numUndergrown</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>	<span class=kd>var</span> <span class=nx>numOvergrown</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>	<span class=kd>var</span> <span class=nx>elementsConsidered</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>
</span></span><span class=line><span class=ln>24</span><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>cSize</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>		<span class=c1>// if the number of seeds = -1, set it to whatever is necessary to make this ingredient report correctly
</span></span></span><span class=line><span class=ln>26</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>curCauldron</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>mySeeds</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>			<span class=nx>curCauldron</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>mySeeds</span> <span class=o>=</span> <span class=nx>curCauldron</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>myNum</span><span class=p>;</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>		<span class=c1>// check the ingredient!
</span></span></span><span class=line><span class=ln>31</span><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>checkResult</span> <span class=o>=</span> <span class=nx>checkIngredient</span><span class=p>(</span><span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>
</span></span><span class=line><span class=ln>33</span><span class=cl>		<span class=kd>var</span> <span class=nx>ing</span> <span class=o>=</span> <span class=nx>curCauldron</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>		<span class=kd>var</span> <span class=nx>skipEvaluation</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>		<span class=c1>// if this ingredient is an IGNORE DECOY, well, ignore it
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>ing</span><span class=p>.</span><span class=nx>decoyStatus</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>			<span class=nx>skipEvaluation</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>
</span></span><span class=line><span class=ln>41</span><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>skipEvaluation</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>			<span class=nx>elementsConsidered</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>
</span></span><span class=line><span class=ln>44</span><span class=cl>			<span class=c1>// if it is undergrown, count that (and set ingredient to &#34;wrong&#34;)
</span></span></span><span class=line><span class=ln>45</span><span class=cl><span class=c1></span>			<span class=k>if</span><span class=p>(</span><span class=nx>ing</span><span class=p>.</span><span class=nx>mySeeds</span> <span class=o>&lt;</span> <span class=nx>ing</span><span class=p>.</span><span class=nx>myNum</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>			<span class=nx>numUndergrown</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>			<span class=nx>checkResult</span><span class=p>.</span><span class=nx>isWrong</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>
</span></span><span class=line><span class=ln>49</span><span class=cl>			<span class=c1>// if it is overgrown, also count that (and set ingredient to &#34;wrong&#34;)
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1></span>			<span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>ing</span><span class=p>.</span><span class=nx>mySeeds</span> <span class=o>&gt;</span> <span class=nx>ing</span><span class=p>.</span><span class=nx>myNum</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>51</span><span class=cl>			<span class=nx>numOvergrown</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>			<span class=nx>checkResult</span><span class=p>.</span><span class=nx>isWrong</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>54</span><span class=cl>
</span></span><span class=line><span class=ln>55</span><span class=cl>			<span class=c1>// if something is wrong with this ingredient, count that
</span></span></span><span class=line><span class=ln>56</span><span class=cl><span class=c1></span>			<span class=k>if</span><span class=p>(</span><span class=nx>checkResult</span><span class=p>.</span><span class=nx>isWrong</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>57</span><span class=cl>			<span class=nx>numWrongIngredients</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=ln>58</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>59</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>60</span><span class=cl>
</span></span><span class=line><span class=ln>61</span><span class=cl>		<span class=c1>// add feedback to the effect feedback bar
</span></span></span><span class=line><span class=ln>62</span><span class=cl><span class=c1></span>		<span class=c1>// also flatten feedback (in case an ingredient has multiple effects; otherwise they stay in order)
</span></span></span><span class=line><span class=ln>63</span><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>f</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>f</span> <span class=o>&lt;</span> <span class=nx>checkResult</span><span class=p>.</span><span class=nx>feedbackText</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>f</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>64</span><span class=cl>			<span class=nx>totalEffectResult</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span> <span class=nx>checkResult</span><span class=p>.</span><span class=nx>feedbackText</span><span class=p>[</span><span class=nx>f</span><span class=p>]</span> <span class=p>);</span>
</span></span><span class=line><span class=ln>65</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>66</span><span class=cl>
</span></span><span class=line><span class=ln>67</span><span class=cl>		<span class=c1>//
</span></span></span><span class=line><span class=ln>68</span><span class=cl><span class=c1></span>		<span class=c1>// if a DIRECT EFFECT must happen, do that
</span></span></span><span class=line><span class=ln>69</span><span class=cl><span class=c1></span>		<span class=c1>//
</span></span></span><span class=line><span class=ln>70</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>effs</span><span class=p>[</span><span class=s1>&#39;Cutoff&#39;</span><span class=p>])</span> <span class=p>{</span> <span class=k>break</span><span class=p>;</span> <span class=p>}</span> <span class=c1>// cutoff immediately stops executing this potion
</span></span></span><span class=line><span class=ln>71</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>effs</span><span class=p>[</span><span class=s1>&#39;Enthusiastic&#39;</span><span class=p>])</span> <span class=p>{</span> <span class=nx>i</span><span class=o>++</span><span class=p>;</span> <span class=p>}</span> <span class=c1>// skip the next element in line		
</span></span></span><span class=line><span class=ln>72</span><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=ln>73</span><span class=cl>
</span></span><span class=line><span class=ln>74</span><span class=cl>	<span class=c1>// combine results from growing
</span></span></span><span class=line><span class=ln>75</span><span class=cl><span class=c1></span>	<span class=nx>growingResult</span> <span class=o>=</span> <span class=s1>&#39;&lt;p&gt;Potion had &lt;strong&gt;&#39;</span> <span class=o>+</span> <span class=nx>numUndergrown</span> <span class=o>+</span> <span class=s1>&#39; undergrown&lt;/strong&gt; and &lt;strong&gt;&#39;</span> <span class=o>+</span> <span class=nx>numOvergrown</span> <span class=o>+</span> <span class=s1>&#39; overgrown&lt;/strong&gt; ingredients.&lt;/p&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>76</span><span class=cl>
</span></span><span class=line><span class=ln>77</span><span class=cl>	<span class=c1>// shuffle effects and combine them into string as well
</span></span></span><span class=line><span class=ln>78</span><span class=cl><span class=c1></span>	<span class=nx>totalEffectResult</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>totalEffectResult</span><span class=p>);</span>
</span></span><span class=line><span class=ln>79</span><span class=cl>	<span class=nx>totalEffectResult</span> <span class=o>=</span> <span class=nx>totalEffectResult</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln>80</span><span class=cl>
</span></span><span class=line><span class=ln>81</span><span class=cl>	<span class=c1>//
</span></span></span><span class=line><span class=ln>82</span><span class=cl><span class=c1></span>	<span class=c1>// determine if the players WON
</span></span></span><span class=line><span class=ln>83</span><span class=cl><span class=c1></span>	<span class=c1>//  =&gt; if so, override all messages with a congratulatory one!
</span></span></span><span class=line><span class=ln>84</span><span class=cl><span class=c1></span>	<span class=c1>//
</span></span></span><span class=line><span class=ln>85</span><span class=cl><span class=c1></span>	<span class=k>if</span><span class=p>(</span><span class=nx>elementsConsidered</span> <span class=o>&gt;=</span> <span class=nx>codeLength</span> <span class=o>&amp;&amp;</span> <span class=nx>numWrongIngredients</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>86</span><span class=cl>		<span class=nx>totalEffectResult</span> <span class=o>=</span> <span class=s1>&#39;&lt;p class=&#34;winMessage&#34;&gt;Congratulations! You won!&lt;/p&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>87</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>88</span><span class=cl>
</span></span><span class=line><span class=ln>89</span><span class=cl>	<span class=c1>// display the results
</span></span></span><span class=line><span class=ln>90</span><span class=cl><span class=c1></span>	<span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;potionResult&#39;</span><span class=p>).</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=s1>&#39;block&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>91</span><span class=cl>	<span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;potionResult&#39;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=nx>growingResult</span> <span class=o>+</span> <span class=nx>totalEffectResult</span><span class=p>;</span>
</span></span><span class=line><span class=ln>92</span><span class=cl>
</span></span><span class=line><span class=ln>93</span><span class=cl>	<span class=c1>// clear the current cauldron
</span></span></span><span class=line><span class=ln>94</span><span class=cl><span class=c1></span>	<span class=nx>clearIngredients</span><span class=p>();</span>
</span></span><span class=line><span class=ln>95</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=effects>Effects</h3><p>Because of this linear structure, I needed to be very careful about what
&ldquo;effects&rdquo; could do. Once an ingredient has been checked, it&rsquo;s never
checked again. Which means I cannot change anything in a potion that
comes BEFORE my current ingredient. I can only change stuff that comes
after it.</p><p>What does this mean? An effect can only &mldr;</p><ul><li><p><em>Report</em> the results from ingredients BEFORE it.</p></li><li><p><em>Alter</em> the values of the ingredients AFTER it.</p></li></ul><p>&ldquo;Report&rdquo; example: the <em>Hugger</em> effect reports whether the ingredient
BEFORE itself has a value within a range of 1. (So if the Hugger has
value 6, and the one before it has value 5, it will report <em>yes</em>.)</p><p>&ldquo;Alter&rdquo; example: the <em>Spicy</em> effect changes the value of the ingredient
AFTER itself by 1. (So if the element after Spicy has a value of 3, it&rsquo;s
now changed to 4.)</p><p>By implementing the effects this way, I ensure that there are never
mistakes or inconsistencies about the results.</p><p><em>But, why not change the loop? Why go through the potion linearly?</em>
Because of simplicity, both in code and in human deduction. This
constraint made the game <em>much</em> easier to play and grasp, and the code
much cleaner.</p><p>(That&rsquo;s usually how it works: a creative constraint should be viewed as
a <em>good thing</em> you can use to simplify your piece of art. Whatever that
may be.)</p><p>Of course, there were some ideas I had to throw out, but it was a
trade-off I could live with.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=kd>function</span> <span class=nx>checkIngredient</span><span class=p>(</span><span class=nx>cauldronIndex</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>  <span class=c1>// get ingredient and initialize empty object for it
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>ing</span> <span class=o>=</span> <span class=nx>curCauldron</span><span class=p>[</span><span class=nx>cauldronIndex</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>	<span class=kd>var</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> 
</span></span><span class=line><span class=ln> 5</span><span class=cl>		<span class=s2>&#34;isWrong&#34;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=ln> 6</span><span class=cl>		<span class=s2>&#34;feedbackText&#34;</span><span class=o>:</span> <span class=p>[],</span> 
</span></span><span class=line><span class=ln> 7</span><span class=cl>		<span class=s2>&#34;directEffects&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>			<span class=s2>&#34;Cutoff&#34;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>			<span class=s2>&#34;Enthusiastic&#34;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>			<span class=s2>&#34;Fertilizer&#34;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>			<span class=s1>&#39;Resetter&#39;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>			<span class=s1>&#39;Coward&#39;</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>		<span class=p>}</span> 
</span></span><span class=line><span class=ln>14</span><span class=cl>	<span class=p>};</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>	<span class=c1>// if the number is greater than 0, check the ordering
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>	<span class=c1>// ordering is correct if two ingredients are in direct sequence (e.g. 4 =&gt; 5)
</span></span></span><span class=line><span class=ln>18</span><span class=cl><span class=c1></span>	<span class=k>if</span><span class=p>(</span><span class=nx>cauldronIndex</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>		<span class=nx>obj</span><span class=p>.</span><span class=nx>isWrong</span> <span class=o>=</span> <span class=o>!</span><span class=p>(</span><span class=nx>curCauldron</span><span class=p>[(</span><span class=nx>cauldronIndex</span><span class=o>-</span><span class=mi>1</span><span class=p>)].</span><span class=nx>myNum</span> <span class=o>==</span> <span class=p>(</span><span class=nx>ing</span><span class=p>.</span><span class=nx>myNum</span> <span class=o>-</span> <span class=mi>1</span><span class=p>));</span>
</span></span><span class=line><span class=ln>20</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>
</span></span><span class=line><span class=ln>22</span><span class=cl>	<span class=c1>// now check all the effects individually
</span></span></span><span class=line><span class=ln>23</span><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>effects</span> <span class=o>=</span> <span class=nx>ing</span><span class=p>.</span><span class=nx>effects</span><span class=p>;</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>effects</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>		<span class=nx>checkEffect</span><span class=p>(</span><span class=nx>cauldronIndex</span><span class=p>,</span> <span class=nx>effects</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=ln>26</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>
</span></span><span class=line><span class=ln>28</span><span class=cl>	<span class=k>return</span> <span class=nx>obj</span><span class=p>;</span>
</span></span><span class=line><span class=ln>29</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>30</span><span class=cl>
</span></span><span class=line><span class=ln>31</span><span class=cl><span class=kd>function</span> <span class=nx>checkEffect</span><span class=p>(</span><span class=nx>cauldronIndex</span><span class=p>,</span> <span class=nx>effectName</span><span class=p>,</span> <span class=nx>obj</span><span class=p>,</span> <span class=nx>obscureName</span> <span class=o>=</span> <span class=kc>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>	<span class=kd>var</span> <span class=nx>feedbackText</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>	<span class=kd>var</span> <span class=nx>cSize</span> <span class=o>=</span> <span class=nx>curCauldron</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>
</span></span><span class=line><span class=ln>35</span><span class=cl>	<span class=kd>var</span> <span class=nx>feedbackValue</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>36</span><span class=cl>	<span class=kd>var</span> <span class=nx>singular</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>37</span><span class=cl>	<span class=k>switch</span><span class=p>(</span><span class=nx>effectName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>		<span class=k>case</span> <span class=s1>&#39;Cutoff&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>			<span class=nx>obj</span><span class=p>.</span><span class=nx>directEffects</span><span class=p>[</span><span class=s1>&#39;Cutoff&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>			<span class=nx>feedbackValue</span> <span class=o>=</span> <span class=s2>&#34;The ingredient was cut off&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>41</span><span class=cl>			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>
</span></span><span class=line><span class=ln>43</span><span class=cl>		<span class=k>case</span> <span class=s1>&#39;Spicy&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=nx>cauldronIndex</span> <span class=o>&lt;</span> <span class=p>(</span><span class=nx>cSize</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>				<span class=nx>curCauldron</span><span class=p>[(</span><span class=nx>cauldronIndex</span><span class=o>+</span><span class=mi>1</span><span class=p>)].</span><span class=nx>myNum</span><span class=o>++</span><span class=p>;</span> 
</span></span><span class=line><span class=ln>46</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln>47</span><span class=cl>			<span class=nx>feedbackValue</span> <span class=o>=</span> <span class=s2>&#34;A spicy ingredient was encountered&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>			<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>49</span><span class=cl>
</span></span><span class=line><span class=ln>50</span><span class=cl>		<span class=c1>// many more cases here ....
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>
</span></span><span class=line><span class=ln>53</span><span class=cl>	<span class=c1>// and return feedback here
</span></span></span><span class=line><span class=ln>54</span><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div><h3 id=effects-ii>Effects II</h3><p>After several playtests, I noticed something annoying:</p><ul><li><p>Effects were evenly distributed (intentionally), but this made the
game significantly easier. If you knew an ingredient could have, at
most, one effect, it became much easier to solve that puzzle.</p></li><li><p>Effects were picked completely at random. This meant that there were
games where <em>all</em> effects had the same type, which made the game way
less fun changed the dynamic too much.</p></li></ul><p>The first problem was fixed by distributing effects completely randomly.
On average, the distribution will be somewhat fair, but it could happen
that one ingredient has 2 or 3 effects, while others have none.</p><p>The second problem was fixed by splitting the effects into categories.
Instead of one giant list, I made several lists (&ldquo;investigative
effects&rdquo;, &ldquo;change cauldron effects&rdquo;, etc.)</p><p>First, it grabs one random element from <em>each list</em>. If that is not
enough ( = we need more effects), it concatenates all the lists (turning
it into one huge list again) and picks randomly from that.</p><p>This ensures we have at least one effect of each type, but also keeps
some randomness.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln>  1</span><span class=cl><span class=kd>function</span> <span class=nx>createPuzzle</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  2</span><span class=cl>	<span class=c1>// generate a random ordering of numbers
</span></span></span><span class=line><span class=ln>  3</span><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>allNumbers</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln>  4</span><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numIngredients</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  5</span><span class=cl>		<span class=c1>// these ingredients are part of the recipe, so give them numbers 1,...,n
</span></span></span><span class=line><span class=ln>  6</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>codeLength</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>  7</span><span class=cl>			<span class=nx>allNumbers</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln>  8</span><span class=cl>
</span></span><span class=line><span class=ln>  9</span><span class=cl>		<span class=c1>// these ingredients are not, so give them a -1 (this will be replaced with a proper decoy soon)
</span></span></span><span class=line><span class=ln> 10</span><span class=cl><span class=c1></span>		<span class=p>}</span> <span class=k>else</span>  <span class=p>{</span>
</span></span><span class=line><span class=ln> 11</span><span class=cl>			<span class=nx>allNumbers</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 12</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 13</span><span class=cl>		
</span></span><span class=line><span class=ln> 14</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 15</span><span class=cl>	<span class=nx>allNumbers</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>allNumbers</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 16</span><span class=cl>
</span></span><span class=line><span class=ln> 17</span><span class=cl>  <span class=c1>// save the ingredients
</span></span></span><span class=line><span class=ln> 18</span><span class=cl><span class=c1></span>  <span class=c1>// and determine a decoy type for the non-ingredients (those without a number)
</span></span></span><span class=line><span class=ln> 19</span><span class=cl><span class=c1></span>	<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>numIngredients</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 20</span><span class=cl>		<span class=kd>var</span> <span class=nx>num</span> <span class=o>=</span> <span class=nx>allNumbers</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 21</span><span class=cl>		<span class=kd>var</span> <span class=nx>effects</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 22</span><span class=cl>
</span></span><span class=line><span class=ln> 23</span><span class=cl>		<span class=c1>// let&#39;s determine a random decoy type (0,1,2)
</span></span></span><span class=line><span class=ln> 24</span><span class=cl><span class=c1></span>		<span class=c1>// 0 = IGNORE; this ingredient will be skipped and not interacted with, although effects execute
</span></span></span><span class=line><span class=ln> 25</span><span class=cl><span class=c1></span>		<span class=c1>// 1 = OVERACHIEVER; this ingredient is always undergrown (0) or overgrown (n+1)
</span></span></span><span class=line><span class=ln> 26</span><span class=cl><span class=c1></span>		<span class=c1>// 2 = IMPOSTER; this ingredient behaves like a regular ingredient, but it has the &#34;imposter&#34; effect
</span></span></span><span class=line><span class=ln> 27</span><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>decoyStatus</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 28</span><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>num</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 29</span><span class=cl>			<span class=kd>var</span> <span class=nx>randNum</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 30</span><span class=cl>			<span class=k>if</span><span class=p>(</span><span class=nx>randNum</span> <span class=o>&lt;=</span> <span class=mf>0.33</span> <span class=o>||</span> <span class=nx>difficulty</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 31</span><span class=cl>				<span class=nx>decoyStatus</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 32</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>randNum</span> <span class=o>&lt;=</span> <span class=mf>0.66</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 33</span><span class=cl>				<span class=nx>decoyStatus</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 34</span><span class=cl>
</span></span><span class=line><span class=ln> 35</span><span class=cl>				<span class=k>if</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>&lt;=</span> <span class=mf>0.5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 36</span><span class=cl>					<span class=nx>num</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 37</span><span class=cl>				<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 38</span><span class=cl>					<span class=nx>num</span> <span class=o>=</span> <span class=p>(</span><span class=nx>codeLength</span><span class=o>+</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 39</span><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=ln> 40</span><span class=cl>			<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 41</span><span class=cl>				<span class=nx>decoyStatus</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 42</span><span class=cl>				<span class=nx>num</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span><span class=o>*</span><span class=nx>codeLength</span><span class=p>)</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 43</span><span class=cl>				<span class=nx>effects</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s2>&#34;Imposter&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 44</span><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=ln> 45</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 46</span><span class=cl>
</span></span><span class=line><span class=ln> 47</span><span class=cl>		<span class=kd>var</span> <span class=nx>obj</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;myName&#34;</span><span class=o>:</span> <span class=nx>ingredientNames</span><span class=p>[</span><span class=nx>i</span><span class=p>],</span> <span class=s2>&#34;myNum&#34;</span><span class=o>:</span> <span class=nx>num</span><span class=p>,</span> <span class=s2>&#34;effects&#34;</span><span class=o>:</span> <span class=nx>effects</span><span class=p>,</span> <span class=s2>&#34;decoyStatus&#34;</span><span class=o>:</span> <span class=nx>decoyStatus</span> <span class=p>};</span>
</span></span><span class=line><span class=ln> 48</span><span class=cl>		<span class=nx>curPuzzle</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=o>=</span> <span class=nx>obj</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 49</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln> 50</span><span class=cl>
</span></span><span class=line><span class=ln> 51</span><span class=cl>	<span class=c1>// if effects are enabled ...
</span></span></span><span class=line><span class=ln> 52</span><span class=cl><span class=c1></span>	<span class=c1>//  =&gt; randomly distribute effects across the ingredients
</span></span></span><span class=line><span class=ln> 53</span><span class=cl><span class=c1></span>	<span class=c1>//  =&gt; shuffle them, grab X of them (however many needed)
</span></span></span><span class=line><span class=ln> 54</span><span class=cl><span class=c1></span>	<span class=k>if</span><span class=p>(</span><span class=nx>effectsLevel</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 55</span><span class=cl>		<span class=c1>// DEEP copy the effects array
</span></span></span><span class=line><span class=ln> 56</span><span class=cl><span class=c1></span>		<span class=c1>// (because we&#39;ll be adding/removing in a moment)
</span></span></span><span class=line><span class=ln> 57</span><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>effectListCopy</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>allEffects</span><span class=p>));</span>
</span></span><span class=line><span class=ln> 58</span><span class=cl>
</span></span><span class=line><span class=ln> 59</span><span class=cl>		<span class=c1>// determine number of effects (based on number of ingredients + effects level)
</span></span></span><span class=line><span class=ln> 60</span><span class=cl><span class=c1></span>		<span class=k>if</span><span class=p>(</span><span class=nx>effectsLevel</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 61</span><span class=cl>			<span class=nx>numEffects</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>numIngredients</span><span class=o>*</span><span class=mf>0.5</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 62</span><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=nx>effectsLevel</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 63</span><span class=cl>			<span class=nx>numEffects</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nx>numIngredients</span><span class=o>*</span><span class=mf>0.75</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 64</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 65</span><span class=cl>
</span></span><span class=line><span class=ln> 66</span><span class=cl>		<span class=c1>// RETRIEVE this number of effects
</span></span></span><span class=line><span class=ln> 67</span><span class=cl><span class=c1></span>		<span class=c1>// there&#39;s a specific order to grabbing effects: 1) Change Cauldron, 2) Investigative, 3) Change Player, 4) Change Field, 5) Complex
</span></span></span><span class=line><span class=ln> 68</span><span class=cl><span class=c1></span>		<span class=c1>// once this order is exhausted, it starts picking stuff randomly, according to some probabilities
</span></span></span><span class=line><span class=ln> 69</span><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>possibleEffectTypes</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;ChangeCauldron&#39;</span><span class=p>,</span> <span class=s1>&#39;Investigative&#39;</span><span class=p>,</span> <span class=s1>&#39;ChangePlayers&#39;</span><span class=p>,</span> <span class=s1>&#39;ChangeField&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 70</span><span class=cl>		<span class=kd>var</span> <span class=nx>finalEffectList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 71</span><span class=cl>		<span class=nx>finalEffectList</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span><span class=s1>&#39;ChangeCauldron&#39;</span><span class=p>]).</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 72</span><span class=cl>		<span class=nx>finalEffectList</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span><span class=s1>&#39;Investigative&#39;</span><span class=p>]).</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 73</span><span class=cl>		<span class=nx>finalEffectList</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span><span class=s1>&#39;ChangePlayers&#39;</span><span class=p>]).</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 74</span><span class=cl>		<span class=nx>finalEffectList</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span><span class=s1>&#39;ChangeField&#39;</span><span class=p>]).</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 75</span><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>effectsLevel</span> <span class=o>&gt;=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 76</span><span class=cl>			<span class=nx>finalEffectList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=nx>shuffle</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span><span class=s1>&#39;Complex&#39;</span><span class=p>]).</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 77</span><span class=cl>			<span class=nx>possibleEffectTypes</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s1>&#39;Complex&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 78</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 79</span><span class=cl>
</span></span><span class=line><span class=ln> 80</span><span class=cl>		<span class=c1>// now build a single list consisting of all types
</span></span></span><span class=line><span class=ln> 81</span><span class=cl><span class=c1></span>		<span class=c1>// (this automatically ensures that, when grabbing randomly, we have the right probabilities of grabbing each type)
</span></span></span><span class=line><span class=ln> 82</span><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>bigEffectList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 83</span><span class=cl>		<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>possibleEffectTypes</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 84</span><span class=cl>			<span class=nx>bigEffectList</span> <span class=o>=</span> <span class=nx>bigEffectList</span><span class=p>.</span><span class=nx>concat</span><span class=p>(</span><span class=nx>effectListCopy</span><span class=p>[</span> <span class=nx>possibleEffectTypes</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>]);</span>
</span></span><span class=line><span class=ln> 85</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 86</span><span class=cl>
</span></span><span class=line><span class=ln> 87</span><span class=cl>		<span class=c1>// once the default order is done, as long as we don&#39;t have enough effects yet, grab them completely randomly
</span></span></span><span class=line><span class=ln> 88</span><span class=cl><span class=c1></span>		<span class=k>while</span><span class=p>(</span><span class=nx>finalEffectList</span><span class=p>.</span><span class=nx>length</span> <span class=o>&lt;</span> <span class=nx>numEffects</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 89</span><span class=cl>			<span class=nx>finalEffectList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span> <span class=nx>bigEffectList</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=p>);</span>
</span></span><span class=line><span class=ln> 90</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln> 91</span><span class=cl>
</span></span><span class=line><span class=ln> 92</span><span class=cl>		<span class=c1>// now apply them randomly
</span></span></span><span class=line><span class=ln> 93</span><span class=cl><span class=c1></span>		<span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>finalEffectList</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 94</span><span class=cl>			<span class=kd>var</span> <span class=nx>curEffect</span> <span class=o>=</span> <span class=nx>finalEffectList</span><span class=p>[</span><span class=nx>i</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 95</span><span class=cl>
</span></span><span class=line><span class=ln> 96</span><span class=cl>			<span class=c1>// access a random ingredient
</span></span></span><span class=line><span class=ln> 97</span><span class=cl><span class=c1></span>			<span class=kd>var</span> <span class=nx>randType</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>floor</span><span class=p>(</span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>()</span> <span class=o>*</span> <span class=nx>numIngredients</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 98</span><span class=cl>			<span class=nx>curPuzzle</span><span class=p>[</span><span class=nx>randType</span><span class=p>].</span><span class=nx>effects</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span> <span class=nx>curEffect</span><span class=p>.</span><span class=nx>name</span> <span class=p>);</span>
</span></span><span class=line><span class=ln> 99</span><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=ln>100</span><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=ln>101</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=some-remarks-on-implementation>Some remarks on implementation</h3><p><strong>Implementation Remark:</strong> at the start of potion evaluation, I create
an object. Why? Because objects are passed by <em>reference</em> in JavaScript.
As I evaluate each ingredient, I add any results (feedback, changes I
need to make) to this object. Once evaluation is complete, this means I
have an <em>array</em> of feedback I need to return to the player.</p><p>Here&rsquo;s the most important thing: I shuffle this array. In the first
implementations, I forgot to do this, which meant the order of feedback
gave away which ingredients had which effects.</p><p><strong>Implementation Remark 2:</strong> each effect is thrown through a huge
<strong>switch</strong> statement in the code. It&rsquo;s perhaps not ideal, but it was a
very fast and clean way to implement <em>many</em> different effects.</p><p>However, there were some &ldquo;direct effects&rdquo; that had a delayed execution.
For example, the &ldquo;Enthusiastic&rdquo; effect means you <em>skip</em> the next
ingredient. This effect needed to be remembered and only applied at the
end of a loop iteration.</p><p>For this, I also added a list of <em>direct effects</em> to that object I
described above. At the end of each loop iteration, I check for these
effects and handle them accordingly.</p></div></article><div><nav class=pagination><ul><li><span class=nav-disabled>No previous page :(</span></li><li>Continue reading</li><li><a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-2/ class="masked-link big-mask mask-8" style=--rotation:0.5deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/reviews-and-thoughts/should-you-let-your-kids-win/>Should you let your kids win?
(üí¨)</a></li><li><a href=/blog/boardgames/slippery-slopes/>Slippery Slopes
(üêò)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-2024-update/>Pandaqi Games: 2024 Update
(üéÆ)</a></li><li><a href=/blog/reviews-and-thoughts/why-rules-should-be-less-strict/>Why rules should be less strict
(üí¨)</a></li><li><a href=/blog/boardgames/mammoth-messages/>Mammoth Messages
(üêò)</a></li><li><a href=/blog/boardgames/kangaruse/>Kangaruse
(ü¶ò)</a></li><li><a href=/blog/news-and-updates/my-journey-to-becoming-a-game-designer/>My Journey to Becoming a Game Designer
(üé≤)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-solving-the-nightmare-of-text/>Pandaqi Games: Solving the Nightmare called Text
(üéÆ)</a></li><li><a href=/blog/boardgames/waitless-games/creature-quellector/>Creature Quellector
(üêâ)</a></li><li><a href=/blog/boardgames/waitless-games/finger-food/>Finger Food
(üñêÔ∏è)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>