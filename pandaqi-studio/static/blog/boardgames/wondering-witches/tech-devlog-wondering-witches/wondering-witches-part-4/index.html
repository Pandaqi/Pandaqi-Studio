<!doctype html><html lang=en-US><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Wondering Witches (Part 4) | Pandaqi Blog</title>
<link rel=icon type=image/png href=https://pandaqi.com/blog//favicon.png><link rel=stylesheet type=text/css href=/blog/css/critical.min.css></head><body><header id=site-header><nav class=menu><ul><li><a href=https://pandaqi.com/blog/ class="masked-link big-mask mask-5" style=--rotation:-1deg>Home</a></li><li><a href=/blog/boardgames/ class="masked-link big-mask mask-5" style=--rotation:-0.5deg>Boardgames</a></li><li><a href=/blog/news-and-updates/ class="masked-link big-mask mask-7" style=--rotation:1.5deg>News & Updates</a></li><li><a href=/blog/reviews-and-thoughts/ class="masked-link big-mask mask-1" style=--rotation:1deg>Reviews & Thoughts</a></li><li><a href=/blog/tutorials/ class="masked-link big-mask mask-5" style=--rotation:-0.5deg>Tutorials</a></li><li><a href=/blog/videogames/ class="masked-link big-mask mask-6" style=--rotation:1.5deg>Videogames</a></li></ul></nav></header><main class="padding center-block"><article class=single-article><div class=thumbnail-media><figure class=thumb-image><picture><img src=../../wondering-witches-header.webp loading=lazy decoding=async alt="Thumbnail / Header for article: Wondering Witches (Part 4)" title="Thumbnail / Header for article: Wondering Witches (Part 4)" width=2481 height=877></picture></figure></div><h1>Wondering Witches (Part 4)</h1><aside class=metadata><nav class=breadcrumbs><span class=metadata-label><span class=emoji>ü•ê</span> Breadcrumbs ||</span>
<a href=https://pandaqi.com/blog/>Home</a>
/
<a href=/blog/>Blog</a>
/
<a href=/blog/boardgames/>Boardgames</a>
/
<a href=/blog/boardgames/wondering-witches/>Wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/>Tech devlog wondering witches</a>
/
<a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-4/>Wondering witches part 4</a></nav><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/pandaqi.com\/blog\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"\/blog\/","name":"blog"}},{"@type":"ListItem","position":4,"item":{"@id":"\/blog\/boardgames\/","name":"boardgames"}},{"@type":"ListItem","position":5,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/","name":"wondering-witches"}},{"@type":"ListItem","position":6,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/","name":"tech-devlog-wondering-witches"}},{"@type":"ListItem","position":7,"item":{"@id":"\/blog\/boardgames\/wondering-witches\/tech-devlog-wondering-witches\/wondering-witches-part-4\/","name":"wondering-witches-part-4"}}]}</script><div><span class=metadata-label><span class=emoji>&#8987;</span> Published ||</span>
<time datetime=2020-04-12T12:00:00>Sunday, Apr 12, 2020</time></div><nav class=tags><span class=metadata-label><span class=emoji>üéó</span> Tags ||</span><ul><li><a href=https://pandaqi.com/blog/tags/technical-devlog>technical devlog</a></li></ul></nav><div><span class=metadata-label><span class=emoji>üìñ</span> Table of Contents ||</span>
<a href=# id=toc-toggle>Show</a></div></aside><aside id=table-of-contents class=masked-link-block><header><h2>Table of Contents</h2></header><nav id=TableOfContents><ul><li><a href=#drawing-a-board>Drawing a Board</a><ul><li><a href=#using-html5-canvas-and-phaser>Using HTML5 Canvas (and Phaser)</a></li><li><a href=#cauldrons>Cauldrons</a></li><li><a href=#gardens>Gardens</a></li><li><a href=#a-crucial-last-step>A crucial last step!</a></li></ul></li></ul></nav></aside><div><p>Welcome to part 4 of my Technical Devlog for the game Wondering Witches!</p><p>Haven&rsquo;t read the other entries? Go to the <a href=../>devlog overview</a>.</p><h2 id=drawing-a-board>Drawing a Board</h2><p>To my surprise, randomly generating the game board was actually <em>by far
the hardest part</em> of this project.</p><p>At first, I thought: &ldquo;well, I&rsquo;ll just randomly generate some rectangles
and place them across the field so they don&rsquo;t overlap, randomly add some
ingredients/special cells on top, and we&rsquo;re done!&rdquo;</p><p>Then reality hit. These were just a few of the problems:</p><ul><li><p>This game supports different player counts. This means that you need
to be able to <em>cut</em> the board into pieces and give one piece to each
player. Thus, the pieces needed to be roughly equal (in size and
content).</p></li><li><p>Cauldrons can only be rectangular. But gardens can be any shape.
Thus, I needed to write an algorithm to randomly merge cells
together into a garden, and then draw the correct border around it.</p></li><li><p>I need a (roughly) 50/50 split between cauldrons and gardens. Not
only that, I need a 50/50 split <em>per player</em>. If one player has <em>all
the cauldrons</em>, and another has <em>all the gardens</em>, the game will be
boring, one-sided, and way too short.</p></li></ul><p>This is the age-old problem with random generation: you want it to be
random &mldr; but within very specific parameters.</p><p>I needed the boards to be as random and varied as possible, but if I
make a single mistake during generation, it will likely ruin the whole
game.</p><p>(For example, one of the early playtests saw a board with only 20
cauldron cells, and 44 garden cells. We had <em>way</em> too few opportunities
to test potions, which meant the game was over fairly quickly and we had
to guess the final solution. As it happens, we guessed correctly :p)</p><p>So, before we get into the algorithms for <em>generating a fair board</em>,
let&rsquo;s first talk about actually <em>drawing</em> this board. (As it&rsquo;s way
easier. And it also gives us some restrictions for <em>how</em> we must
generate the board.)</p><p><figure class=inline-image><picture><img src=wondering-witches-4.webp loading=lazy decoding=async alt="Again, image of one side of the board" title="Again, image of one side of the board" width=1165 height=858></picture><figcaption class=side-note><span>Again, image of one side of the board</span></figcaption></figure></p><h3 id=using-html5-canvas-and-phaser>Using HTML5 Canvas (and Phaser)</h3><p>When you press the button &ldquo;Generate Board&rdquo;, I start a Phaser game.</p><p>I won&rsquo;t explain how Phaser works here, but it&rsquo;s a free library for
creating browser games, which means it requires a &lt;canvas> element
onto which to draw stuff. (And, of course, it has many helper functions
for making this drawing as painless as possible.)</p><p>Let&rsquo;s assume I&rsquo;ve generated a board. This means I have several populated
arrays:</p><ul><li><p>Cauldrons = a list of rectangles, each representing a single
cauldron</p></li><li><p>Gardens = a list of arrays; each array contains all the cells that
make up this garden</p></li><li><p>Ingredients = a list of random ingredients to place (and where to
place them + what number to give them)</p></li><li><p>Special cells = a list of special cells to place (and where to place
them)</p></li><li><p>Required cell = I always leave one cell empty for players to write
down important information</p></li></ul><p>The last three arrays are not important to talk about, because they are
very straightforward. I just pick random cells, check if I can place
something there, and then place the ingredient/special cell/required
cell.</p><p>(The most annoying thing was the actual visual placement. To make it
look good, these elements needed to be centered and scaled properly
within their cells. Which always takes some trial and error.)</p><p>The <em>Cauldrons</em> and <em>Gardens</em> array are the real deal.</p><h3 id=cauldrons>Cauldrons</h3><p>Cauldrons must be rectangular. This is good, because Phaser has a quick
function for creating and drawing rectangles. (It&rsquo;s literally a handful
of lines to draw all the cauldrons. Search &ldquo;Phaser Notes Rectangle&rdquo; for
more info.)</p><p>Cauldrons are colored a light red, but I needed something more
distinctive to separate them from gardens.</p><p>Eventually, I decided to write the text &ldquo;Cauldron&rdquo; at the top left of
each cauldron. This was easy as well: the (x,y) coordinate of the
rectangle was already its top left.</p><p>Lastly, I made the border around cauldrons a thick black line (thicker
than the garden border).</p><h3 id=gardens>Gardens</h3><p>Gardens can be any shape. That&rsquo;s why I store them as a <em>list of cells</em>.
There&rsquo;s no order to this list, and there doesn&rsquo;t need to be.</p><p>To show the garden, I color each of these cells a faint shade of green.</p><p>To display the text &ldquo;Garden&rdquo; at the top left, I loop through all the
cells and keep track of <em>which one is most top left</em>.</p><p>The difficult part was <em>generating the border</em> of this weirdly-shaped
thing. I tried all sorts of &ldquo;rectangle merging&rdquo; algorithms for a few
hours, until I realized I was overcomplicating things.</p><p>This is the algorithm I ended up using:</p><ul><li><p>Loop through all cells</p></li><li><p>For each cell, check its neighbours (up, down, left, right)</p></li><li><p>If the neighbour cell <strong>is not</strong> within the same garden, we must
draw a border to this side!</p></li><li><p>If the neighbour cell <strong>is</strong> within the same garden, we just
continue and draw nothing.</p></li></ul><p>This has worked perfectly since. To speed up this process, I also check
if a neighbour is <em>outside of the paper</em>, because that will happen a
significant chunk of the time, and if so ignore it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>// Draw gardens
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1>//
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>gardenColors</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0x99FF99</span><span class=p>,</span> <span class=mh>0x99EE99</span><span class=p>,</span> <span class=mh>0x99DD99</span><span class=p>,</span> <span class=mh>0x99CC99</span><span class=p>,</span> <span class=mh>0x99BB99</span><span class=p>,</span> <span class=mh>0x99AA99</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=kd>var</span> <span class=nx>gardenLines</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>g</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>g</span> <span class=o>&lt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>gardens</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>g</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=kd>var</span> <span class=nx>gard</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>gardens</span><span class=p>[</span><span class=nx>g</span><span class=p>];</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>  <span class=c1>// draw each cell in the garden
</span></span></span><span class=line><span class=ln>10</span><span class=cl><span class=c1></span>  <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>gard</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>    <span class=kd>var</span> <span class=nx>tempX</span> <span class=o>=</span> <span class=nx>gard</span><span class=p>[</span><span class=nx>i</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=kd>var</span> <span class=nx>tempY</span> <span class=o>=</span> <span class=nx>gard</span><span class=p>[</span><span class=nx>i</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl>    <span class=kd>var</span> <span class=nx>rect</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Phaser</span><span class=p>.</span><span class=nx>Geom</span><span class=p>.</span><span class=nx>Rectangle</span><span class=p>(</span><span class=nx>tempX</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>tempY</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    <span class=nx>graphics</span><span class=p>.</span><span class=nx>fillStyle</span><span class=p>(</span><span class=nx>gardenColors</span><span class=p>[</span><span class=nx>g</span> <span class=o>%</span> <span class=nx>gardenColors</span><span class=p>.</span><span class=nx>length</span><span class=p>],</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>    <span class=nx>graphics</span><span class=p>.</span><span class=nx>fillRectShape</span><span class=p>(</span><span class=nx>rect</span><span class=p>);</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=c1>// also check, for each cell, if it should have a border
</span></span></span><span class=line><span class=ln>19</span><span class=cl><span class=c1></span>    <span class=c1>// check all neighbours; if the neighbouring cell is NOT in the garden (for whatever reason), draw a border line
</span></span></span><span class=line><span class=ln>20</span><span class=cl><span class=c1></span>    <span class=kd>var</span> <span class=nx>dirs</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]];</span>
</span></span><span class=line><span class=ln>21</span><span class=cl>    <span class=kd>var</span> <span class=nx>myCenter</span> <span class=o>=</span> <span class=p>[(</span><span class=nx>tempX</span><span class=o>+</span><span class=mf>0.5</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=p>(</span><span class=nx>tempY</span><span class=o>+</span><span class=mf>0.5</span><span class=p>)</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>];</span>
</span></span><span class=line><span class=ln>22</span><span class=cl>    <span class=kd>var</span> <span class=nx>dirLines</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]];</span>
</span></span><span class=line><span class=ln>23</span><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>d</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>d</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=nx>d</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>24</span><span class=cl>      <span class=kd>var</span> <span class=nx>nbX</span> <span class=o>=</span> <span class=nx>tempX</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span> <span class=nx>nbY</span> <span class=o>=</span> <span class=nx>tempY</span> <span class=o>+</span> <span class=nx>dirs</span><span class=p>[</span><span class=nx>d</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=ln>25</span><span class=cl>
</span></span><span class=line><span class=ln>26</span><span class=cl>      <span class=kd>var</span> <span class=nx>foundCell</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=ln>27</span><span class=cl>      <span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=o>&lt;</span> <span class=nx>gard</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>28</span><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>i</span> <span class=o>==</span> <span class=nx>j</span><span class=p>)</span> <span class=p>{</span> <span class=k>continue</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=ln>29</span><span class=cl>
</span></span><span class=line><span class=ln>30</span><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>gard</span><span class=p>[</span><span class=nx>j</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=nx>nbX</span> <span class=o>&amp;&amp;</span> <span class=nx>gard</span><span class=p>[</span><span class=nx>j</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=nx>nbY</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>31</span><span class=cl>          <span class=nx>foundCell</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=ln>32</span><span class=cl>          <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=ln>33</span><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=ln>34</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>35</span><span class=cl>
</span></span><span class=line><span class=ln>36</span><span class=cl>      <span class=c1>// if there was NO cell from the same garden on this side, draw a line
</span></span></span><span class=line><span class=ln>37</span><span class=cl><span class=c1></span>      <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>foundCell</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>38</span><span class=cl>        <span class=kd>var</span> <span class=nx>dl</span> <span class=o>=</span> <span class=nx>dirLines</span><span class=p>[</span><span class=nx>d</span><span class=p>]</span>
</span></span><span class=line><span class=ln>39</span><span class=cl>        <span class=kd>var</span> <span class=nx>line</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Phaser</span><span class=p>.</span><span class=nx>Geom</span><span class=p>.</span><span class=nx>Line</span><span class=p>(</span>
</span></span><span class=line><span class=ln>40</span><span class=cl>            <span class=nx>myCenter</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.5</span><span class=o>*</span><span class=nx>dl</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>myCenter</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.5</span><span class=o>*</span><span class=nx>dl</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span><span class=p>,</span> 
</span></span><span class=line><span class=ln>41</span><span class=cl>            <span class=nx>myCenter</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.5</span><span class=o>*</span><span class=nx>dl</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectWidth</span><span class=p>,</span> <span class=nx>myCenter</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.5</span><span class=o>*</span><span class=nx>dl</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>*</span><span class=k>this</span><span class=p>.</span><span class=nx>rectHeight</span>
</span></span><span class=line><span class=ln>42</span><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=ln>43</span><span class=cl>        <span class=nx>gardenLines</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>line</span><span class=p>);</span>
</span></span><span class=line><span class=ln>44</span><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=ln>45</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>46</span><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=ln>47</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln>48</span><span class=cl>
</span></span><span class=line><span class=ln>49</span><span class=cl><span class=c1>// This STROKES the gardens
</span></span></span><span class=line><span class=ln>50</span><span class=cl><span class=c1>// (we already determined the border edges in the code above)
</span></span></span><span class=line><span class=ln>51</span><span class=cl><span class=c1></span><span class=k>for</span><span class=p>(</span><span class=kd>var</span> <span class=nx>l</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>l</span> <span class=o>&lt;</span> <span class=nx>gardenLines</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>l</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>52</span><span class=cl>  <span class=nx>graphics</span><span class=p>.</span><span class=nx>lineStyle</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>lineWidth</span><span class=p>,</span> <span class=mh>0x000000</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
</span></span><span class=line><span class=ln>53</span><span class=cl>  <span class=nx>graphics</span><span class=p>.</span><span class=nx>strokeLineShape</span><span class=p>(</span><span class=nx>gardenLines</span><span class=p>[</span><span class=nx>l</span><span class=p>]);</span>
</span></span><span class=line><span class=ln>54</span><span class=cl><span class=p>}</span></span></span></code></pre></div><h3 id=a-crucial-last-step>A crucial last step!</h3><p>So, we&rsquo;ve just created a canvas that looks like a nice game board.</p><p>This works fine &mldr; except it&rsquo;s a waste of resources and it has some
hiccups.</p><p>For example, you cannot zoom in/out on a canvas on mobile, as the
gestures are absorbed by the game. Quite annoying if you&rsquo;re trying to
copy the game board to your paper.</p><p>Additionally, you must keep the website open, which means the game will
<em>keep running</em> for probably 30 minutes.</p><p>Not good enough!</p><p>Once the canvas has been generated &mldr;</p><ul><li><p>I wait a short while (a handful of milliseconds)</p></li><li><p>I convert the canvas to a <strong>&ldquo;data URL&rdquo;</strong></p></li><li><p>I create a new <strong>image</strong> from this data and put it on the page.</p></li><li><p>And then I <strong>delete the game</strong>.</p></li></ul><p>The code is actually quite simple:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Javascript data-lang=Javascript><span class=line><span class=ln> 1</span><span class=cl><span class=c1>// after a small time interval, replace this whole game with just a static image
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1>// (why the wait? the canvas needs to be drawn/dirtied and updated, otherwise we copy a black canvas)
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span><span class=k>this</span><span class=p>.</span><span class=nx>time</span><span class=p>.</span><span class=nx>addEvent</span><span class=p>({</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=nx>delay</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=nx>callback</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>        <span class=c1>// get link to canvas
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>        <span class=c1>// (there&#39;s probably a cleaner way using Phaser, didn&#39;t know it at the time)
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>canv</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;phaserContainer&#39;</span><span class=p>).</span><span class=nx>firstChild</span><span class=p>.</span><span class=nx>nextSibling</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl>        <span class=c1>// create new image from old data url + append to DOM
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>img</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>();</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>        <span class=nx>img</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=nx>canv</span><span class=p>.</span><span class=nx>toDataURL</span><span class=p>();</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>        <span class=nx>img</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>maxWidth</span> <span class=o>=</span> <span class=s1>&#39;100%&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>        <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;phaserContainer&#39;</span><span class=p>).</span><span class=nx>appendChild</span><span class=p>(</span><span class=nx>img</span><span class=p>);</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>
</span></span><span class=line><span class=ln>16</span><span class=cl>        <span class=c1>// finally, destroy this whole game
</span></span></span><span class=line><span class=ln>17</span><span class=cl><span class=c1></span>        <span class=nx>GAME</span><span class=p>.</span><span class=nx>destroy</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=ln>18</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>19</span><span class=cl>    <span class=nx>loop</span><span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=ln>20</span><span class=cl><span class=p>})</span></span></span></code></pre></div><p><strong>Why do we need to wait?</strong> Because it takes time to draw and update the
canvas. If I try to turn the canvas into an image immediately, I get a
completely black image, because the canvas <em>hasn&rsquo;t been updated yet</em>.</p><p><strong>What&rsquo;s a data URL?</strong> Every image is nothing more than a string of text
( = a chunk of data) that the computer <em>interprets</em> as an image. By
using the default function &ldquo;.toDataUrl();&rdquo; you can convert anything to
its URL, which is extremely useful. Then you simply create a new &lt;img>
element and set this URL as its src.</p><p>Deleting the game was &mldr; surprisingly easy and painless. I just needed
to call the default Phaser function, and it removes all traces of itself
without any issue.</p><p>(In fact, on most devices, you won&rsquo;t even see the moment where it
deletes the game and switches to a static image. It&rsquo;s like a magic trick
:p)</p><p>Because the board is just an image now, you can zoom in/out, save the
image, anything you want &ndash; and it doesn&rsquo;t cost any additional
computational resources.</p></div></article><div><nav class=pagination><ul><li><a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-3/ class="masked-link big-mask mask-4" style=--rotation:0.5deg>&lt;&lt; Previous Page</a></li><li>Continue reading</li><li><a href=/blog/boardgames/wondering-witches/tech-devlog-wondering-witches/wondering-witches-part-5/ class="masked-link big-mask mask-7" style=--rotation:2deg>>> Next Page</a></li></ul></nav></div></main><footer id=site-footer><div class="padding center-block"><h3>More Pandaqi</h3><p>You could <a href=https://pandaqi.com>visit the game studio</a>.
Or my <a href=https://pandaqi.com/tutorials/>free tutorial website</a>.
Or my <a href=https://rodepanda.com/>portfolio</a> with easy access to absolutely everything I ever made.</p><h3>Latest</h3><nav class=latest><ul><li><a href=/blog/reviews-and-thoughts/should-you-let-your-kids-win/>Should you let your kids win?
(üí¨)</a></li><li><a href=/blog/boardgames/slippery-slopes/>Slippery Slopes
(üêò)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-2024-update/>Pandaqi Games: 2024 Update
(üéÆ)</a></li><li><a href=/blog/reviews-and-thoughts/why-rules-should-be-less-strict/>Why rules should be less strict
(üí¨)</a></li><li><a href=/blog/boardgames/mammoth-messages/>Mammoth Messages
(üêò)</a></li><li><a href=/blog/boardgames/kangaruse/>Kangaruse
(ü¶ò)</a></li><li><a href=/blog/news-and-updates/my-journey-to-becoming-a-game-designer/>My Journey to Becoming a Game Designer
(üé≤)</a></li><li><a href=/blog/news-and-updates/pandaqi-games-solving-the-nightmare-of-text/>Pandaqi Games: Solving the Nightmare called Text
(üéÆ)</a></li><li><a href=/blog/boardgames/waitless-games/creature-quellector/>Creature Quellector
(üêâ)</a></li><li><a href=/blog/boardgames/waitless-games/finger-food/>Finger Food
(üñêÔ∏è)</a></li></ul></nav><h3>Sections</h3><nav><ul><li><a href=/blog/boardgames/>Boardgames
(üé≤)</a></li><li><a href=/blog/news-and-updates/>News & Updates
(üì¢)</a></li><li><a href=/blog/reviews-and-thoughts/>Reviews & Thoughts
(üí≠)</a></li><li><a href=/blog/tutorials/>Tutorials
(üë©‚Äçüéì)</a></li><li><a href=/blog/videogames/>Videogames
(üéÆ)</a></li></ul></nav><h3>Credits</h3><p>Theme by me (<a href=https://pandaqi.com>Pandaqi</a> üêº) &#183;
with ‚ù§Ô∏è &#183;
using <a href=https://gohugo.io>Hugo</a> &#183;
&copy; 2018&ndash;2024 Pandaqi Blog</p></div></footer><link rel=stylesheet type=text/css href=/blog/css/style.css><script src=/blog/js/main.bundle.min.js async defer></script></body></html>