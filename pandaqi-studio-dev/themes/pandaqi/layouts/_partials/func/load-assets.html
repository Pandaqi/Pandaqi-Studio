{{ $url := .RelPermalink }}
{{ $url_prefixed := printf "games%s" $url }}

<!--- Find JS on standard path, build + include if found --->
{{ $url_js_direct := printf "%s.ts" (trim $url_prefixed "/") }}
{{ $res_js := resources.Get $url_js_direct }} <!--- /gamename/game/ => /gamename/game.ts --->

{{ if not $res_js }}
    {{ $url_js_folder := printf "%smain.ts" $url_prefixed }} <!--- /gamename/game/ => /gamename/game/main.ts --->
    {{ $res_js = resources.Get $url_js_folder }}
{{ end }}

{{ if $res_js }}
    {{ $output_url := printf "%s/bundle.js" $url_prefixed }}
    {{ $opts := dict "minify" (not hugo.IsDevelopment) "sourceMap" (cond hugo.IsDevelopment "external" "") "targetPath" $output_url }}
    {{ $script := $res_js | js.Build $opts }}
    {{ $script.Publish }}
    <script async defer src="{{ $script.RelPermalink }}"></script>
{{ end }}

<!--- Find CSS on standard path, build + include if found --->
{{ $url_css_direct := printf "%s.scss" (trim $url_prefixed "/") }}
{{ $res_css := resources.Get $url_css_direct }}

{{ if not $res_css }}
    {{ $url_css_folder := printf "%smain.scss" $url_prefixed }}
    {{ $res_css = resources.Get $url_css_folder }}
{{ end }}

{{ if $res_css }}
    {{ $output_url := printf "%s/bundle.css" $url_prefixed }}
    {{ $options := (dict "targetPath" $output_url "outputStyle" "compressed" "transpiler" "dartsass") }}
    {{ $style := $res_css | css.Sass $options }}
    <link rel="stylesheet" type="text/css" href="{{ $style.RelPermalink }}">
{{ end }}

<!--- Default rulebook system, which will be enough for at least half of them --->
{{ $is_rulebook := strings.Contains $url_prefixed "/rules/" }}
{{ if and (not $res_js) $is_rulebook }}
    {{ $output_url := "/rulebook-default.js" }}
    {{ $opts := dict "minify" (not hugo.IsDevelopment) "sourceMap" (cond hugo.IsDevelopment "external" "") "targetPath" $output_url }}
    {{ $script_default := resources.Get "/lib/rulebook-default.ts" | js.Build $opts }}
    <script async defer src="{{ $script_default.RelPermalink }}"></script>
{{ end }}
